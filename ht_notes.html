<!DOCTYPE html><html style="--app-height: 1058px;"><head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Notes</title>
<style>
    .app {
        display: grid;
        grid-template-columns: 320px 1fr;
        grid-template-rows: auto 1fr;
        grid-template-areas:
        "header header"
        "tree editor";
        width: 100%;
        height: var(--app-height);
    }

    a {
        color: #c6ceff;
    }

    @media (max-width: 768px) {
        .app {
            grid-template-columns: 1fr;
            grid-template-areas:
            "header"
            "editor";
            height: 100dvh;
        }

        .tree {
            grid-area: unset;        /* no longer in the grid */
            position: fixed;         /* overlays instead */
            top: 48px;               /* adjust to your header height */
            left: 0;
            bottom: 0;
            width: 75%;
            max-width: 300px;
            background: var(--bg);
            border-right: 1px solid var(--border);
            transform: translateX(-100%); /* hidden off-screen */
            transition: transform 0.2s ease;
            z-index: 1000;
        }

        .tree.show {
            transform: translateX(0); /* slide in */
        }

        .editor {
            grid-area: editor;
            width: 100%;  /* force full width */
            min-height: 0;
            min-width: 0;
            overflow: hidden;
        }

        textarea#editorArea {
            height: 90dvh;
            overflow: auto;
        }

        .tree-dialog {
            width: 90vw;  /* Use most of the viewport width */
            max-width: none;
            min-width: unset;
            transform: translate(-50%, -50%);
        }

        .tree-dialog-content {
            gap: 10px;
            padding: 14px;
        }

        .tree-dialog button {
            font-size: 1em;
            white-space: normal; /* Allow wrapping if needed */
            word-break: break-word; /* Wrap long words gracefully */
        }
    }

    .tree-dialog {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--bg);
        color: var(--fg);
        border: 2px solid var(--border);
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        z-index: 2000;
    
        /* Default width (desktop-friendly) */
        min-width: 300px;
        max-width: 90vw;
        border-radius: 8px;
    }
    
    /* Ensure content doesn’t feel cramped */
    .tree-dialog-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px;
    }
    
    /* Buttons: give them a bit more breathing room */
    .tree-dialog button {
        padding: 8px;
        background: var(--bg);
        color: var(--fg);
        border: 1px solid var(--btn-border);
        border-radius: 4px;
        cursor: pointer;
        white-space: nowrap; /* Prevent text from wrapping */
    }

    :root {
        --bg: #000;
        --fg: #f5f5f5;
        --muted: #555;
        --accent: #00d1b2;
        --danger: #ff5577;
        --sel-bg: #111827;
        --btn-border: #555;
        --border: #222;
    }

    * { box-sizing: border-box; }
    /* html, body { height: 100%; } */
    body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font: 14px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        display: flex;
        min-height: 100dvh;
    }
    header {
        grid-area: header;
        padding: 8px 12px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 12px;
        user-select: none;
    }
    header .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .dot.green { background: var(--accent); }
    .dot.red { background: var(--danger); }
    .kbd-hint { color: var(--muted); }

    .tree {
        grid-area: tree;
        border-right: 1px solid var(--border);
        min-width: 240px;
        overflow: auto;
        padding: 8px;
    }
    .tree ul { list-style: none; margin: 0; padding-left: 16px; }
    .tree li { margin: 2px 0; }

    .node {
        display: flex; align-items: center; gap: 8px;
        padding: 2px 6px; border-radius: 2px;
        cursor: default; user-select: none;
    }

    .node .twisty { width: 12px; display: inline-block; text-align: center; color: var(--muted); }
    .node .icon { width: 16px; height: 16px; display: inline-block; color: var(--muted); }
    .node .title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .node.selected { background: var(--sel-bg); outline: 1px dashed #333; }

    .editor {
        grid-area: editor;
        display: grid;
        grid-template-rows: auto 1fr auto;
        min-width: 0;
    }
    .status {
        padding: 6px 10px; border-bottom: 1px solid var(--border);
        display: flex; align-items: center; gap: 12px;
    }
    .status .pill { padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); }

    textarea#editorArea {
        width: 100%;
        height: 100%;
        background: transparent;
        color: var(--fg);
        border: none;
        outline: none;
        resize: none;
        padding: 12px;
        font: inherit;
        line-height: 1.5;
        tab-size: 4;
        overflow: auto;
    }
    .footer { border-top: 1px solid var(--border); padding: 6px 10px; color: var(--muted); }

    .dim { color: var(--muted); }
    .accent { color: var(--accent); }
    .danger { color: var(--danger); }

    /* Searching */
    .search-dialog {
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;                /* take almost full width on mobile */
        max-width: 600px;          /* cap at desktop size */
        max-height: 70%;
        overflow: hidden;
        background: #222;
        color: #fff;
        border: 2px solid #444;
        border-radius: 4px;
        z-index: 9999;
        font-family: monospace;
        padding: 10px;
        display: none;
        flex-direction: column;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    }

    .search-dialog input {
        padding: 6px;
        margin-bottom: 10px;
        background: #111;
        color: #fff;
        border: 1px solid #555;
        width: 100%;
        font-size: 1rem;
        box-sizing: border-box;
    }

    .search-results {
        overflow-y: auto;
        flex: 1;
        border-top: 1px solid #333;
        border-bottom: 1px solid #333;
    }

    .search-results div {
        padding: 6px 8px;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .find-highlight {
        background: yellow;
        color: black;
        font-weight: bold;
    }
        
    /* Highlighted selection */
    .search-results div.selected, 
    .marks-list div.selected {
        background: #444;
    }

    /* --- Mobile refinements --- */
    @media (max-width: 480px) {
        .search-dialog {
            top: 5%;
            width: 95%;       /* wider on very small screens */
            border-radius: 3px;
            padding: 8px;
        }
        .search-dialog input {
            font-size: 0.9rem;
            padding: 5px;
        }
        .search-results div {
            font-size: 0.9rem;
            padding: 5px 6px;
        }
    }

    /* Links Dialog */
    #linksDialog {
        display: none;
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;                /* take almost full width on mobile */
        max-width: 600px;          /* cap at desktop size */
        max-height: 70%;
        background: #222;
        color: #fff;
        border: 2px solid #444;
        border-radius: 2px;
        padding: 20px;
        z-index: 9999;
        font-family: monospace;
        overflow-y: auto;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
    }
    #marksDialog {
        display: none;
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 700px;
        max-height: 70%;
        background: #222;
        color: #fff;
        border: 2px solid #444;
        border-radius: 2px;
        padding: 20px;
        z-index: 9999;
        font-family: monospace;
        overflow-y: auto;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
    }
    #linksDialog h3 {
        margin-top: 0;
    }
    #linksList a {
        display: block;
        color: #00d1b2;
        text-decoration: underline;
        margin-bottom: 4px;
        word-break: break-all;
    }
    #linksDialog .close {
        margin-top: 10px;
        color: #ccc;
        cursor: pointer;
        display: inline-block;
    }
    #linksList a.selected {
        background: #444;
        display: block;
    }

    /* History Dialog */
    #historyDialog {
        display: none;
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 600px;
        max-width: 90vw;
        max-height: 70vh;
        background: #222;
        color: #fff;
        border: 2px solid #444;
        border-radius: 6px;

        /* move padding to children to avoid parent padding affecting height calculations */
        padding: 0;
        z-index: 9999;
        font-family: monospace;
        box-shadow: rgba(0, 0, 0, 0.8) 0 0 20px;

        display: flex;
        flex-direction: column;
        overflow: hidden;        /* prevent dialog itself from scrolling */
    }

    /* header: keep height predictable and out of the scroller */
    #historyDialog > h3 {
        margin: 0;
        padding: 15px 20px 8px 20px;
        border-bottom: 1px solid #444;
        flex-shrink: 0;
    }

    /* wrapper that holds the scrollable list */
    #historyDialog .history-content {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        overflow: hidden;       /* ensure only child scrolls */
        min-height: 0;          /* CRITICAL: allows it to shrink inside max-height parent */
    }

    /* the actual scrollable area */
    #historyList {
        flex: 1 1 auto;         /* fill remaining space under header */
        overflow-y: auto;       /* scroll only here */
        padding: 10px 20px 20px 20px;
        min-height: 0;          /* CRITICAL: allows the element to shrink inside flex parent */
        border-top: 1px solid #444;
    }

    /* ✅ Responsive adjustments for smaller screens */
    @media (max-width: 700px) {
        #historyDialog {
            width: 90vw;
            top: 5%;
            padding: 15px;
            border-radius: 4px;
        }

        #historyDialog h3 {
            font-size: 1em;
            padding-bottom: 6px;
        }
    }

    /* Search/Replace Dialog */
    #replaceDialog {
        display: none;
        position: fixed;
        top: 15%;
        left: 5px;
        /* transform: translateX(-50%); */
        width: 230px;
        background: #222;
        color: #fff;
        border: 2px solid #444;
        border-radius: 2px; /* per your request */
        padding: 16px;
        z-index: 9999;
        font-family: monospace;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
    }
    #replaceDialog h3 {
        margin-top: 0;
    }
    #replaceDialog label {
        display: block;
        margin-bottom: 4px;
    }
    #replaceDialog input {
        width: 100%;
        padding: 6px;
        margin-bottom: 10px;
        background: #111;
        color: #fff;
        border: 1px solid #555;
    }
    #replaceDialog button {
        background: #444;
        color: #ddd;
        border: none;
        padding: 6px 12px;
        margin-right: 8px;
        cursor: pointer;
        font-family: inherit;
    }
    #replaceDialog .close {
        background: #444;
        color: #fff;
    }

    #msg {
        opacity: 0;
        transition: opacity 0.6s ease; /* fade in/out */
    }
    #msg.visible {
        opacity: 1;
    }

    button {
        background: #000;
        border: solid 1px #555;
        color: #fff;
    }

    /* General hidden table (no borders, spacing, or visible styling) */
    .hidden-tbl,
    .hidden-tbl td,
    .hidden-tbl th {
        border: none;
        border-collapse: collapse;
        padding: 0;
        margin: 0;
    }

    /* Two equal-width columns for hidden-tbl */
    .hidden-tbl td.col2 {
        width: 50%;
        padding: 0.5em;
        vertical-align: top;
    }

    /* Controls table (same hidden styling, but for controls layout) */
    .controls-tbl,
    .controls-tbl td,
    .controls-tbl th {
        border: none;
        border-collapse: collapse;
        padding: 0;
        margin: 0;
    }

    /* Two equal-width columns in controls-tbl */
    .controls-tbl td.col2 {
        width: 50%;
        text-align: center;
        vertical-align: middle;
        padding: 0.5em;
    }
        
    /* Three equal-width columns in controls-tbl */
    .controls-tbl td.col3 {
        width: 33.33%;
        text-align: center;
        vertical-align: middle;
        padding: 0.5em;
    }


    /* Scrollbars */
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 2px; }
    ::-webkit-scrollbar-track { background: #0b0f17; }
    </style>
</head>
<body>
<div class="app">
<header id="mobileMenu" style="display: none;">
    <button id="hamburger" class="hamburger" style="display:none;">☰</button>
    <button id="mblSearch" onclick="closeDialogs(); activateTree(); openSearch();">Search</button>
    <button id="mblLinks" onclick="closeDialogs(); activateTree(); openLinksDialog();">Links</button>
    <button id="mblExport" onclick="closeDialogs(); exportNoteAsTxt();">Export</button>
    <button id="mblSave" onclick="closeDialogs(); saveAsHtml('');">Save As</button>
    <button id="mblSave" onclick="closeDialogs(); saveAsHtml(fileName);">Save</button>
    <button id="mblSave" onclick="closeDialogs(); openHelpDialog('VimDisabled');">?</button>
</header>

<div id="treeDialog" class="tree-dialog">
    <table class="hidden-tbl">
        <tbody><tr>
            <td class="col2">
                <div class="tree-dialog-content">
                    <button id="collapseBtn">- Collapse</button>
                    <button id="addNodeBtn">+ Add Node</button>
                    <button id="addChildBtn">+ Add Child Node</button>
                    <button id="renameNodeBtn">? Rename Node</button>
                    <button id="deleteNodeBtn">! Delete Node</button>
                    <button id="closeDialogBtn">✖ Close</button>
                </div>
            </td>
            <td id="treeCol2" class="col2">
                <div>
                    Move Selected Node:
                </div>
                <table class="controls-tbl">
                    <tbody><tr>
                        <td class="col3">&nbsp;</td>
                        <td class="col3"> 
                            <button id="mvUpBtn" onclick="reorderAmongSiblings('up'); render();">Up</button>
                        </td>
                        <td class="col3">&nbsp;</td>
                    </tr>
                    <tr>
                        <td class="col3">
                            <button id="mvLeftBtn" onclick="moveOutToParent(); render();">Left</button>
                        </td>
                        <td class="col3">&nbsp;</td>
                        <td class="col3">
                            <button id="mvRightBtn" onclick="moveIntoAsChild(); render();">Right</button>
                        </td>
                    </tr>
                    <tr>
                        <td class="col3">&nbsp;</td>
                        <td class="col3">
                            <button id="mvDownBtn" onclick="reorderAmongSiblings('down'); render();">Down</button>
                        </td>
                        <td class="col3">&nbsp;</td>
                    </tr>
                </tbody></table>
            </td>
        </tr>
    </tbody></table>
</div>

<div id="optionsDialog" style="display: none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 400px; background: rgb(34, 34, 34); color: rgb(255, 255, 255); border: 2px solid rgb(68, 68, 68); border-radius: 2px; padding: 20px; z-index: 9999; font-family: monospace; box-shadow: rgba(0, 0, 0, 0.8) 0px 0px 20px;">
    <h3>Options</h3>
    <label><input type="checkbox" id="optShowInitHelp"> Show Init Help</label><br><br>
    <label>File Name: <input type="text" id="optFileName" style="background:#111;color:#fff;border:1px solid #555;"></label><br><br>
    <label><input type="checkbox" id="optModeVim"> Enable Vim Mode</label><br><br>
    <label>Node Port: <input type="text" id="optPort" style="background:#111;color:#fff;border:1px solid #555;"></label>
    <p>Press Enter to save, Esc to cancel.</p>
</div>

<div class="search-dialog" id="searchDialog" style="display: none;">
    <input id="searchInput" placeholder="Search..." type="text">
    <div class="search-results" id="searchList"><div style="color: rgb(136, 136, 136);">(no matching nodes)</div></div>
</div>

<div class="search-dialog" id="helpDialogUnified" style="display:none;">
  <input id="helpFilter" type="text" placeholder="Filter help (Start with : to search keys only)...">
  <div id="helpResults" class="search-results"></div>
  <p><a href="https://hcjsuite.infinityfreeapp.com/httree_help.html" target="_blank">Full Help System</a></p>
  <p style="margin-top:6px;">Press ESC to close.</p>
</div>

<div id="linksDialog" ondblclick="closeLinksDialog();" style="display: none;">
    <h3>Links in Note</h3>
    <div id="linksList"><a href="#" data-node-id="kqr4o4g3" class="selected">The Options Dialog</a></div>
</div>

<div id="marksDialog" style="display: none;">
    <h3>Bookmarks</h3>
    <div id="marksList"></div>
    <p>
        <br>
        Press Esc to close
        <br>
        Press d to delete a bookmark
    </p>
</div>

<div id="replaceDialog" style="display: none;">
    <h3>Find &amp; Replace</h3>
    <label for="searchText">Find</label>
    <input id="searchText" type="text">
    <div id="replaceTools" style="display: block;">
        <label for="replaceText">Replace With</label>
        <input id="replaceText" type="text">
        <div style="display: none;">
            <button onclick="doFind()">Find</button>
            <button onclick="doReplaceAll()">Replace All</button>
        </div>
    </div>
    <div id="replaceResults">Replaced 1 occurrence(s).</div>
    <div id="findResults" style="margin-top:10px; max-height:200px; overflow:auto; font-family:monospace; white-space:pre-wrap;"></div>
</div>

<div id="historyDialog" style="display: none;">
    <h3>History</h3>
    <div class="history-content">
        <div id="historyList"><div class="selected" style="background: rgb(68, 68, 68);">Current HT Implementations</div><div>Quick Notes</div><div>Onboarding - Flutter</div><div>Brands</div></div>
    </div>
</div>

<div id="saveAsDialog" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(0, 0, 0); color: rgb(255, 255, 255); border: 2px solid rgb(68, 68, 68); border-radius: 6px; padding: 20px; width: 320px; z-index: 9999; font-family: monospace; box-shadow: rgba(0, 0, 0, 0.8) 0px 0px 20px;">
    <h3>Save As</h3>
    <label>Title<br>
        <input id="saveAsTitle" type="text" style="width:100%; background:#111; color:#fff; border:1px solid #555; margin-bottom:10px;">
    </label>
    <label>File Name<br>
        <input id="saveAsFileName" type="text" style="width:100%; background:#111; color:#fff; border:1px solid #555; margin-bottom:10px;">
    </label>
    <p style="color:#888; font-size:0.9em;">Press Enter to save, Esc to cancel.</p>
</div>


<aside class="tree" id="tree" onclick="closeDialogs(); activateTree();"><ul><li><div class="node selected"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Recipes</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Entertainment</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Information</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Links</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">ToDos</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Documentation</span></div></li><li><div class="node"><span class="twisty"><svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor"></path></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433"></path> </g> </svg></span><span class="title">Contacts</span></div></li><li><div class="node"><span class="twisty"><svg width="6" height="6" viewBox="0 0 6 6" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="1" fill="currentColor"></circle></svg></span><span class="icon"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <svg width="16" height="16" viewBox="0 0 4.2333334 4.2333334" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"></defs> <path style="fill:none;fill-opacity:1;stroke:#a5a5a5;stroke-width:0.258464;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="m 0.79069024,0.63332294 c 1.68462256,-0.00621 0.87336156,0 2.51966116,0 V 3.6027704 H 0.79069024 Z" id="path65"></path> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5117" width="1.3229166" height="0.24694447" x="1.3890625" y="1.3934721"></rect> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5737" width="1.3229166" height="0.24694447" x="1.3890625" y="1.887361"></rect> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5739" width="1.3229166" height="0.24694447" x="1.3890625" y="2.3812501"></rect> </svg></span><span class="title">Quick Notes</span></div></li></ul></aside>
<section class="editor">
    <div id="statusBar" class="status" onclick="closeDialogs();" ondblclick="toggleMobileMenu();" title="Double click to toggle Mobile Mode">
        <span class="pill" id="mode" style="display: block;">TREE</span>
        <span class="pill" id="kind">FOLDER</span>
        <span class="dim" id="path">/</span>
        <span class="pill" id="msg"></span>
    </div>
    <textarea id="editorArea" spellcheck="false" readonly="readonly"></textarea>
</section>
</div>

<input type="file" id="filePicker" accept=".html" style="display:none;">

<script>
        //---- Data Model ------------------------------------------------------
        const makeId = () => Math.random().toString(36).slice(2, 10);

        /** @typedef {{ id:string, title:string, content:string, children:NodeT[], expanded:boolean }} NodeT */

        /** @type {NodeT[]} */
        let treeData = [
  {"id":"67zo6hgh","title":"Recipes","content":"","children":[{"id":"zor7r9u9","title":"Cocktails","content":"","children":[{"id":"2k7pyf7b","title":"Brands","content":"Brands\n\n\n* Almost Champagne:\n    Louis Bouillot\n\n* Champagne:\n    Chanoine Frères 1730\n\n* Elderflower Liqueur:\n    Drillaud (more affordable than St Germain)\n    St Germain\n\n* Mezcal:\n    El Padrino $\n\n* Prosecco:\n    Albino Armani (luxury prosecco)\n\n* Rum - Aged:\n    Appleton Estate\n\n* Tequila:\n    4 capos $ Gran Orendain $","children":[],"expanded":false},{"id":"i91fqxwb","title":"Recipes","content":"","children":[{"id":"hbp93vng","title":"Cocktails","content":"","children":[{"id":"iee0j35g","title":"A","content":"","children":[{"id":"11f2armn","title":"Aperol Spritz","content":"Aperol Spritz\n\n\n* 2oz aperol\n* 3oz prosecco\n* 2oz soda water\n* 1 orange wedge\n\nAlternative:\n* 1/3 proseco\n* 1/3 aperol\n* However much soda water you want\n\nDirections\nAdd aperol to a glass with ice. Stir. Add prosecco and soda water. Squeeze \norange wedge into glass.","children":[],"expanded":false},{"id":"ceh6xuk5","title":"Aviation","content":"Aviation\n\n\n* 2oz gin\n* 1/2oz maraschino liqueur\n* 1/2oz créme de violette\n* 3/4oz lemon\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"mhomkqbh","title":"B","content":"","children":[{"id":"mt95j3bs","title":"Black Magic Mararita","content":"Black Magic Mararita\n\n\n* 2oz tequila\n* 1oz lime\n* 3/4oz triple sec\n* 1/2oz simple syrup\n* 1/4tsp black sparkle sugar\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"rozfbbml","title":"Bloody Mary","content":"Bloody Mary\n\n\n* 4oz tomato juice\n* 2oz vodka\n* 1 lemon\n* 2 dashes Worcestershire sauce\n* 2 dashes hot sauce\n* 1 pinch salt\n* 1 pinch black pepper\n\nDirections\nPour all ingredients into a glass. Stir. Strain into a glass with ice in it.","children":[],"expanded":false},{"id":"7hhubpyh","title":"The Bees Knees","content":"The Bees Knees\n\n\n* 2oz gin\n* 1oz fresh lemon juice\n* .75oz honey simply syrup (Or 1/2 amt of honey\n\nDirections\nPour gin into mixer. Add honey and stir. Add the other ingredients with ice,\nshake. Strain into glasses and serve.\n\nOptional: Add 1.5oz orange.","children":[],"expanded":false}],"expanded":false},{"id":"igcuxcbk","title":"C","content":"","children":[{"id":"7x19jzgv","title":"Campari Sour","content":"Campari Sour\n\n\n* 2oz gin\n* 3/4oz campari\n* 3/4oz lemon\n* 1/2oz (Or 1/8-1/4 tspoon sugar)\n* 1 egg white\n* dash of orange bitters\n* orange wedge to garnish\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"5kfub7oi","title":"Cosmo","content":"Cosmo\n\n\n* 1 1/2oz citrus vodka\n* 3/4oz Cointreau\n* 3/4oz cranberry juice\n* 1/2oz lime\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"l4xd4wuw","title":"Cranberry Gin Fizz","content":"Cranberry Gin Fizz\n\n\n* 2oz gin\n* 2oz cranberry juice\n* 2oz club soda\n* fresh cranberries (garnish)\n* lime wedges (garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Garnish.","children":[],"expanded":false},{"id":"rag9qjfu","title":"Crimson Cosmo","content":"Crimson Cosmo\n\n\n* 2oz empress elderflower rose gin\n* 1/2oz cointreau\n* 1/2oz lime\n* Spoon of raspberry preserves\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"oytccy7g","title":"D","content":"","children":[{"id":"ch9cgg86","title":"Daiquiri","content":"Daiquiri\n\n\n* 2oz white rum\n* 3/4oz simple syrup\n* 3/4oz lime juice\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"ljty55tf","title":"E","content":"","children":[{"id":"qnb3y1vb","title":"Elderflower Empress Sour","content":"Elderflower Empress Sour\n\n\n* 2oz Empress gin\n* 1/2oz elderflower liqueur\n* 1/2oz simple syrup (Or about 1/3 tspoon sugar)\n* 1oz lemon\n* 1 egg white\n\nDirections\nAdd ingredients to a shaker with ice. Shake until ice is nearly gone. Pour\ninto glass.","children":[],"expanded":false},{"id":"wkr0nxk3","title":"Eldritch Artifaktt","content":"Eldritch Artifaktt\n\n\n* 2oz rumzcal\n* 1oz lime\n* 2oz grapefruit\n* 1/4oz cinnamon\n* 1/2oz jasper's\n* 1/4 marchino\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a flute glass. Top\nwith proseco and garnish with lemon peel or similar.","children":[],"expanded":false},{"id":"fsjdpq6d","title":"Empress","content":"Empress\n\n\n* 2oz Empress gin\n* 3/4oz lemon\n* 3/4oz simple syrup (Or 1/3 teaspoon sugar, crushed)\n* 1 egg white\n\nDirections\nAdd ingredients to a shaker with ice. Shake until ice is nearly gone. Pour\ninto glass.","children":[],"expanded":false},{"id":"e34bej60","title":"Empress Gin Sour","content":"Empress Gin Sour\n\n\n* 2oz Empress gin\n* 1/2oz simple syrup (Or about 1/3 tspoon sugar)\n* 1oz lemon\n* 1 egg white\n\nDirections\nAdd ingredients to a shaker with ice. Shake until ice is nearly gone. Pour\ninto glass.","children":[],"expanded":false},{"id":"2ghhlzl5","title":"Espresso Martini","content":"Espresso Martini\n\n\n* 2oz vodka\n* 1oz Kahlua\n* 1oz espresso, cooled\n* 1/2 simple syrup (Or 1/4 teaspoon sugar, crushed)\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"u9sar7lc","title":"Evergreen Fizz","content":"Evergreen Fizz\n\n\n* 2oz empress gin\n* 1oz lime\n* 1/2oz rosemary cranberry syrup\n* pinch cinnamon\n* pinch clove\n* top with club soda\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"ckdaxlfn","title":"F","content":"","children":[{"id":"hvjvcadc","title":"Fairy Godmother","content":"Fairy Godmother\n\n\n* 1oz absinthe\n* 3/4oz elderflower liqueur\n* 3/4oz pineapple juice\n* 1/2oz lemon\n* 1/2oz lime\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"qvq70ssz","title":"Falling For You","content":"Falling For You\n\n\n* 2oz Empress gin\n* 3/4oz lemon\n* 1oz spiced apple cider\n* 1 egg white\n* persimmon puree\n* sparkling apple juice to top\n* cinnamon\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.\nAdd sparkling apple juice.","children":[],"expanded":false},{"id":"see993bi","title":"French 75","content":"French 75\n\n\n* 2oz gin\n* 1/2oz lemon\n* 1/2oz simple syrup\n* 3oz champagne\n\nDirections\nAdd gin, lemon, simple syrup to a shaker with ice. Shake. Strain into flute. Add\nchampagne and garnish.","children":[],"expanded":false},{"id":"1rgydv02","title":"Fuzzy Lime","content":"Fuzzy Lime\n\n\n* 2oz gin\n* 1oz elderflower liqueur\n* 1oz lime\n* 3oz prosecco\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass. Add prosecco.","children":[],"expanded":false}],"expanded":false},{"id":"jmf08jts","title":"G","content":"","children":[{"id":"4i2cklqo","title":"Ghostly Paloma","content":"Ghostly Paloma\n\n\n* 2oz tequila\n* 1/2oz lime\n* 2oz grapefruit\n* 1/2oz simple syrup\n* 2oz club soda\n* black sanding sugar\n\nDirections\nAdd tequila, lime, grapefruit, simple syrup to a shaker.\nShake.\nStrain into glasses.\nAdd club soda.\nAdd black sugar to rim.","children":[],"expanded":false},{"id":"xrajarwn","title":"Gunpowder Fig","content":"Gunpowder Fig\n\n\nFig and Rosemary Syrup\n\n* 10oz dried black mission figs equal to 2 cups\n* 3 cups water sugar as needed\n* 2 sprigs fresh rosemary Gunpowder\n\nDirections\n\n* Chop the dried figs into small pieces.\n* Transfer the figs to a saucepan and add the water.\n* Bring to a simmer over high heat. Cover, turn the heat to low, and let the figs simmer for 20 minutes.\n* Keep covered to avoid evaporation. If desired, press the figs with a potato masher to break them down even further.\n* Place a fine mesh strainer over a large measuring cup.\n* If the strainer isn't fine then line it with cheesecloth to catch the tiny seeds.\n* After 30 minutes, strain the liquid from the figs into the measuring cup.\n* Discard the figs.\n* Measure the remaining liquid. There should be between 1 1/2 to 2 cups of liquid.\n* Pour the fig liquid into a clean saucepan.\n* Add an equal amount of sugar to the liquid. Bring back to a simmer, stirring until the sugar is dissolved.\n* Add the rosemary sprigs then cover and remove from the heat. Let the rosemary steep for 15 minute. Discard the rosemary.\n* Let the syrup cool completely before using. The fig and rosemary syrup should last between 2 to 3 weeks in the fridge.\n\nFig and Rosemary Cocktail\n\n* 1 1/2oz Gunpowder Irish Gin or other gin of choice\n* 1oz Fig and Rosemary Syrup\n* 1/2oz lemon juice extra fresh rosemary sprigs\n\nDirections\n\n* In a cocktail shaker combine the Gunpowder gin, fig and rosemary syrup, and lemon juice.\n* Add ice, cover, and shake for 10 to 15 seconds.\n* Strain into a Nick and Nora, or coupe, glass.\n* Add a sprig of rosemary.\n* Light the rosemary using a lighter or match and let the flame burn out. Serve immediately and enjoy!","children":[],"expanded":false},{"id":"0wxgvtkl","title":"Gin Swizzle","content":"Gin Swizzle\n\n\n* 2oz gin\n* 1 1/2oz lime\n* sugar\n* dash of bitters\n* 3oz club soda\n\nDirections\nMix ingredients in a shaker with ice. Shake and strain into a glass, add club\nsoda.","children":[],"expanded":false}],"expanded":false},{"id":"rfzcz5qe","title":"H","content":"","children":[{"id":"4wc2d93i","title":"Hanky Panky","content":"Hanky Panky\n\n\n* 2oz gin\n* 1oz sweet vermouth\n* 2 dashes Fernet-Branca\n* 1 dash orange juice\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"j1alf80d","title":"Holiday Negroni","content":"Holiday Negroni\n\n\n* 2oz gin\n* 1.5oz sweet vermouth\n* 1.5oz campari\n* orange peel (garnish)\n* rosemary sprigs (garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Garnish.","children":[],"expanded":false},{"id":"68yzt40n","title":"Hot Gin Toddy","content":"Hot Gin Toddy\n\n\n* 2oz gin\n* 3/4oz lemon\n* 1 tspoon sugar\n* 2oz hot water\n\nDirections\nAdd ingredients to small cocktail glass. Crush sugar. Add hot water and stir.","children":[],"expanded":false},{"id":"o9ue1s93","title":"Hugo Spritz","content":"Hugo Spritz\n\n\n* 4oz Prosecco (luxury)\n* 1oz soda water\n* 1 sprig mint\n* 1/2oz elderflower liqueur\n\nDirections\nAdd elderflower and mint to a glass. Gently muddle and sit for 3 minutes. Add\nice, add soda water and prosecco.","children":[],"expanded":false},{"id":"lyd1bfbo","title":"Hurricane","content":"Hurricane\n\n\n* 4oz rum (Aged - or 2oz aged 2oz white)\n* 2oz passion fruit syrup\n* 1 tspoon sugar\n* 2oz lemon juice\n\nDirections\nAdd ingredients to small cocktail glass. Crush sugar. Add hot water and stir.","children":[],"expanded":false}],"expanded":false},{"id":"1esfoq0x","title":"K","content":"","children":[{"id":"3lz5avup","title":"Kamikaze","content":"Kamikaze\n\n\n* 2oz vodka\n* 1 1/2oz lime\n* 1 1/2oz cointreau (triple sec, orange liqueur)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"1cm2a1zr","title":"M","content":"","children":[{"id":"mo9r3rog","title":"Mai Tai","content":"Mai Tai\n\n\n* 1 1/2oz aged rum\n* 1/2oz orange liqueur (curacao, cointreau, Grand Marnier)\n* 3/4oz lime\n* 1oz orgeat syrup\n* 1/2 teaspoon simple syrup\n* 1/2oz dark rum floater\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass. Garnish with mint,\ncocktail cherry, or lime wedge.","children":[],"expanded":false},{"id":"bemhf001","title":"Margarita","content":"Margarita\n\n\n* 2oz tequila\n* 1oz orange liqueur (Triple sec)\n* 1oz lime\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"ypwbm6y5","title":"Marteani","content":"Marteani\n\n\n* 1 1/2oz Earl Grey tea-infused gin*\n* 3/4oz lemon juice, freshly squeezed\n* 1oz simple syrup\n* 1 egg white\n* Garnish: sugar rim\n* Garnish: lemon twist\n\nDirections\nAdd ingredients and ice to a shaker. Shake. Strain into a glass.","children":[],"expanded":false},{"id":"3w5wmn3m","title":"Midnight Fizz","content":"Midnight Fizz\n\n\n* 2oz gin\n* 1/2oz lime\n* 1/2oz orange liqueur\n* 1/2oz simple syrup\n* 1 egg white\n\nDirections\nAdd ingredients to a shaker - shake w/out ice for a while. Then shake with ice.\nServe classic or with ice, top off with seltzer water / club soda.","children":[],"expanded":false},{"id":"k5nx1z7y","title":"Mistletoe Gin Martini","content":"Mistletoe Gin Martini\n\n\n* 2oz gin\n* 1oz elderflower liqueur\n* 1/2oz lime\n* mint leaves (garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Garnish.","children":[],"expanded":false},{"id":"yrmgcrke","title":"Mojito","content":"Mojito\n\n\n* 5 mint leaves\n* 1oz lime\n* 1oz simple syrup (Or 1 teaspoon sugar, crushed)\n* 2oz white rum\n\nDirections\nAdd rum, sugar, and mint leaves to a shaker. Muddle. Add the other ingredients\nand ice. Shake. Strain into a glass.","children":[],"expanded":false},{"id":"kx8gpw35","title":"Moscow Mule","content":"Moscow Mule\n\n\n* 3oz vodka\n* 1/2oz lime\n* 4oz ginger beer (Cock n Bull)\n\nDirections\nAdd ingredients to a shaker. Shake. Strain into a glass.","children":[],"expanded":false}],"expanded":false},{"id":"2tmjjfaf","title":"O","content":"","children":[{"id":"6ybvpjbg","title":"Old Money","content":"Old Money\n\n\n* 3/4oz mezcal\n* 3/4oz reposado tequilla\n* 3/4oz st george spiced pear liqueur\n* 3/4oz lemon\n* 3/4oz honey syrup\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a glass.","children":[],"expanded":false},{"id":"727xf38i","title":"Orange Blossom","content":"Orange Blossom\n\n\n* 2oz gin\n* 1oz vermouth\n* 2oz orange\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"rxoyeks3","title":"Orange Crush","content":"Orange Crush\n\n\n* 2oz vodka or orange flavored vodka\n* 2oz triple sec\n* 1 orange\n* lemon / lime soda (optional)\n\nDirections\nMix ingredients in a shaker with ice. Shake and strain into a glass, optionally\nadd lemon/ lime soda.","children":[],"expanded":false},{"id":"hzxc7brb","title":"Orange Lime Gine Fizz","content":"Orange Lime Gine Fizz\n\n\n* 2oz gin\n* 1/2oz orange\n* 1oz lime\n* club soda\n\nDirections\nMix ingredients in a shaker with ice. Shake and strain into a glass, add club\nsoda.","children":[],"expanded":false}],"expanded":false},{"id":"ja0g5lwo","title":"P","content":"","children":[{"id":"5swbfk21","title":"Pisco Sour","content":"Pisco Sour\n\n\n* 3oz pisco\n* 1oz lime\n* 1oz simple syrup\n* 1 egg white\n* Agnostura bitters for garnish\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"ki3wr3yn","title":"Pomegranate French 75","content":" Pomegranate French 75\n\n\n* 4oz pomegranate juice\n* 2oz Empress 1908 Gin\n* 1oz fresh lemon juice\n* 1tsp sugar\n* Prosecco\n* Pomegranate seeds optional\n* Sprig of rosemary optional\n* Lemon slices optional\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.\nAdd Prosecco and garnishes.","children":[],"expanded":false},{"id":"omi54ygx","title":"Pomegranate Gin Sour","content":"Pomegranate Gin Sour\n\n\n* 2oz gin\n* 1oz pomegranate juice\n* 1/2oz lemon\n* 1/2oz simple syrup (or 1/4 spoon sugar)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"3r42x7cw","title":"Pomegranate Rosemary Gin Fizz","content":"Pomegranate Rosemary Gin Fizz\n\n\n* 2oz gin\n* 1oz pomegranate juice\n* 1oz tonic water\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"r8vhgt8x","title":"Pomelo Paloma","content":"Pomelo Paloma\n\n\n* 1 tsp salt and black pepper mix for rim\n* 2 cups ice\n* 1 1/2oz tequila\n* 1 lime\n* 1oz Pomelo Peppercorn syrup\n\nDirections\nRim a glass. Add ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"fe3pwwb0","title":"Procyon","content":"Procyon\n\n\n* 4oz Borghetti Espresso Liqueur\n* 2oz Plymouth Gin\n* 1/2oz Amaro\n* 1/2oz apricot liqueur\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a flute glass. Top\nwith proseco and garnish with lemon peel or similar.","children":[],"expanded":false},{"id":"l0mxyago","title":"Prosecco Gin Coctail","content":"Prosecco Gin Coctail\n\n\n* 1.5oz gin\n* .75oz lemon\n* .75oz simple syrup\n* 3oz prosecco\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a flute glass. Top\nwith proseco and garnish with lemon peel or similar.","children":[],"expanded":false}],"expanded":false},{"id":"c75fbjkr","title":"R","content":"","children":[{"id":"tmzto4sl","title":"Ramos Gin Fizz","content":"Ramos Gin Fizz\n\n\n* 2oz gin\n* 1oz heavy cream\n* 1 egg white\n* 3 drops orange flower water\n* 1/2oz simple syrup (Or 1/3 tsp sugar)\n* 1/2oz lemon\n* 1/2oz lime\n\nDirections\n* Mix ingrediants in a shaker.\n* Shake for 5mins.\n* Pour into tall slender glass.\n* Add club soda until the glass is over-full.","children":[],"expanded":false},{"id":"yz46s7k6","title":"Rice Martini","content":"Rice Martini\n\n\n* 2oz gin\n* 1oz sake\n* 0.5oz dry vermouth\n* 1tsp jasmine rice\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into martini glass. Add\nlemon peel, rice cracker or other garnish.","children":[],"expanded":false},{"id":"8z14zldd","title":"Rosemary Gimlet","content":"Rosemary Gimlet\n\n\n* 2oz gin\n* 1/2oz lime\n* 1/2oz rosemary simple syrup\n* rosemary sprigs (garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"jq7ya2sd","title":"Rosemary Martini","content":"Rosemary Martini\n\n\n* 1/3tsp sugar\n* 1 sprigs of fresh rosemary, plus 2 more for garnish\n* 1 medium blood orange(s), with one separate slice for garnish per cocktail\n* 2oz vodka\n* ice\n* splash of soda water to taste\n\nDirections\nAdd ingredients to shaker with ice. Shake. Strain into glass.\nAdd soda water.","children":[],"expanded":false},{"id":"mj9i7p8v","title":"Rum Collins","content":"Rum Collins\n\n\n* 2oz rum\n* 1/2oz simple syrup (Or 1 teaspoon sugar, crushed)\n* 1oz lime juice\n* 2oz soda water\n\nDirections\nAdd ingredients into a shaker with ice. Shake. Strain into a glass.","children":[],"expanded":false}],"expanded":false},{"id":"efipiov4","title":"S","content":"","children":[{"id":"asbrz91h","title":"Silvio's Spritz","content":"Silvio's Spritz\n\n\n* 1 1/2oz Aperol\n* 1/2 lemon\n* 1/2oz Pomelo Peppercorn syrup\n* 1oz sparkling wine\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Add sparkling\nwine.","children":[],"expanded":false},{"id":"yp8h7rev","title":"Southside","content":"Southside\n\n\n* 1oz lemon juice\n* 2oz gin\n* 1oz simple syrup (Or 1 teaspoon sugar, crushed)\n\nDirections\nAdd gin and mint leaves to shaker, muddle. Add the other ingredients and ice.\nShake. Strain into glass. ","children":[],"expanded":false},{"id":"ol5jsw4w","title":"Spiced Orange Gin Punch","content":"Spiced Orange Gin Punch\n\n\n* 2oz gin\n* 2oz orange juice\n* 1oz spiced simple syrup*\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.\n\n* Sugar, water, spices like cinnamon and clove","children":[],"expanded":false},{"id":"pm6az940","title":"Sunflower","content":"Sunflower\n\n\n* 2oz gin\n* 1oz cointreau\n* 1oz elderflower liqueur\n* 1oz lemon\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"1j03mvdh","title":"Spiced Chai Gin Sour","content":"Spiced Chai Gin Sour\n\n\n* 2oz Empress indigo gin\n* 2oz chai concentrate\n* 1oz lemon\n* 1 egg white\n* 1/2oz grenadine syrup\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false}],"expanded":false},{"id":"e435mk1p","title":"T","content":"","children":[],"expanded":false},{"id":"eki1b48z","title":"V","content":"","children":[{"id":"ohc165md","title":"Vesper","content":"Vesper\n\n\n* 3oz dry gin\n* 1oz vodka\n* 1/2oz Lillet blanc\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a glass. ","children":[],"expanded":false}],"expanded":false},{"id":"3mpktqka","title":"W","content":"","children":[{"id":"dkudq3wn","title":"Watermelon Jalop","content":"Watermelon Jalop\n\n\n* 2oz watermelon juice\n* 2oz silver tequila\n* 1oz lime\n* 1oz jalapeno simple syrup\n* 1oz simple syrup (Or 1/2 teaspoon sugar, crushed)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into a glass.","children":[],"expanded":false},{"id":"jadm6hkx","title":"White Cosmo","content":"White Cosmo\n\n\n* 3 cranberries (garnish)\n* 1/2tbs sugar (garnish)\n* 1 1/2oz citrus vodka\n* 1/2oz elderflower liqueur\n* 1oz cranberry juice\n* 1/4oz lemon\n\nDirections\nSkewer 3 cranberries and dust them with sugar. Gently tap off any excess sugar\nand set aside.\n\nIn a cocktail shaker filled with ice, pour the citrus vodka, elderflower\nliqueur, and white cranberry and lemon juices. Shake well.\n\nStrain into a chilled cocktail glass and garnish with the cranberry skewer.","children":[],"expanded":false},{"id":"i1omy0jr","title":"White Russian Eggnog","content":"White Russian Eggnog\n\n\n* 2oz coffee liqueur\n* 2oz vodka\n* 2oz eggnog\n* ground nutmeg (Garnish)\n\nDirections\nStir the coffee liqueur and vodka together in a glass with ice. Pour eggnog\nover the back of a spoon for layering. Garnish with nutmeg.","children":[],"expanded":false},{"id":"5z9vwfuu","title":"Wild Tim","content":"Wild Tim\n\n\n* 1 1/2oz vodka\n* 3/4oz Pomelo Peppercorn syrup\n* 1 1/2oz seltzer\n* sliced grapefruit or lemon garnish\n\nDirections\nAdd ice to a collins or old fashioned glass. Next add vodka and syrup to a\ncocktail shaker with ice. Shake and strain into prepared glass.","children":[],"expanded":false},{"id":"ohuurqib","title":"Winter Wonderland Gin and Tonic","content":"Winter Wonderland Gin and Tonic\n\n\n* 2oz gin\n* 2oz tonic water\n* 1/2oz elderflower liqueur\n* thyme (garnish)\n* lemon slices (garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Garnish.","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"uz297jwp","title":"Simple Goodness Sisters","content":"","children":[{"id":"3a8gkl8f","title":"B","content":"","children":[{"id":"4ivnh1ji","title":"Berry Daiquiri","content":"Berry Daiquiri\n\n\n* 2oz light rum\n* 1oz lime\n* 1/2oz SGS Berry Sage syrup\n\nDirections\nSugar rim the glass (Optional). Add ingredients to a shaker with ice. Shake.\nStrain into glass.","children":[],"expanded":false},{"id":"r078abuk","title":"Boozy Pops","content":"Boozy Pops\n\n\n* 1/2 cup lime\n* 1/2 cup SGS Cucumber Chile Lime syrup\n* 2 cups frozen mango or pineapple\n* 1 cup coconut milk (Or for less creamy, coconut water)\n\nDirections\nPlace all ingredients in a blender and puree until smooth. Pour into 4 popsicle\nsleeves, leaving at least 1\" empty at the top. Seal and freeze laying flat or\nstanding up straight for 6 hours or more. Serve alone or use them as garnish\nfor a cocktail. Stick to 4:1 mixer to alcohol so they freeze properly.","children":[],"expanded":false},{"id":"p7qgiz6p","title":"Brown Derby","content":"Brown Derby\n\n\n* 2oz bourbon\n* 1oz grapefruit juice\n* 1/2oz SGS Grapefruit Rosemary syrup\n* grapefruit twist\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Double strain into glass.","children":[],"expanded":false},{"id":"vyik9519","title":"Bushel & A Peck","content":"Bushel & A Peck\n\n\n* 1oz SGS Corn Syrup\n* 2oz corn whiskey\n* 6oz whole milk heated and frothed\n\nDirections\nHeat milk on a stove top froth it with a small whisk. Fill a mug with other\ningredients, add milk. Stir. Garnish with cinnamon sprinkle.","children":[],"expanded":false},{"id":"0p6a2cs6","title":"Buzz Button Gin","content":"Buzz Button Gin\n\n\n* 1 packet buzz buttons\n* 1 tsp lemon zest\n* 6oz gin\n\nDirections\nPlace the flowers and the lemon zest in a wide mouth jar with a lid.\nCover with gin. Cap the jar. Infuse for 1-2 weeks.\nStrain the spirit, pressing the flowers to further express them.\nLifespan 3-6 months.","children":[],"expanded":false}],"expanded":false},{"id":"qnf4spo7","title":"C","content":"","children":[{"id":"toid78tg","title":"Caipirinhia","content":"Caipirinhia\n\n\n* 2 large ice cubes\n* 2-3 lime wedges\n* 1 spoon cherry syrup\n* 2oz cachaca (light rum-adjacent)\n\nDirections\nIn a rocks glass, gently muddle the lime wedges with the cherry syrup.\nAdd the cachaca and ice cubes, stir until the glass is chilled to the touch.","children":[],"expanded":false},{"id":"7wk0mgsx","title":"Cascadian Hope Old Fashioned","content":"Cascadian Hope Old Fashioned\n\n\n* 2oz 100% rye whiskey\n* 1 spoon SGS Huckleberry Spruce Tip syrup\n* 1 dash aromatic bitters\n* 2 dashes citrus bitters\n* light splash of club soda\n* big ice\n* orange twist\n\nDirecions\nDash bitters into heavy bottom rocks glass. Add spoon of syrup. Add big ice and\npour whiskey over it. Gently swirl drink. Add club soda if desired. Rub twist\naround the inside of the glass rim. Twist orange twist over drink.\n\nFor a mocktail - double all ingredients.","children":[],"expanded":false},{"id":"hf1o4pjy","title":"Cherry Thyme Limeade 'The Kacey'","content":"Cherry Thyme Limeade 'The Kacey'\n\n\n* 1.5oz vodka\n* 1oz lime\n* 1 1/2oz SGS Cherry Lime Thyme syrup\n* 4oz club soda\n* thyme sprig (garnish)\n\nDirections\nAdd ingredients to shaker with ice. Shake. Pour into glass. Add club soda\nand garnish.","children":[],"expanded":false},{"id":"l4nsmlli","title":"Cranberry Dark & Stormy","content":"Cranberry Dark & Stormy\n\n\n* 1oz SGS Cranberry Rosemary syrup\n* 1 1/2oz dark spiced rum\n* 3oz ginger beer\n* 1 wedge of lime, cut into sixths\n* skewer of sugared cranberries (Garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Top with\nginger beer. Add garnish.","children":[],"expanded":false},{"id":"13g21j0g","title":"Cranberry Sangria","content":"Cranberry Sangria\n\n\n* 6 glasses of ice\n* 1 (6.7oz) bottle of SGS Cranberry Rosemary syrup\n* 1 (750ml) bottle dry red Spanish wine\n* 1 cup cranberries\n* 1/4 cup (2oz) Campari\n* 1 orange thinly sliced\n* 1 large Granny Smith apple, thinly sliced\n* 1 (750ml) bottle brute Champagne\n* 6 rosemary garnishes\n\nDirections\nCombine syrup, wine, and fruit in a large pitcher and soak them for 1 hour.\nChill. Just before serving add the Campari and ladle the chilled sangria evenly\ninto 6 glasses filled with ice. Add some fruit to each glass. Top with the\nchilled Champagne.","children":[],"expanded":false},{"id":"8vfp9jti","title":"Cucumber Chile Margarita","content":"Cucumber Chile Margarita\n\n\n* 1/4 orange\n* 2oz tequila\n* 3/4oz lime\n* 1/2oz SGS Cucumber Chile Lime\n* Salt to rim (Optional)\n* marigold or calendula flower (Garnish)\n\nDirections\nRim a glass with salt. Add orange to shaker and muddle. Add ingredients to a\nshaker with ice. Shake. Strain into glass. Add ice to glass.","children":[],"expanded":false}],"expanded":false},{"id":"choda3lc","title":"E","content":"","children":[{"id":"c4eclkpj","title":"Elecrolyte Cooler","content":"Elecrolyte Cooler\n\n\n* pinch margarita salt\n* 1oz SGS Jalapeno Lime syrup\n* 1oz lime\n* 3oz coconut water or water\n* 3oz seltzer water\n* 1 jalapeno\n\nDirections\nSlice jalapeno. Muddle one slice, add to shaker. Add syrup, lime, coconut\nwater. Shake with ice.\n\nPour into salt rimmed glass, add seltzer water.","children":[],"expanded":false},{"id":"ttfg8dwt","title":"Espresso Martini","content":"Espresso Martini\n\n\n* 2oz vodka\n* 1ox espresso / cold brew espresso\n* 1/4oz SGS The Coffee syrup\n\nDirections\nAdd ingredients to a shaker with ice. Shake until ice is nearly gone. Pour\ninto glass.","children":[],"expanded":false},{"id":"bx8ykxlh","title":"Flora & Fauna Dora","content":"Flora & Fauna Dora\n\n\n* 2oz gin\n* 1oz lime\n* 1/2oz Huckleberry Spruce Tip syrup\n* ginger beer to top\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Top with\nginger beer.","children":[],"expanded":false},{"id":"20392c8p","title":"Fresh 75","content":"Fresh 75\n\n\n* 1/2oz SGS Huckleberry Spruce Tip syrup\n* 3/4oz lemon\n* 2oz champagne\n* lemon twist\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Pour into glass. Add champagne.","children":[],"expanded":false}],"expanded":false},{"id":"kt3ycogc","title":"G","content":"","children":[{"id":"q1iltnpz","title":"Gin Fizz","content":"Gin Fizz\n\n\n* 2oz gin\n* 1oz lemon\n* 3/4oz SGS Rhubarb Vanilla Bean (Or Lemon Herb) syrup\n* 1 egg white\n* club soda\n\nDirections\nAdd ingredients and ice to shaker. Shake. Pour into glass. Top is club soda.","children":[],"expanded":false}],"expanded":false},{"id":"eiivq1vn","title":"H","content":"","children":[{"id":"3l7w4iwj","title":"Hay Shandy","content":"Hay Shandy\n\n\n* 12oz chilled light beer\n* 1oz+ SGS Lemon Herb syrup\n* 1oz lemon\n* rosemary sprig, garnish\n\nDirections\nPour beer into glass. Add lemon and syrup. Stir.","children":[],"expanded":false},{"id":"l2ntc9yn","title":"Headin' South","content":"Headin' South\n\n\n* 2oz blended whiskey\n* 3/4oz SGS Peach Basil syrup\n* 1/4oz lemon\n* 3oz club soda\n* glass full of ice\n\nDirections\nInfuse whiskey, if desired, by rough chopping 1 cup of peaches and adding these\nto a bowl with 750ml whiskey. Refrigerate for 2 days, then strain and store in\na labeled bottle.\n\nAdd ingredients to shaker with ice. Shake. Pour into glass, top with club soda.","children":[],"expanded":false},{"id":"gfjz34bz","title":"Hippies & Cowboys","content":"Hippies & Cowboys\n\n\n* 2oz huckleberry vodka, or bourbon\n* 1/2oz SGS Huckleberry Spruce Tip syrup\n* 3/4oz lime\n* smoking sage leaf\n\nDirections\nAdd ingredients to a cocktail shaker with ice. Shake. Pour into an old\nfashioned glass.","children":[],"expanded":false},{"id":"rhouhgt9","title":"Hucking Send It Slushies","content":"Hucking Send It Slushies\n\n\n* 1oz lemon\n* 2oz Huckleberry Spruce Tip syrup\n* 20oz frozen lemonade\n* 4cups ice\n* 9oz vodka\n* granulated sugar\n\nDirections\nCombine fresh lemon juice and syrup in a small bowl, stir. In a blender,\nblend frozen lemonade, ice, and vodka. Rim 4 glasses with sugar. Add a\nspoonful of the lemon syrup mix to the bottom of each glass, top with slushy,\nadd another spoonful of mix on top. Garnish with blueberries.","children":[],"expanded":false},{"id":"yiorivoa","title":"Huckleberry Crush","content":"Huckleberry Crush\n\n\n* 2oz bourbon\n* 1/2 lemon cut into wedges\n* 3/4oz Huckleberry Spruce Tip syrup\n* Sparkling wine to top\n\nDirections\nCombine bourbon, lemon wedges, and syrup in old fashioned glass. Muddle the\nlemon. Top with ice to fill glass. Top with sparkling wine.","children":[],"expanded":false},{"id":"uztiepih","title":"Huckleberry Spruce Tip Old Fashioned","content":"Huckleberry Spruce Tip Old Fashioned\n\n\n* 2oz bourbon\n* 1 barspoon SGS Huckleberry Spruce Tip syrup\n* 1 dash citrus bitters\n* 1 dash aromatic bitters\n* plash of club soda\n* orange twist\n\nDirections\nIn a heavy bottom rocks glass dash the bitters to the bottom. Add syrup and\nstir. Add big ice and pour bourbon over it. Gentle swirl. Add splash of club\nsoda. Rub twist around the inside of the rim of the glass. Twist the twist\nover the drink. Garnish.","children":[],"expanded":false},{"id":"z6o9hxsx","title":"Hunter's Widow","content":"Hunter's Widow\n\n\n* 2oz vodka\n* 4oz ginger beer\n* 3/4oz SGS Pear syrup\n* 1/4 lime\n\nDirections\nAdd ice to a mule mug. Add vodka and ginger beer. Stir. Add syrup and stir\nlightly. Squeeze in lime. Garnish with rosemary sprig, pear slice, grated\nnutmeg or cinnamon.\n\nMocktail\nIncrease the amount of ginger beer, or add some pear juice or cider.","children":[],"expanded":false}],"expanded":false},{"id":"zvyr1247","title":"K","content":"","children":[{"id":"y2j8pv70","title":"Kahlo","content":"Kahlo\n\n\n* 2oz tequila\n* 1/2oz lime\n* 1/2oz chartreuse (Green)\n* 3/4oz SGS Blueberry Lavender syrup\n* salt for rim\n* 1oz grapefruit juice\n\nDirections\nRim the glass. Add (Or make crushed ice) to the glass. Add ingredients to a\nshaker with ice. Shake. Strain into glass. Pour into the glass, add grapefruit\njuice. Stir once.","children":[],"expanded":false}],"expanded":false},{"id":"ltee5pln","title":"L","content":"","children":[{"id":"vmjzysfn","title":"Lemon Drop or Huckleberry Drop","content":"Lemon Drop or Huckleberry Drop\n\n\n* 2oz huckleberry vodka\n* 1/2oz SGS Lemon Herb or Huckleberry Spruce Tip syrup\n* 3/4oz lemon\n* Huckleberry sugar (Rimming)\n\nDirections\nRim the glass. Add ingredients to a shaker with ice. Shake. Pour into glass.","children":[],"expanded":false},{"id":"oj2pdsal","title":"Lemon Herb New York Sour","content":"Lemon Herb New York Sour\n\n\n* 2oz whiskey\n* 1oz lemon\n* 1/2oz SGS Lemon Herb syrup\n* 1/2oz wildflower honey\n* 1/2oz fruity red wine\n* herb bouquet (Garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Pour into glass. Pour wine over\na spoon. Garnish.","children":[],"expanded":false}],"expanded":false},{"id":"em8a6svk","title":"M","content":"","children":[{"id":"a5keh3kg","title":"Maize Margarita","content":"Maize Margarita\n\n\n* 1oz SGS Corn Syrup\n* .5oz mezcal\n* .75oz vodka\n* .5oz Nixta Licor de Elote or Farm Club \"Not Nixta\"\n* 1oz lime\n* 1tsp Tajin or SGS Spicy Floral Salt\n\nDirections\nRim glass with salt.\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"vw89rd8m","title":"Marionberry Mojito","content":"Marionberry Mojito\n\n\n* 2oz light rum\n* 3/4oz lime\n* 1/2oz SGS Marionberry Mint syrup\n* 3oz club soda\n\nDirections\nAdd ingrediants to shaker with ice. Shake. Pour into glass. Add club soda.\nGarnish with mint etc.","children":[],"expanded":false},{"id":"82r143uq","title":"Mocktail","content":"Mocktail\n\n\n* ice, cubed\n* 1oz SGS syrup\n* .5oz citrus\n* 5oz club soda\n* 1-2 dashes bitters\n\nDirections\nAdd ingredients to shaker with ice. Shake. Pour into glass, top with club\nsoda and bitters.","children":[],"expanded":false},{"id":"mtpe7e6d","title":"Mowich Mule with Spiced Lime Shrub","content":"Mowich Mule with Spiced Lime Shrub\n\n\n* 2oz vodka\n* 1/2oz SGS Spiced Lime Shrub\n* 2 dashes cardamom bitters\n* 1/6 wedge of lime (Juice)\n* 3oz club soda\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Add club soda.","children":[],"expanded":false},{"id":"8qjwx4m9","title":"Mule for Rachel","content":"Mule for Rachel\n\n\n* 2oz liquor\n* 1/2oz SGS Huckleberry Spruce Tip syrup\n* 1/2oz lime\n* 2oz club soda\n* 2oz ginger beer\n* 2 large ginger beer ice cubes\n\nDirections\nAdd ingredients to shaker of ice. Shake. Pour into glass. Add the ginger beer\nice. Add club soda and ginger beer.","children":[],"expanded":false},{"id":"njpfk9d5","title":"Mulled Wine with Cider","content":"Mulled Wine with Cider\n\n\n* 12oz apple cider (Not spiced)\n* 1 bottle red wine\n* 2oz SGS Apple Pie syrup\n* 2tsp SGS Mulling Spices blend\n\nDirections\nCombine all ingredients in large sauce pan and bring to a low boil. Lower to\na simmer for 10 minutes. Taste, if spiced flavor is good, remove the spices.","children":[],"expanded":false},{"id":"dhvyshp1","title":"My Irish Cousin","content":"My Irish Cousin\n\n\n* 8oz brewed coffee\n* 1 1/2oz Cocoa Bomb whiskey (Or 1 1/2oz whiskey, 1tsp chocolate sauce)\n* 1/2oz SGS coffee syrup\n* 1oz half and half\n* whipping cream (Optional)\n\nDirections\nAdd all ingredients to a mug. Stir. Top with whipping cream and sprinkle cocoa\npowder.\n\nCreamy Hot Chocolate\nReplace coffee with hot chocolate. Replace whiskey with dark rum. Omit the\nhalf and half.","children":[],"expanded":false}],"expanded":false},{"id":"5oj3dbaa","title":"N","content":"","children":[{"id":"52tb73p2","title":"Not Nixta","content":"Not Nixta\n\n\n* 2oz brown sugar\n* 2oz water\n* 4oz mezcal\n* 2oz Grand Marnier\n* 2ears of corn: one roasted with the entire cob, kernels, husk, and silks - and one fresh ear of kernels cut from the cob - total 3/4 cup\n* sprinkle of cinnamon\n\nDirections\nAdd sugar, water, mezcal, and Grand Marnier to a wide mouth quart sized mason\njar. Remove husks and silks from one cob of corn and add these to the jar.\nRoast the corn evenly on all sides, turning as you go, until some of the char\nmarks show on the corn. When cooled cut the kernels off the cob and add them\nto the jar. Break the cob in half and add it. Remove silks and husks from the\ntwo more ears of fresh corn and discard these. Cut the kernels off the cob and\nadd them to the jar. Sprinkle in spices, shake the jar. Let it sit for at least\n24 hours (7 days for deepest flavor). Strain the liquid through a fine mesh\nsieve and store it, sealed and labeled, in a cool place for 6 months or more.","children":[],"expanded":false}],"expanded":false},{"id":"d4zw98md","title":"O","content":"","children":[{"id":"qkv00vtj","title":"Oh My Gourd Iced Coffee","content":"Oh My Gourd Iced Coffee\n\n\n* 6oz cold brew coffee (Pre-diluted)\n* 3/4oz - 1 1/2oz SGS Oh My Gourd syrup\n* 1oz half and half\n* cold foam (Optional)\n\nDirections\nAdd ice and coffee to a tall glass. Add syrup and stir. Add more to taste.\nPour cream over. Garnish with fresh grated nutmeg.","children":[],"expanded":false},{"id":"uyhf4bbh","title":"Orange Creamsicle Shake","content":"Orange Creamsicle Shake\n\n\n* 6oz orange juice\n* 2oz rum or vodka\n* 1/4 cup Orange Vanilla syrup\n* 3/4oz heavy cream or milk\n* 1 cup of ice\n\nDirections\nAdd all ingredients to a blender, blend for 1 minute or until smooth. Serve\nwith a straw.","children":[],"expanded":false},{"id":"6c0iydmw","title":"Orange Julio","content":"Orange Julio\n\n\n* 2 dashes orange bitters\n* 2oz light rum\n* 1oz SGS Orange Vanilla syrup\n* 2oz orange juice (Save 1oz to top)\n* 3/4oz coconut cream (Or whipping cream)\n* nutmeg and orange peel flag to top, tiki umbrella\n\nDirections\nAdd ice to glass. Add ingredients to a shaker with ice. Shake for a full\nminute. Strain into glass. Garnish.","children":[],"expanded":false},{"id":"ia0f4eqx","title":"Out on Phillips Head","content":"Out on Phillips Head\n\n\n* 2oz vodka\n* 1 1/2oz orange juice\n* 1/2oz SGS Orange Vanilla syrup\n* 3/4oz aperol\n* 1oz Prosecco (To top)\n* 2 thinly sliced orange slices (Garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass. Add ice, top\nwith Prosecco.","children":[],"expanded":false}],"expanded":false},{"id":"eviv57lz","title":"R","content":"","children":[{"id":"xaopyhwb","title":"Rally Cry","content":"Rally Cry\n\n\n* 2oz light rum\n* 3/4oz SGS Cherry Lime Thyme syrup\n* 4oz Coca Cola\n* 3 Orascella cherries - on toothpick\n\nDirections\nFill a tall glass with ice, add all ingredients and stir for 5 seconds.","children":[],"expanded":false},{"id":"q5nupcmz","title":"Ranch Water / Hard Seltzer","content":"Ranch Water / Hard Seltzer\n\n\n* 1oz tequila, vodka, or gin chilled\n* 1/2oz SGS syrup\n* 1 x 12oz glass bottle sparkling water, Topo Chico or Mineragua, chilled\n* 1/6 lime wedge\n* salt or sugar rim (Optional)\n\nDirections\nUncap and pour out 2oz. Rub the lime wedge along the rim. Shake salt or sugar\nonto the rim. Add liquor and syrup. Wedge lime into bottle. Squeeze lime juice\ninto the bottle before drinking.","children":[],"expanded":false},{"id":"zv9u0u8u","title":"Rosemary Greyhound","content":"Rosemary Greyhound\n\n\n* 2oz vodka\n* 1 1/2oz grapefruit juice\n* 3/4oz SGS Grapefruit Rosemary syrup\n* 2oz seltzer water\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Pour into glass. Add seltzer\nwater.","children":[],"expanded":false}],"expanded":false},{"id":"tvhn6rnz","title":"S","content":"","children":[{"id":"df7jetgf","title":"Simply Good Iced Coffee","content":"Simply Good Iced Coffee\n\n\n* 6oz cold brew coffee (Pre-diluted)\n* 1 1/2oz SGS The Coffee syrup\n* 2oz half and half\n\nDirections\nAdd ice to a tall glass. Add all ingredients and stir. Optional, top with cold\nfoam.\n\nCold Foam\nUsing a handheld frother mix 1tsp brown sugar, 1/4oz cinnamon, 1oz heavy\nwhipping cream, 1oz half and half.","children":[],"expanded":false},{"id":"r4q1d31o","title":"Something In the Orange Old Fashioned","content":"Something In the Orange Old Fashioned\n\n\n* 2oz rye whiskey or mezcal\n* 1 spoon SGS Orange Vanilla syrup\n* 3 dashes bitters\n* garnish cherry or orange twist\n* 1oz club soda optional\n\nDirections\nIn a heavy bottom rocks glass add bitters and syrup. Stir. Add large ice.\nPour bourbon over top. Stir. Add club soda and garnish.","children":[],"expanded":false},{"id":"0c3v7ynb","title":"Spicy Marg","content":"Spicy Marg\n\n\n* 1cup ice\n* 1tbs SGS Margarita salt\n* 1oz SGS Jalapeno Lime syrup\n* 2oz lime\n* 2oz tequila\n* 1/2oz triple sec (Or orange juice)\n\nDirections\nRim old fashioned glass with salt. Add ingredients and ice to shaker. Shake.\nPour into glass.","children":[],"expanded":false},{"id":"9gs9fpw4","title":"Spring Paloma","content":"Spring Paloma\n\n\n* 2oz tequila\n* 1/2oz lime\n* 3/4oz - 1oz SGS Grapefruit Rosemary syrup\n* 3oz seltzer water\n* salt for rimming\n\nDirections\nRim a glass. Add ingredients to shaker with ice. Shake. Pour into glass and\ntop with seltzer water. Garnish with sprig of rosemary.","children":[],"expanded":false}],"expanded":false},{"id":"hw3i56f4","title":"T","content":"","children":[{"id":"s7k7nzni","title":"That Dog'll Hunt","content":"That Dog'll Hunt\n\n\n* 2oz whiskey\n* 1oz apple cider\n* 1/2oz lemon\n* 1/2oz SGS Apple Pie syrup\n* 2 dashes citrus or sage bitters\n* Apple 'fan' (Garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into rocks glass with ice.\nGarnish with apple (Optional).","children":[],"expanded":false},{"id":"mp35pmeh","title":"Thicket","content":"Thicket\n\n\n* 2oz rye whiskey\n* 1/2 amaro\n* 1/2oz dry vermouth\n* 1/4oz SGS Cherry Syrup\n* 2 dashes agnostura bitters\n* 1 dash orange bitters\n* 1 lemon peel\n* 2cocktail cherries\n\nDirections\nIn a mixing glass, combine all ingredients and add ice until the glass is 3/4\nfull. Stir for 30 seconds and then strain into a chilled coupe.\nExpress a strip of lemon peel over the top of the glass. Rub it along the rim.\nTop cocktail with cherries on a toothpick.","children":[],"expanded":false},{"id":"p9pg5ba1","title":"Tomato Girl Summer","content":"Tomato Girl Summer\n\n\n* 2cups ice\n* 1tblsp SGS margarita salt\n* 1/2tsp black pepper, or cayenne pepper\n* 1 muddled tomato\n* 1/2oz SGS Jalapeno Lime syrup\n* 1/2oz lemon\n* 2oz vodka\n* 1sprig thyme or basil or cilantro\n\nDirections\nMix salt with pepper on shallow dish - to rim the glass.\nCombine ingredients in a shaker with ice. Shake. Pour into salt rimmed glass.\nTop with herbs.","children":[],"expanded":false},{"id":"mxwz8ez4","title":"Twisted Tea","content":"Twisted Tea\n\n\n* 2oz tea infused vodka or bourbon\n* 1oz SGS syrup\n* 1/6 lemon wedge\n* 4oz cooled black tea (Or tea of your choice)\n* herb or citrus wedge (Garnish)\n\nDirections\nAdd ingredients to a shaker with ice. Squeeze lemon into shaker. Shake. Strain\ninto glass. Add tea. Garnish.","children":[],"expanded":false}],"expanded":false},{"id":"098wbw4m","title":"W","content":"","children":[{"id":"6wzbnpbe","title":"Whidbey Gin Rickey","content":"Whidbey Gin Rickey\n\n\n* 2oz gin\n* 1oz lime\n* 1oz SGS Cucumber Chile Lime\n\nDirections\nAdd ingredients to a shaker with ice. Shake. Strain into glass.","children":[],"expanded":false},{"id":"7a5glhtj","title":"Witches Brew Punch","content":"Witches Brew Punch\n\n\n* 1 1/2oz cranberry juice\n* 1/2oz lime\n* 1/2oz orange\n* 3/4oz SGS Pear or Oh My Gourd syrup\n* 2oz spiced rum, light rum, or vodka\n* dry sage\n\nDirections\nAdd ice to glass. Add ingredients to a shaker with ice. Shake. Strain into\nglass. Carefully light end of sage after microwaving it for 15secs, until dry\nbut not brittle.","children":[],"expanded":false}],"expanded":false},{"id":"ua5h2mtu","title":"Y","content":"","children":[{"id":"j0kyju8x","title":"You Belong Among the Wildflowers","content":"You Belong Among the Wildflowers\n\n\n* 1 large ice\n* 2oz wheat whiskey / rye whiskey\n* 3/4oz SGS Lemon Chamomile shrub\n* 1/2oz Hefeweizen beer (Optional)\n* lemon twist\n\nDirections\nAdd ingredients to mixing glass. Stir. Add large ice to heavy bottom rocks\nglass. Pour over the ice. Express lemon over drink.","children":[],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false},{"id":"tiz2cmdr","title":"Food","content":"","children":[{"id":"fy0z1g5u","title":"S","content":"","children":[{"id":"s5hlqb8p","title":"Serbian Ground Beef, Veggie, and Potato Bake","content":"Serbian Ground Beef, Veggie, and Potato Bake\n\n\n* 1 lb ground beef\n* 1 tbsp olive oil\n* 1 onion\n* 1 bell pepper\n* 2 celery stalks\n* 1 carrot\n* 1/2 tsp black pepper\n* 1/2 tsp salt\n* paprika\n* 1/2 tsp pepper flakes\n* 1 pinch cinnamon\n* 1 pinch cloves\n* 1/4 cup water\n* 2 tbsp red wine\n* 1 cube beef bouillon\n* 2 tbsp half and half\n* 2 potatoes (peeled and sliced)\n\nDirections\n\n** 01 **\nPreheat oven to 400f. Lightly grease a casserole dish.\n\n** 02 **\nCook and stir ground beef in a skillet over med heat until browned and crumbly,\ntransfer to a bowl\n\n** 03 **\nHeat oil in the same skillet. Add onion, bell pepper, celery, and carrot.\nSaute until tender. Return beef to the skillet season with paprika, black\npepper, salt, red pepper flakes, cinnamon, and cloves. Add bouillon stir\nuntil dissolved. Remove from heat and stir in half an half.\n\n** 04 **\nLayer 1/2 of the potatoes over the bottom of the prepared casserole dish. Pour\nbeef and vegetable mixture over potatoes, then layer remaining potatoes over\ntop.\n\n** 05 **\nCover the dish and cook in the oven until potatoes are tender (45mins).","children":[],"expanded":false}],"expanded":false},{"id":"csuy21xx","title":"T","content":"","children":[{"id":"4u52h8sf","title":"Tuna Fish Spaghetti","content":"Tuna Fish Spaghetti\n\n\n* 1 lb spaghetti\n* 12oz canned tuna\n* 2 cans cream of mushroom soup\n* 1 cup milk\n* 1 cup frozen peas\n* 2 cups shredded cheddar cheese - sharp\n* 1/2 cup bread crumbs\n* 2 tbs butter\n* 1 tsp onion powder\n* 1/2 tsp garlic powder\n* 1/2 tsp salt\n* 1/2 tsp black pepper\n\nDirections\n\n** 01 **\nPreheat oven to 375F (190C).\nCook the spaghetti according to the directions. Make sure it's el dente. Set\naside.\n\n** 02 **\nPrepare Sauce Base\nCombine 2 cans of mushroom soup and milk. Stir until smooth.\n\n** 03 **\nAdd Tuna and flavor.\nAdd tune to the sauce. Add seasoning and mix thoroughly.\n\n** 04 **\nCombine the spaghetti and sauce. Ensure it is thoroughly mixed.\n\n** 05 **\nLayer the mixture into an oven dish. 9x13\" works well.\n\n** 06 **\nSprinkle cheese over the top.\n\n** 07 **\nMix bread crumbs and melted butter. Cover the cheese coated mixture.\n\n** 08 **\nBake for 20-25 minutes - it should be bubbly a round the edges and the bread\ncrumb topping should be golden brown and crispy.\n\n** 09 **\nRest and serve.\nLet it rest for 5-10 minutes and then serve.","children":[],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false},{"id":"g07alepn","title":"Entertainment","content":"","children":[{"id":"23zvtpzz","title":"Books","content":"","children":[{"id":"4x2lvp5n","title":"French Books","content":"French Books\n\n\n* Malpertuis by Jean Ray\n* La Malvenue by Claude Seignolle\n* Le Locataire Chimérique by Roland Topor\n* Mademoiselle B by Maurice Pons\n* Le Horla by Buy de Maupassant\n\n","children":[],"expanded":false}],"expanded":false},{"id":"i33xe7qy","title":"Movies","content":"","children":[{"id":"ws0vgn8u","title":"Horror Movies to Watch","content":"Horror Movies to Watch\n\n\n* Becky\n* Bliss\n* Three Billboards in Ebbing Missouri\n* Wrath of Becky","children":[],"expanded":false},{"id":"1segii40","title":"Action Movies to Watch","content":"Action Movies to Watch\n\n\n* Ballerina","children":[],"expanded":false}],"expanded":false},{"id":"bgfmqpke","title":"Music","content":"","children":[{"id":"bssr4iyj","title":"Goth Music","content":"Goth Music\n\n\n* Corpus Delicti","children":[],"expanded":false}],"expanded":false},{"id":"lkqjbpxp","title":"Podcasts","content":"","children":[{"id":"od553nj8","title":"French Podcasts","content":"French Podcasts\n\n\n* We Love TFTC\n* 2 Heures de Perdues\n* Transfert\n\n","children":[],"expanded":false},{"id":"2rdlhsd4","title":"Story Form Podcasts","content":"Story Form Podcasts\n\n\n[ ] Malevolent\n    I was actually surprised by how much I liked this one and how into it I got. The sound design and story really draws you in.\n\n[ ] We're Alive\n    Yeah it's zombies, but it's really good. 166 episodes, long epic, so I listened often with other podcasts mixed in from time to time.\n\n[ ] Alice Isn't Dead\n    Thriller - dark and existential, Very Good Podcast\n\n[ ] Limetown\n    Dark dystopian mystery vibe, what happened to a perfect corporate built town, everyone vanished. Great listen\n\n[ ] Wolf 359\n    Space - Crew light years from earth, thriller scifi drama comedy - very good\n\n[ ] LifeAfter/The Message\n    A great listen.\n\n[ ] From Now\n    Spaceship appears 35 years after vanishing with survivor.\n\n[ ] Empty (universe)\n    Good Listen, Scifi, ship crew wakes up alone from cryosleep who knows when inthe future, are they alone in the universe?\n\n[ ] The White Vault\n    Was good, slow paced, but detailed.\n\n[ ] End of the world Josh Clark\n    Not drama, but informative discussion about existential crisis that can/will RL ruin our existence. Good Listen.\n\n[ ] LifeAfter\n    (Mac Rogers)\n\n[ ] Passenger List\n    (Radiotopia)\n\n[ ] The Program Audio Series\n\n[ ] Fourth Ambit\n\n[ ] Rabbits\n    (PNWS)\n\n[ ] The Cipher\n    (BBC4)\n\n[ ] The Black Tapes\n    (top tier if it had an ending; PNWS)\n\n[ ] Limetown\n\n[ ] TumanBay\n    (BBC4)\n\n[ ] Homecoming\n    (Gimlet)\n\n[ ] The Message\n    (Mac Rogers)\n\n[ ] Steal the Stars\n    (Mac Rogers)\n\n[ ] The Silt Verses\n    Well-produced and the environmental audio really adds to the experience.\n    In this horror/fantasy serial drama, Carpenter and Faulkner, two worshippers of an outlawed god, travel up the length of their deity’s great black river, searching for holy revelations.\n\n[ ] Knifepoint Horror\n    Strangely immersive and effective for a single-narrator anthology with minimal sound effects and music.\n\n[ ] Tales of supernatural suspense\n    by Soren Narnia.\n\n[ ] Angel of Vine\n    Really immersive and well-produced. Set up as a modern podcast sorting through recordings.\n    A present day journalist uncovers the audio tapes of a 1950s private eye who cracked the greatest unsolved murder mystery Hollywood has ever known... and didn’t tell a soul.\n\n[ ] The Lovecraft Investigations\n    Three Lovecraft stories told by way of a modern journalistic investigations. This one also feels in-step with something like Limetown. There is a larger linking narrative so make sure you start with The Case of Charles Dexter Ward.\n\n[ ] Video Palace\n    This feels like it fits a bit more into that Limetown vibe where there's an investigation unfolding.\n    When video collector Mark Cambria watches a mysterious VHS tape, he begins talking in his sleep in a language that doesn't exist. Mark and his girlfriend Tamra set out to investigate the tape's origin and find themselves caught up in a web of conspiracy, occult, and dread surrounding a legendary video store with a sinister purpose beyond imagining.\n\n[ ] Archive81\n    Another well-produced podcast. The first seasons feels like audio found footage horror and then each season changes direction. Starts weird and gets weirder but really immersive throughout.\n    Archive 81 is a fiction podcast about horror, cities, and the subconscious.\n\n[ ] The Walk\n    I've not listened to more than a minute or two of this one, but I remember it being really immersive as the listener is cast as the main character.\n    A thriller in which you, the listener, are the hero. The Walk begins in Inverness station, Scotland. Through a case of mistaken identity, you, \"the walker,\" are given a vital package that must be couriered to Edinburgh. But as you're about to board the train, terrorists blow it up and set off an electromagnetic pulse! None of the cars or trains are working - you'll have to walk - but now the terrorists are on your trail because they want the device you're carrying, and the police are after you as a suspect in the bombing. To survive, you'll have to join up with other escapees from the city - but how many of them can you trust, and are they really who they say they are?\n\n[ ] Spines\n    A girl wakes up covered in blood and no memory of what happened. Gets worse. Also has body horror and pretty dark themes.\n\n[ ] Edge of Sleep\n\n[ ] Old Gods Of Appalachia\n    Has me utterly gripped right now. It's so dark and spooky and scary, with such a deep sense of place, the creator/narrator has an amazing voice and I am deeply emotionally attached to at least two of the characters.\n\n[ ] I am in Eskew\n\n[ ] Vast Horizon\n\n[ ] The Earth Collective\n\n[ ] Janus Descending\n\n[ ] Rose Drive\n\n[ ] Ars Paradoxica\n\n[ ] Coexistence\n    (cinematic sci-fi that's almost too clever and well-produced. Haven't finished it yet.)\n\n[ ] WOE.BEGONE\n    (Horror/Mystery/Sci-fi) Immersive in a psychological way, if that makes sense, and a very creative entry in the ARG sub-genre.)\n\n[ ] Breakers\n\n[ ] Leviathan Chronicles\n    Genuinely surprised this hasn’t been listed. Not sure how to describe the genre. Think secret immortal race vs government vs world. Lots of action and story/world building. This is one of my favorite podcasts ever. I have listened to it multiple times over.\n\n[ ] Transister Rodeo\n\n[x] Unwell\n    A midwest gothic mystery. It's so good and funny and the characters feel real. The world they created feels very lived in and a character by itself. The story is great.\n\n[x] The Deca Tapes\n    Talk about MIND BLOWN! When everything started to come together, I was amazed. It's great.\n\n[x] Mirrors\n    Paranormal thriller sci-fi - set across generations of time, but they are connected. Good podcast, just started a new season.\n\n[x] Borassica\n    Thriller/mystery/horror I listened to this and I enjoyed it, some people critique the ending.\n\n[x] Deca Tapes\n\n[x] The Left Right Game\n    Really immersive and cinematic audio, but the creators relied on that a little too much at times, which made some things confusing and unclear. Still worth a listen though!\n    An idealistic young journalist trying to make a name for herself by following a group of paranormal explorers, obsessed with a seemingly harmless pastime known as the Left/Right Game. The journey takes her into a supernatural world that she and the other members of the expedition can neither handle nor survive.","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"q1pcb815","title":"Information","content":"","children":[{"id":"xzeun5ie","title":"Development","content":"","children":[{"id":"xdytwqsr","title":"Android","content":"","children":[{"id":"o4mzyvpk","title":"Onboarding - Flutter","content":"Onboarding - Flutter\n\n\n* [Install the SDK]\n  https://docs.flutter.dev/get-started/install/linux/android\n* [Add the SDK to PATH]\n  https://docs.flutter.dev/get-started/install/linux/android#add-flutter-to-your-path\n* [Setting up the Emulator for VSCode]\n  https://www.geeksforgeeks.org/how-to-set-up-an-emulator-for-vscode/","children":[],"expanded":false}],"expanded":false},{"id":"al0yeh3y","title":"Art","content":"","children":[{"id":"4pzxjjej","title":"Blender","content":"","children":[{"id":"046islqy","title":"Architecture","content":"Architecture\n\n\n[Beginner Interiors]\nhttps://www.youtube.com/watch?v=9pwtDYQbWpg","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"ctg2tzp1","title":"C++","content":"","children":[{"id":"0dftqk87","title":"Check For Memory Leaks","content":"Check For Memory Leaks\n\n\nValdrind - checks applications for memory leaks/issues.","children":[],"expanded":false}],"expanded":false},{"id":"2v2wo6oi","title":"C#","content":"","children":[{"id":"wwmgvtzs","title":"Installing VSCode on Linux","content":"","children":[{"id":"evwzcnm7","title":"Installing VSCode Itself","content":"Installing VSCode Itself\n\n\n[Download the .deb file]\nhttps://code.visualstudio.com/download\n\nDotnet Framework\n\nsudo apt update\nsudo apt install software-properties-common\nsudo add-apt-repository ppa:dotnet/backports\n\nRun These Commands\n\n# Get OS version info\nsource /etc/os-release\n\n# Download Microsoft signing key and repository\nwget https://packages.microsoft.com/config/$ID/$VERSION_ID/packages-microsoft-prod.deb -O packages-microsoft-prod.deb\n\n# Install Microsoft signing key and repository\nsudo dpkg -i packages-microsoft-prod.deb\n\n# Clean up\nrm packages-microsoft-prod.deb\n\n# Update packages\nsudo apt update\n\nInstall the SDK\n\nsudo apt install dotnet-sdk-8.0","children":[],"expanded":false},{"id":"4wsmc4n1","title":"My Preferred Plugins","content":"My Preferred Plugins\n\n\nPlugin \t             Description\n-------------------- -----------------------------------------------------------\n.NET Install Tool \t Manages .NET version installs.\n.NET MAUI \t         Enable MAUI capabilities in VSCode.\nAuto Hide \t         Automatically hides the side bar and the console panels.\nAvalonia for VSCode  GUI development tools for VSCode.\nC# \t                 C# support for VSCode.\nC# Dev Kit           Official C# extension kit from MS.\nDiff \t               Diff two open files.\nLabeled Bookmarks \t Allows for the creation of labelled bookmarks.\nVim \t               Vim hotkeys for VSCode","children":[],"expanded":false}],"expanded":false},{"id":"6n4ktptk","title":"GUI Tools","content":"GUI Tools\n\n\n[Avalon]\nhttps://www.avaloniaui.net/","children":[],"expanded":false}],"expanded":false},{"id":"6dtrpytw","title":"Html","content":"","children":[{"id":"cmjuk4o8","title":"Css","content":"","children":[{"id":"20erxurr","title":"Css Variables","content":"Css Variables\n\n\nExample:\n\n    :root {\n        --bg: #000;\n        --fg: #f5f5f5;\n        --muted: #9aa0a6;\n        --accent: #00d1b2;\n        --danger: #ff5577;\n        --sel-bg: #111827;\n        --border: #222;\n    }\n\n    .tree-dialog button {\n        padding: 8px;\n        background: var(--bg-alt, #222\\^^^func^^^\n        color: var(--fg\\^^^func^^^\n        border: 1px solid var(--border\\^^^func^^^\n        border-radius: 6px;\n        cursor: pointer;\n    }","children":[],"expanded":false}],"expanded":false},{"id":"eehahztf","title":"JavaScript","content":"","children":[{"id":"vfj0v3ov","title":"Debugging","content":"","children":[{"id":"3wv4abog","title":"Console Output","content":"Console Output\n\n\n[Console in JS]\nhttps://www.geeksforgeeks.org/javascript/console-in-javascript/","children":[],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false},{"id":"uo8iaphe","title":"Httree","content":"","children":[{"id":"ylqc9umv","title":"Current Httree Implementations","content":"Current Httree Implementations\n\n\nStandard\n* /home/baiguai/documents/development/websites/httree/httree/httree_help.html\n* /home/baiguai/documents/development/websites/hcjsuite/hcjsuite/*\n* /home/baiguai/documents/development/websites/vummel/vummel/vummel_help.html\n* /home/baiguai/documents/development/websites/worldweaver/WorldWeaverHtml/help.html\n* /home/baiguai/Documents/darkworld/plot.html\n\nNode\n* /home/baiguai/documents/notes/ht_notes.html\n* /home/baiguai/documents/development/video/killing_time/workflow/kt_notes.html\n* /home/baiguai/documents/development/video/dark-tales-with-the-wendigo/workflow/wnd_notes.html","children":[],"expanded":false}],"expanded":false},{"id":"j8k3odxu","title":"OS Development","content":"","children":[{"id":"9fy2i2lq","title":"OS Development Videos","content":"OS Development Videos\n\n\n[OS Development]\nhttps://www.youtube.com/watch?v=rr-9w2gITDM&list=PLBK_0GOKgqn3hjBdrf5zQ0g7UkQP_KLC3","children":[],"expanded":false}],"expanded":false},{"id":"1qmhuraz","title":"PHP","content":"","children":[{"id":"8mpfpcyu","title":"Setting Up a LAMP Server","content":"Setting Up a LAMP Server\n\n\n-- Installing Apache --\nsudo apt update\nsudo apt install apache2\n\n-- Installing MySql --\nsudo apt install mysql-server\n\n-- Installing PHP --\nsudo apt install php libapache2-mod-php php-mysql\n\n-- Installing PHPMyAdmin --\nsudo apt install phpmyadmin php-mbstring php-zip php-gd php-json php-curl\n\n\n-- Resources --\n[Install LAMP Stack]\nhttps://www.digitalocean.com/community/tutorials/how-to-install-lamp-stack-on-ubuntu#step-1-installing-apache-and-updating-the-firewall\n[Install PHPMyAdmin]\nhttps://www.digitalocean.com/community/tutorials/how-to-install-and-secure-phpmyadmin-on-ubuntu-20-04","children":[],"expanded":false}],"expanded":false},{"id":"asun87km","title":"Python","content":"","children":[{"id":"log30qf3","title":"Creating a Python Executable","content":"Creating a Python Executable\n\n\nInstall pyinstaller:\n\npip install pyinstaller\nor\npip install pyinstaller --break-system-packages\n\n\nBuild the binary:\n\npyinstaller --onefile main.py\npyinstaller --onedir main.py\n\n\nFor Linux:\npyinstaller -D -F -n main -c \"main.py\"","children":[],"expanded":false},{"id":"rigytgwd","title":"Example Projects","content":"Example Projects\n\n\n** General **\nhttps://hackr.io/blog/python-projects\n\n\n** GUI **\n* [Treeview]\n    https://www.pythontutorial.net/tkinter/tkinter-treeview/\n* [Grid Layout]\n    https://www.geeksforgeeks.org/python/python-grid-method-in-tkinter/\n* [Tables]\n    https://pythonguides.com/python-tkinter-table-tutorial/","children":[],"expanded":false},{"id":"aexh7xz1","title":"Pip Install Globally","content":"Pip Install Globally\n\n\nIf you need to install a global pip package without a venv, use:\n\npip install package_name --break-system-packages","children":[],"expanded":false},{"id":"i0b12wlp","title":"Virtual Environments","content":"Virtual Environments\n\n\nTo Create:\npython3 -m venv <directory>\n\nTo Activate:\nsource myvenv/bin/activate\n\nTo Deactivate:\ndeactivate","children":[],"expanded":false}],"expanded":false},{"id":"29ne3qge","title":"Rust","content":"","children":[{"id":"ldt7im73","title":"Rust Learning Links","content":"Rust Learning Links\n\n\nhttps://doc.rust-lang.org/stable/book/index.html\nhttps://learn.letsgetrusty.com/\nhttps://doc.rust-lang.org/stable/std/index.html","children":[],"expanded":false}],"expanded":false},{"id":"cjwooff7","title":"Shaders","content":"","children":[{"id":"5utjkw6p","title":"Getting Started with Shaders","content":"Getting Started with Shaders\n\n\n[Book of Shaders]https://thebookofshaders.com/04/\n\n[Intro to Shaders]https://www.youtube.com/watch?v=f4s1h2YETNY\n[Learn the Basics]https://www.youtube.com/watch?v=3mfvZ-mdtZQ","children":[],"expanded":false},{"id":"d8mq2btj","title":"Resources","content":"Resources\n\n\nResources presented in the video:\n• [Shadertoy]https://www.shadertoy.com/\n• Inigo Quilez website: https://iquilezles.org/articles/\n• 2D signed distance functions: https://iquilezles.org/articles/distf...\n• Color palette article: https://iquilezles.org/articles/palet...\n• Color palette webapp: http://dev.thi.ng/gradients/\n• Graphtoy: https://graphtoy.com/\n\nOther useful resources:\n• GLSL Reference & Swizzling: https://www.khronos.org/opengl/wiki/D...\n• The Book of Shaders: https://thebookofshaders.com/\n• Shadertoy Unofficial: https://shadertoyunofficial.wordpress...\n• Inigo Quilez's channel: ‪@InigoQuilez‬ \n• The Art of Code's channel: ‪@TheArtofCodeIsCool‬ \n\nShaders showcased in the intro:\n\n    \"Cloud Ten\" by nimitz: https://www.shadertoy.com/view/XtS3DD\n    \"Abstract Glassy Field\" by Shane: https://www.shadertoy.com/view/4ttGDH\n    \"For the neon style enjoyers\" by mrange: https://www.shadertoy.com/view/ddcGW8\n    \"Fractal Land\" by Kali: https://www.shadertoy.com/view/XsBXWt","children":[],"expanded":false}],"expanded":false},{"id":"n8rgzy55","title":"TW","content":"","children":[{"id":"63kiaukz","title":"Topics of Interest","content":"Topics of Interest\n\n\n[Tech Docs]\nhttps://talk.tiddlywiki.org/t/technical-documentation-for-user-tiddlywiki-app/14266/1","children":[],"expanded":false}],"expanded":false},{"id":"5zc8tlh5","title":"Video","content":"","children":[{"id":"5awcdddg","title":"Video Editing","content":"","children":[{"id":"qph3bui5","title":"DaVinci Resolve","content":"DaVinci Resolve\n\n\n[MakeResolveDeb]\nhttps://www.danieltufvesson.com/makeresolvedeb","children":[],"expanded":false},{"id":"iugyepmd","title":"My Computer Video Details","content":"My Computer Video Details\n\n\nVideo Card:\nNVIDIA GeForce RGX 5070 TI 16GB","children":[],"expanded":false}],"expanded":false},{"id":"05deskai","title":"Video Effects","content":"","children":[{"id":"m28spnu5","title":"Glitch Video Effects","content":"Glitch Video Effects\n\n\n\nLow Res and Glitchy\n* Open a terminal window - and size it so it's small (Or use a split Tmux window).\n* Run: mpv --vo=tct --profile=low-latency yourvideo.mp4\n* Screen record it.","children":[],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false},{"id":"d0824fai","title":"Family Stuff","content":"","children":[{"id":"3hox4ni3","title":"Roku","content":"","children":[{"id":"dpsyezll","title":"Reboot the Roku","content":"Reboot the Roku\n\n\nHome (x5)\nUp\nRewind (x2)\nForward (x2)","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"p5vz6oa6","title":"Git","content":"","children":[{"id":"eyh80x4a","title":"Debugging","content":"","children":[{"id":"csen6ut9","title":"Can't Log Into a New Repo","content":"Can't Log Into a New Repo\n\n\ngit config --global credential.helper store","children":[],"expanded":false}],"expanded":false},{"id":"nzc81l0x","title":"Completely Replace Git Branch","content":"Completely Replace Git Branch\n\n\ngit checkout branchB\ngit branch -mf main\ngit push --force -u origin main","children":[],"expanded":false},{"id":"banhk6ox","title":"Git Aliases","content":"Git Aliases\n\n\nMy Aliases\ngit config --global alias.brch 'branch --sort=-committerdate'\n\nViewing and Editing\ngit config --get-regexp ^alias","children":[],"expanded":false},{"id":"6smamlkw","title":"Git CLI Tool Installation","content":"Git CLI Tool Installation\n\n\nTo Install:\n(type -p wget >/dev/null || (sudo apt update && sudo apt-get install wget -y)) \\\n&& sudo mkdir -p -m 755 /etc/apt/keyrings \\\n&& wget -qO- https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg > /dev/null \\\n&& sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg \\\n&& echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \\\n&& sudo apt update \\\n&& sudo apt install gh -y\n\nTo Upgrade:\nsudo apt update\nsudo apt install gh","children":[],"expanded":false},{"id":"x4rbpbdo","title":"Git Commands","content":"Git Commands\n\n\nGIT Branch - Sorted DESC\n\tgit branch --sort=-committerdate\nAlias:\n\tgit config --global alias.brch 'branch --sort=-committerdate'","children":[],"expanded":false},{"id":"01dik1wq","title":"Git Config Files","content":"Git Config Files\n\n\nGlobal:\n~/.gitconfig\n\nLocal:\n.git/config","children":[],"expanded":false},{"id":"p88igpst","title":"Git Pull Request via CLI","content":"Git Pull Request via CLI\n\n\ngit pull origin main\n\ngit checkout main\n\ngit merge (your branch name)\n\ngit push -u origin main","children":[],"expanded":false},{"id":"5rhz4k54","title":"Git Remove Deleted Files","content":"Git Remove Deleted Files\n\n\ngit add -u\ngit push -u origin branch","children":[],"expanded":false},{"id":"t3wrnpdj","title":"Git Tags","content":"Git Tags\n\n\n[Tags Guide]\nhttps://www.slingacademy.com/article/working-with-git-tags-a-complete-guide-with-examples/","children":[],"expanded":false}],"expanded":false},{"id":"mrokjcfa","title":"Learning","content":"","children":[{"id":"84md3w9v","title":"Cyber Security","content":"","children":[{"id":"r30424ji","title":"Online Courses","content":"Online Courses\n\n\n[Coursera]\nhttps://www.coursera.org/learn/cybersecurity-for-everyone/lecture/V9wW7/foundations-an-introduction","children":[],"expanded":false},{"id":"3pcgrwjd","title":"To Learn","content":"To Learn\n\n\nSecurity Standards\n* OWASP\n* NIST\n\nCompliance Frameworks\n* SOC2\n* GDPR","children":[],"expanded":false}],"expanded":false},{"id":"1dyfc3g6","title":"Frameworks","content":"","children":[{"id":"gcsdq9r9","title":"Spring Boot","content":"Spring Boot\n\n\n[Geeks of Geeks]\nhttps://www.geeksforgeeks.org/spring-boot/","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"1l7m3lon","title":"Linux","content":"","children":[{"id":"a2huxagl","title":"Linux Mint","content":"","children":[{"id":"a3vtkbxa","title":"Upgrading Linux Mint","content":"Upgrading Linux Mint\n\n\nsudo apt-get update\nsudo mintupdate-cli upgrade -y","children":[],"expanded":false}],"expanded":false},{"id":"ssbu8apu","title":"MX Linux","content":"","children":[{"id":"3uv3sejr","title":"Updating","content":"Updating\n\n\nVia the console:\nsudo apt-get dist-upgrade","children":[],"expanded":false}],"expanded":false},{"id":"y22i9if4","title":"Current Linux Version Information","content":"Current Linux Version Information\n\n\n** See Your Linux Version **\ncat /etc/os-release\n\n** See Your Kernel Version **\nuname -r","children":[],"expanded":false},{"id":"8mvvoemo","title":"Rebuild","content":"","children":[{"id":"x79oh512","title":"Qutebrowser","content":"Qutebrowser\n\n\nInstallation / Upgrade\n\nGIT PULL:\ngit clone https://github.com/qutebrowser/qutebrowser.git\n\nDEPENDENCY INSTALLATION:\nsudo apt install --no-install-recommends git ca-certificates python3 python3-venv libgl1 libxkbcommon-x11-0 libegl1-mesa libfontconfig1 libglib2.0-0 libdbus-1-3 libxcb-cursor0 libxcb-icccm4 libxcb-keysyms1 libxcb-shape0 libnss3 libxcomposite1 libxdamage1 libxrender1 libxrandr2 libxtst6 libxi6 libasound2\n\nCREATE THE VIRTUAL ENV:\npython3 scripts/mkvenv.py\n\nTHE RUN SCRIPT:\n#!/bin/bash\n~/path/to/qutebrowser/.venv/bin/python3 -m qutebrowser \"$@\"","children":[],"expanded":false},{"id":"4qlkradb","title":"Rebuild Script","content":"Rebuild Script\n\n\n#!/bin/bash\n\nsudo add-apt-repository ppa:noobslab/indicators\n\nsudo apt-get update\nsudo apt-get install -y kupfer\nsudo apt-get install -y mpv\nsudo apt-get install -y samba\nsudo apt-get install -y cifs-utils\nsudo apt-get install -y hplip-gui\nsudo apt-get install -y lame\nsudo apt-get install -y homebank\nsudo apt-get install -y default-jre\nsudo apt-get install -y default-jdk\nsudo apt-get install -y vim-gtk3\nsudo apt-get install -y fzf\nsudo apt-get install -y sqlite3\nsudo apt-get install -y git\nsudo apt-get install -y opera-stable\nsudo apt-get install -y falkon\nsudo apt-get install -y python3\nsudo apt-get install -y python3.11-venv\nsudo apt-get install -y python3-pip\nsudo apt-get install -y irssi\nsudo apt-get install -y gthumb\nsudo dpkg --add architecture i386\nsudo apt-get install -y wine\n# Be sure to initially run Wine64 - so it's the one that sets up the environment.\nsudo apt install -y winehq-staging\nsudo apt-get install -y curl\nsudo apt-get install -y mc\nsudo apt-get install -y vifm\nsudo apt-get install -y flatpak\n# sudo apt-get install -y qutebrowser\nsudo flatpak install -y flathub engineer.atlas.Nyxt\nsudo flatpak install -y flathub com.github.hluk.copyq\nsudo apt-get install -y zoxide\nsudo apt-get install -y xclip\nsudo apt-get install -y ranger\nsudo apt-get install -y tmux\nsudo apt-get install -y ripgrep\nsudo apt-get install -y fd-find\nsudo apt-get install -y ttf-mscorefonts-installer\n\nsudo apt-get install -y nodejs\nsudo apt-get install -y npm\n\n\n# File sharing\nmkdir ~/documents\nsudo chmod -R 777 ~/documents\nsudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak\nsudo tee -a /etc/samba/smb.conf << END\n\n[documents]\npath = /home/baiguai/documents\nguest account = baiguai\nguest ok = yes\nbrowsable = yes\nread only = no\nwritable = yes\ncreate mode = 0777\ndirectory mode = 0777\n\nEND\nsudo service smbd restart\nsudo apt-get install -y libnss-winbind\nsudo systemctl start winbind\n# End file sharing section\n\n\n# i3\nsudo apt-get install -y i3\nsudo apt-get install -y feh\nsudo apt-get install -y rofi\nsudo apt-get install -y lxappearance\nsudo cp /media/baiguai/backup01/documents/information/linux/fonts/* /usr/share/fonts/truetype/\nmkdir ~/documents/images/dt/\ncp /media/baiguai/backup01/documents/information/linux/configs/i3/images/dt/blk.jpg ~/documents/images/dt/\ncp /media/baiguai/backup01/documents/information/linux/configs/i3/config ~/.config/i3\ncp /media/baiguai/backup01/documents/information/linux/configs/rofi/* ~/.config/rofi\ncp /media/baiguai/backup01/documents/information/linux/configs/neovim/* ~/.config/nvim\n\nsudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.sh | sudo sh /dev/stdin\n\nsudo curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl\nsudo chmod a+rx /usr/local/bin/youtube-dl\n\n\n# Qutebrowser\nmkdir ~/qutebrowser\ncd ~/qutebrowser\ngit clone https://github.com/qutebrowser/qutebrowser.git\ncd ./qutebrowser\npython3 ./scripts/mkvenv.py\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/qutebrowser/qb.sh ~/\nsudo chmod +x ~/qb.sh\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/qutebrowser/qutebrowser.desktop /usr/share/applications\n\n\n\n# NeoVim\nmkdir ~/neovim\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/neovim/* ~/neovim\n\n# TMUX Sessions\nmkdir ~/tmux\ncp /media/baiguai/backup01/documents/information/linux/scripts/tmux/* ~/tmux\n\n\n# Yazi\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n# cargo build --release\nmkdir ~/yazi\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/yazi/git-repo/target/release/* ~/yazi\nmkdir /home/baiguai/.config/yazi\ncp /media/baiguai/backup01/documents/information/linux/configs/yazi/* /home/baiguai/.config/yazi\nsudo cp /media/baiguai/backup01/documents/information/linux/binaries-scripts/yazi/SymbolsNerdFont-Regular.ttf /usr/share/fonts/truetype\nsudo cp /media/baiguai/backup01/documents/information/linux/binaries-scripts/yazi/SymbolsNerdFontMono-Regular.ttf /usr/share/fonts/truetype\n\n# LF\nmkdir /home/baiguai/.config/lf\ncp /media/baiguai/backup01/documents/information/linux/configs/lf/* /home/baiguai/.config/lf\n\n\nsudo cp ~/.bashrc ~/.bashrc.bak\nsudo tee -a ~/.bashrc << END\n\n# export EDITOR=nvim\nexport MANPAGER='nvim +Man!'\n\nalias nvim=/home/baiguai/neovim/nvim.AppImage\nalias nmxj=\"cd /home/baiguai/nmxj;sh _run.sh\"\nalias nmx=\"cd /home/baiguai/documents/development/cpp/nmx;sh _run.sh\"\nalias cdww=\"cd /home/baiguai/documents/development/csharp/worldweaver\"\nalias cdwwh=\"cd /home/baiguai/documents/development/websites/worldweaver/WorldWeaverHtml\"\nalias mp3comp=fMp3Comp\nalias vimfz='nvim $(fzf)'\nalias yz=\"/home/baiguai/yazi/yazi\"\n\n# 8080\nalias notes=\"~/tws/notes.sh\"\n# 8081\nalias ktwn=\"~/tws/ktwn.sh\"\n# 8082\nalias darkworld=\"~/tws/darkworld.sh\"\n# 8083\nalias french=\"~/tws/french.sh\"\n# 8084\nalias wwadmin=\"~/tws/ww_admin.sh\"\n# 8085\nalias weaver=\"~/tws/ww.sh\"\n# 8086\nalias vbt=\"~/tws/vbt.sh\"\n# 8087\nalias bstudy=\"~/tws/biblestudy.sh\"\n# 8088\nalias wwh=\"~/tws/wwhtml.sh\"\n# 8089\nalias wwh=\"~/tws/job.sh\"\n# 8090\nalias kfu=\"~/tws/kfu.sh\"\n# 8091\nalias vummel=\"~/tws/vummel.sh\"\n# 8100\nalias twcore=\"~/tws/twcore.sh\"\n\nPROMPT_DIRTRIM=3\nexport PS1=\"\\w$ \"\n\nalias sls='ls -l --group-directories-first --color=auto'\nalias txww=\"~/tmux/sessions/worldweaver/worldweaver.sh\"\n\neval \"$(zoxide init bash)\"\n\nalias ww='cd /home/baiguai/documents/development/csharp/worldweaver/'\n\nEND\n\ncd /etc/X11/\nsudo mkdir xorg.conf.d\ncd xorg.conf.d\nsudo touch 20-3rdbutton.conf\nsudo tee -a ./20-3rdbutton.conf << END\n\nSection \"InputClass\"\n   Identifier \"middle button\"\n   MatchIsPointer \"on\"\n   MatchDriver \"libinput\"\n   Option \"MiddleEmulation\" \"on\"\nEndSection\n\nEND\n\n\n# MAC keyboard fix - For the tower\ncd /etc/modprobe.d/\nsudo touch hid_apple.conf\nsudo chmod 777 hid_apple.conf\nsudo echo 'options hid_apple fnmode=2' >> hid_apple.conf\nsudo update-initramfs -u\necho 0 | sudo tee /sys/module/hid_apple/parameters/fnmode\n\n\n\n\nsudo smbpasswd -a baiguai\n\nsudo touch /usr/bin/fixpermissions.sh\nsudo tee -a /usr/bin/fixpermissions.sh << END\nchmod -R 777 /home/baiguai/documents\nEND\n\n\nsudo npm install -g tiddlywiki\nsudo mkdir ~/tws\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/tws/* ~/tws\n\n\n################################################################################\n# Create xdotool scripts\n################################################################################\n# -- Once this script is run, go into MX settings and create a new\n#    application shortcut to call it.\n################################################################################\n\ntouch ~/scsnip_macro.sh\nsudo chmod +x ~/scsnip_macro.sh\nsudo tee -a /usr/share/applications/scsnip_macro.sh << END\n#!/bin/bash\n\nsleep 1\nxdotool key Shift+r\nxdotool key Left\nxdotool key Shift+equal\nxdotool key Delete\nxdotool key Control_L+Delete\nxdotool key Alt_L+Left\nxdotool key Shift+Left\nxdotool key Control_L+s\nEND\n\n\n\n\n\n\n################################################################################\n# Create all the .desktop files\n################################################################################\n\n\n# Reaper:\nread -p \"Download the Reaper 64bit EXE and install it to c:/program files/reaper (portable) then press ENTER\"\ntouch ~/reaper.sh\nsudo chmod +x ~/reaper.sh\ntee -a ~/reaper.sh << END\ncd /home/baiguai/.wine/drive_c/Program\\ Files/reaper/;wine reaper.exe\nEND\n\nsudo rm /usr/share/applications/reaper.desktop\nsudo touch /usr/share/applications/reaper.desktop\nsudo tee -a /usr/share/applications/reaper.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=sh /home/baiguai/reaper.sh\nName=Reaper\nEND\n\n\n# Shotcut\n# mkdir ~/shotcut\n# cp /media/baiguai/backup01/documents/information/linux/binaries-scripts/shotcut/* ~/shotcut\n# sudo touch /usr/share/applications/shotcut.desktop\n# sudo tee -a /usr/share/applications/shotcut.desktop << END\n# [Desktop Entry]\n# Encoding=UTF-8\n# Version=1.0\n# Type=Application\n# Terminal=false\n# Exec=/home/baiguai/shotcut/shotcut.AppImage\n# Name=Shotcut\n# END\n\n\n# GIMP\nmkdir ~/gimp\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/gimp/* ~/gimp\nsudo touch /usr/share/applications/gimp.desktop\nsudo tee -a /usr/share/applications/gimp.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=/home/baiguai/gimp/gimp.AppImage\nName=Gimp\nEND\n\n# Kdenlive\nmkdir ~/kdenlive\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/kdenlive/* ~/kdenlive\nsudo touch /usr/share/applications/kdenlive.desktop\nsudo tee -a /usr/share/applications/kdenlive.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=/home/baiguai/kdenlive/kdenlive.AppImage\nName=Kdenlive\nEND\n\n\nsudo touch /usr/share/applications/shotcutold.desktop\nsudo tee -a /usr/share/applications/shotcutold.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=/home/baiguai/shotcut/shotcut_old.AppImage\nName=Shotcut\nEND\n\n\n# Inkscape\nmkdir ~/inkscape\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/inkscape/* ~/inkscape\nsudo touch /usr/share/applications/inkscape.desktop\nsudo tee -a /usr/share/applications/inkscape.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=/home/baiguai/inkscape/inkscape.AppImage\nName=Inkscape\nEND\n\n\n# Audacity\nmkdir ~/audacity\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/audacity/* ~/audacity\nsudo touch /usr/share/applications/audacity.desktop\nsudo tee -a /usr/share/applications/audacity.desktop << END\n[Desktop Entry]\nName=Audacity\nGenericName=Sound Editor\nComment=Record and edit audio files\nKeywords=audio;sound;alsa;jack;editor;\nIcon=audacity\nType=Application\nCategories=AudioVideo;Audio;AudioVideoEditing;\nExec=/home/baiguai/audacity/audacity.AppImage %F\nStartupNotify=false\nTerminal=false\nMimeType=application/x-audacity-project;audio/aac;audio/ac3;audio/mp4;audio/x-ms-wma;video/mpeg;audio/flac;audio/x-flac;audio/mpeg;audio/basic;audio/x-aiff;audio/x-wav;application/ogg;audio/x-vorbis+ogg;\nEND\n\n\n# Jreepad - copy the jreepad jar to ~/jreepad\nmkdir ~/jreepad\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/jreepad/* ~/jreepad\nmkdir ~/jreepad/lib\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/jreepad/lib/* ~/jreepad/lib\nsudo touch /usr/share/applications/jreepad.desktop\nsudo tee -a /usr/share/applications/jreepad.desktop << END\n[Desktop Entry]\nName=Jreepad\nComment=\nExec=java -jar /home/baiguai/jreepad/jreepad.jar\nIcon=\nTerminal=false\nType=Application\nStartupNotify=true\nEND\n\n\n# Keepboard - copy the keepboard files to ~/keepboard\nmkdir ~/keepboard\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/keepboard/* ~/keepboard\nsudo touch /usr/share/applications/keepboard.desktop\nsudo tee -a /usr/share/applications/keepboard.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=java -jar /home/baiguai/keepboard/jar.jar\nName=Keepboard\nEND\n\n# Mucommander - copy the mucommander files to ~/mucommander\nmkdir ~/mucommander\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/mucommander/* ~/mucommander\nsudo touch /usr/share/applications/mucommander.desktop\nsudo tee -a /usr/share/applications/mucommander.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=java -jar /home/baiguai/mucommander/mucommander.jar\nName=Mucommander\nEND\n\n# TWDesktop - copy the twdesktop files to ~/tw-desktop\nmkdir ~/tw-desktop\ncp /media/baiguai/backup01/documents/information/linux/binaries-scripts/tw-desktop/* ~/tw-desktop\nsudo touch /usr/share/applications/twdt.desktop\nsudo tee -a /usr/share/applications/twdt.desktop << END\n[Desktop Entry]\nEncoding=UTF-8\nVersion=1.0\nType=Application\nTerminal=false\nExec=sh /home/baiguai/tw-desktop/runtwdt.sh\nName=TiddlyDesktop\nEND\n\n\n# Items that must be last\nbash -c \"$(curl -sLo- https://superfile.netlify.app/install.sh)\"\n","children":[],"expanded":false}],"expanded":false},{"id":"1tym6292","title":"Shell","content":"","children":[{"id":"d41bvmjd","title":"TMUX","content":"","children":[{"id":"uzxgo1ly","title":"Plugins","content":"","children":[{"id":"tgwm7zp5","title":"Resurrection","content":"Resurrection\n\n\nThe resurrection files are stored here:\n/home/baiguai/.local/share/tmux/","children":[],"expanded":false}],"expanded":false},{"id":"x3cxsg8f","title":"Kill Sessions","content":"Kill Sessions\n\n\n-- Kill all TMUX Sessions --\ntmux kill-server","children":[],"expanded":false},{"id":"d91f30av","title":"TMUX Cheatsheet","content":"TMUX Cheatsheet\n\n\nhttps://tmuxcheatsheet.com/","children":[],"expanded":false},{"id":"3lnfopyv","title":"My Config","content":"My Config\n\n\n# Be sure to add the following to your ~/.bash_profile\n# \n# if [ -f ~/.bashrc ^^^array^^^ then\n#     . ~/.bashrc\n# fi\n\n\n\n# For easy panel menu <C-s >>\n# To refresh your config <C-s r>\n\n# Rename a window <C-s ,>\n\n# SESSIONS\n# Detach <C-s d>\n# List tmux ls\n# Attach tmux a -t <session number>\n# Attach to most recent tmux a\n\nunbind r\nbind r source-file ~/.tmux.conf\n\nset -g prefix C-s\n\nsetw -g mode-keys vi\nbind-key h select-pane -L\nbind-key j select-pane -D\nbind-key k select-pane -U\nbind-key l select-pane -R\nbind \\\\ split-window -h\nbind - split-window -v\nunbind '\"'\nunbind %\n\n# Use Ctrl+S I to install\nset -g @plugin 'tmux-plugins/tpm'\n# To navigate use <C-h/j/k/l>\nset -g @plugin 'christoomey/vim-tmux-navigator'\nset -g @plugin 'tmux-plugins/tmux-resurrect'\n\nrun '~/.tmux/plugins/tpm/tpm'\n\n# Ensure flow control is disabled in every pane\nset-option -g default-command \"stty -ixon; exec $SHELL -l\"","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"fw6e1jw7","title":"eBook Converters","content":"eBook Converters\n\n\n-- Via MuPDF --\nsudo apt install mupdf mupdf-tools\nmutool convert -o somefilename.txt somefilename.epub ","children":[],"expanded":false},{"id":"ytc5u5az","title":"File Managers","content":"File Managers\n\n\nWorker (sudo apt-get install -y worker)\nSpaceFM\nYazi","children":[],"expanded":false},{"id":"wfjblcek","title":"Install Linux from a USB Stick","content":"Install Linux from a USB Stick\n\n\nGet the USB Name:\nlsblk\n\nUnmount It\numount /dev/<usb part - like /dev/sdg1>\n\nCopy the ISO\nsudo dd bs=4M if=<iso> of=/dev/<usb root - like /dev/sdg>\n\nFollow Up\nIf you need to clear the thumbdrive later:\n\nUnmount the flash drive if it automatically mounts itself upon insertion. In a\nroot shell, type \"umount /dev/sdb1\" without the quotes. If necessary, replace\n\"sdb1\" with the name Linux assigns the flash drive.\n\nChoose a file format for your flash drive. If you plan on occasionally using\nthe drive with a Windows system, you will want a vfat format.\n\nType \"mkfs -t vfat /dev/sdb1\" without the quotes. This tells the computer you\nwish to format /dev/sdb1 (the USB drive) with a vfat file system.","children":[],"expanded":false},{"id":"x8kgu1lm","title":"MPV Installation","content":"MPV Installation\n\n\nflatpak install flathub io.mpv.Mpv","children":[],"expanded":false},{"id":"1hsw942e","title":"Set the Default File Mgr","content":"Set the Default File Mgr\n\n\n[Adams Desk]https://www.adamsdesk.com/posts/change-default-linux-file-manager/","children":[],"expanded":false}],"expanded":false},{"id":"6c0kw3ag","title":"Watches","content":"","children":[{"id":"u2sjgym9","title":"Batteries","content":"Batteries\n\n\n| ---------- | ----------- | ------------------------------------------------------------------------- |\n| Watch      | Battery     | Link                                                                      |\n| ---------- | ----------- | ------------------------------------------------------------------------- |\n| Dan Henry  | 394/380     | https://www.amazon.com/Renata-394-SR936SW-Batteries-Battery/dp/B09VVTMSHC |\n| Nixon      | 394/380     | https://www.amazon.com/Renata-394-SR936SW-Batteries-Battery/dp/B09VVTMSHC |\n| Ring Watch | LR626 (377) | https://www.amazon.com/Renata-377-SR626SW-Batteries-Battery/dp/B09VVTN9P6 |\n| Silverwave | 362/SR721SW | https://www.amazon.com/Renata-362-SR721SW-Batteries-Battery/dp/B09VV4CGXT |\n| ---------- | ----------- | ------------------------------------------------------------------------- |","children":[],"expanded":false}],"expanded":false},{"id":"rk6kk9o9","title":"Work Stuff","content":"","children":[{"id":"qr0j9bzz","title":"Python: Data Push to ORA","content":"Python: Data Push to ORA\n\n\nhttps://codepal.ai/code-generator/query/yxBCdNiW/python-code-transfer-data-oracle-database\nhttp://ryrobes.com/featured-articles/using-a-simple-python-script-for-end-to-end-data-transformation-and-etl-part-1/","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"hq97wgel","title":"Links","content":"","children":[{"id":"63eapwe0","title":"Converters","content":"","children":[{"id":"40a13eba","title":"YouTube to MP3","content":"YouTube to MP3\n\n\n[YT Mate]https://y2mate.nu/ysM1/","children":[],"expanded":false}],"expanded":false},{"id":"suowpgaj","title":"Development","content":"","children":[{"id":"ybfsjvrg","title":"Plotly Dash","content":"","children":[{"id":"qyqwvhm3","title":"Learning","content":"","children":[{"id":"9nuxacm6","title":"References","content":"References\n\n\nhttps://dash.plotly.com/","children":[],"expanded":false},{"id":"1462u7v5","title":"Examples","content":"Examples\n\n\n[AnnMarieW]\nhttps://github.com/AnnMarieW","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"8z2wwnt8","title":"TW Links","content":"","children":[{"id":"uaii35mj","title":"TW Development","content":"","children":[{"id":"1uqc4f5m","title":"TW Plugin Development","content":"TW Plugin Development\n\n\nhttp://sistan.tiddlyspot.com/","children":[],"expanded":false}],"expanded":false},{"id":"0x2nhw9y","title":"TW Alternatives","content":"TW Alternatives\n\n\n[Super Simple .html]\nhttps://codesandbox.io/p/sandbox/wiki1k-lg374m?file=%2Findex.html%3A220%2C27","children":[],"expanded":false},{"id":"geq3m6k4","title":"TW Plugins","content":"TW Plugins\n\n\n[TOC Plugin Private]\nhttps://kookma.github.io/TW-TOC/\n\n[TiddlyTools (TOC, etc)]\nhttps://tiddlytools.com/#TiddlyTools%2FTOC\n\nCommand Palette\n* [GIT]\n  https://github.com/tiddly-gittly/tw-command-palette\n* [Demo]\n  https://tiddly-gittly.github.io/tw-command-palette/#%24%3A%2Fplugins%2Flinonetwo%2Fcommandpalette:%24%3A%2Fplugins%2Flinonetwo%2Fcommandpalette%20%24%3A%2Fplugins%2Flinonetwo%2Fautocomplete%20%5B%5BExample%20Tiddlers%5D%5D%20%24%3A%2FStoryList\n\n[Wikilabs]\nhttps://wikilabs.github.io/\n\n[Floats - just a POC. - popup floating windows.]\nhttps://saqimtiaz.github.io/sq-tw/floats.html","children":[],"expanded":false},{"id":"wl880lnk","title":"TW Transclusion in Tooltips","content":"TW Transclusion in Tooltips\n\n\nhttps://giffmex.org/gifts/transclusioninpopups.html","children":[],"expanded":false},{"id":"8l3ckyfp","title":"TW Utilities","content":"TW Utilities\n\n\nhttps://github.com/donmor/TiddloidLite/releases","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"31l58cbu","title":"Family","content":"","children":[{"id":"gqwk8vc1","title":"Financial","content":"","children":[{"id":"4ylmqc12","title":"Fidelity","content":"Fidelity\n\n\nOnline account:\nhttps://nb.fidelity.com\nbaiguai23","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"u6d37xl6","title":"Watches","content":"","children":[{"id":"oj25p6yd","title":"Watch Repair","content":"","children":[{"id":"9qhsrxkm","title":"Barrow's Jewelers","content":"Barrow's Jewelers\n\n\nhttps://www.facebook.com/BarrowsFamilyJewelers","children":[],"expanded":false}],"expanded":false}],"expanded":false}],"expanded":false},{"id":"unj919xj","title":"ToDos","content":"","children":[{"id":"hbbzh514","title":"To Buy","content":"","children":[{"id":"p3bt24jp","title":"Clothes","content":"","children":[],"expanded":false},{"id":"yy2spd24","title":"Watches","content":"","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"mk9pivcy","title":"Documentation","content":"","children":[{"id":"6e9jfesp","title":"Git","content":"","children":[{"id":"3e3pqhf3","title":"Aliases in Git","content":"Aliases in Git\n\n\nMy Aliases\n\ngit config --global alias.brch 'branch --sort=-committerdate'\n\nViewing and Editing\n\ngit config --get-regexp ^alias","children":[],"expanded":false},{"id":"ps95i33n","title":"Completely Replace Git Branch","content":"Completely Replace Git Branch\n\n\ngit checkout branchB\ngit branch -mf main\ngit push --force -u origin main","children":[],"expanded":false},{"id":"x31jzcoo","title":"Remove Deleted Files in Git","content":"Remove Deleted Files in Git\n\n\ngit add -u\n\ngit push -u origin branch","children":[],"expanded":false},{"id":"u3ceg5ez","title":"Git Commands","content":"Git Commands\n\n\nGIT Branch - Sorted DESC\n\tgit branch --sort=-committerdate\nAlias:\n\tgit config --global alias.brch 'branch --sort=-committerdate'","children":[],"expanded":false},{"id":"xbz3ard0","title":"Git Configs","content":"Git Configs\n\n\nGlobal:\n\n~/.gitconfig\n\nLocal:\n\n.git/config","children":[],"expanded":false},{"id":"elt43yxb","title":"Git Pull Request Via Cli","content":"Git Pull Request Via Cli\n\n\ngit pull origin main\n\ngit checkout main\n\ngit merge (your branch name)\n\ngit push -u origin main","children":[],"expanded":false},{"id":"5m6w097q","title":"Git Tags","content":"Git Tags\n\n\n[Working with Tags]\nhttps://www.slingacademy.com/article/working-with-git-tags-a-complete-guide-with-examples/","children":[],"expanded":false},{"id":"r0jghnc9","title":"GitHub CLI Tool","content":"GitHub CLI Tool\n\n\nTo Install:\n\n(type -p wget >/dev/null || (sudo apt update && sudo apt-get install wget -y)) \\\n&& sudo mkdir -p -m 755 /etc/apt/keyrings \\\n&& wget -qO- https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg > /dev/null \\\n&& sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg \\\n&& echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main\" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null \\\n&& sudo apt update \\\n&& sudo apt install gh -y\n\nTo Upgrade:\n\nsudo apt update\nsudo apt install gh","children":[],"expanded":false},{"id":"f1echk8b","title":"Remove Deleted Files From Remote Git Repo","content":"Remove Deleted Files From Remote Git Repo\n\n\ngit add -u\n\ngit push -u origin branch","children":[],"expanded":false}],"expanded":false},{"id":"wahpdmy9","title":"Tmux","content":"","children":[],"expanded":false},{"id":"xeltzzl5","title":"Vim","content":"","children":[],"expanded":false},{"id":"zxu0mktw","title":"Yazi","content":"","children":[{"id":"eg9tp0md","title":"Cheat Sheets","content":"Cheat Sheets\n\n\n[ricoberger]https://ricoberger.de/cheat-sheets/yazi/","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"6gw7lzcl","title":"Contacts","content":"","children":[{"id":"py0dogag","title":"Ktwn","content":"","children":[{"id":"gqopkt9g","title":"Brian Brasher","content":"Brian Brasher\n\n\n7604 Sardis Grove Lane\nGardendale, AL 35071\n\n\n* Artist\n* http://horrorvvorks.com","children":[],"expanded":false},{"id":"wug5b1jw","title":"Doug Moss","content":"Doug Moss\n\n\n408 Bluebonnet Drive\nKerens, TX 75144","children":[],"expanded":false},{"id":"or86e4p4","title":"Johnny McCauley","content":"Johnny McCauley\n\n\n336-524-1129\n\n103 West Hanover Rd\nGraham, NC 27253","children":[],"expanded":false}],"expanded":false}],"expanded":false},{"id":"vgymiptq","title":"Quick Notes","content":"Quick Notes\n\n\n....","children":[],"expanded":false}
];
        let bookmarks = [
    {
        "id": "2k7pyf7b",
        "caption": "Brands",
        "path": "/Recipes/Cocktails"
    },
    {
        "id": "o4mzyvpk",
        "caption": "Onboarding - Flutter",
        "path": "/Information/Development/Android"
    }
];
        let historyStack = [
    {
        "id": "2k7pyf7b",
        "title": "Brands"
    },
    {
        "id": "o4mzyvpk",
        "title": "Onboarding - Flutter"
    },
    {
        "id": "vgymiptq",
        "title": "Quick Notes"
    },
    {
        "id": "ylqc9umv",
        "title": "Current Httree Implementations"
    }
];

        // !@!
        const readOnly = false;

        const SAFE_MAP = {
            "</script": "^^^script^^^",
            "</style": "^^^style^^^",
            "]]>": "^^^cdata^^^",
            "];": "^^^array^^^",
            "\\);": "^^^func^^^"
        };

        let nodePort = 3000;

        let currentEditorNodeId = null;


        let showingHistory = false;
        let historyIndex = 0;
        const historyStackMax = 30;

        let copiedNoteId = null;

        let fileName = "ht_notes";
        let showInitHelp = false;
        let selectedId = null;
        let editing = false;
        let showingLinks = false;
        let showingMarks = false;
        let showingHelp = false;
        let marksIndex = 0;
        let finding = false;
        let mode_vim = true;
        let mode_insert = false;
        let mode_repeat = 1;
        let mode_counting = false;
        let mode_going = false;
        let mode_deleting = false;

        let mode_visual = false;
        let mode_visual_line = false;
        let visual_start = 0;
        let visual_end = 0;
        let vim_clipboard = '';

        let undoValue = "";

        let searchActive = false;
        let searchMatches = [];
        let searchIndex = 0;
        const helpDialog = document.getElementById('helpDialog');
        const helpDialogVimEdit = document.getElementById('helpDialogVimEdit');
        const helpDialogVimDisabled = document.getElementById('helpDialogVimDisabled');
        const optionsDialog = document.getElementById('optionsDialog');
        const saveAsDialog = document.getElementById('saveAsDialog');
        const searchDialog = document.getElementById('searchDialog');
        const replaceDialog = document.getElementById('replaceDialog');
        const linksDialog = document.getElementById('linksDialog');
        const marksDialog = document.getElementById('marksDialog');
        const historyDialog = document.getElementById('historyDialog');
        const marksList = document.getElementById('marksList');
        const searchInput = document.getElementById('searchInput');
        const searchList = document.getElementById('searchList');
        const optShowInitHelp = document.getElementById('optShowInitHelp');
        const optFileName = document.getElementById('optFileName');
        const optModeVim = document.getElementById('optModeVim');
        const optPort = document.getElementById('optPort');
        let optionFields = [optShowInitHelp, optFileName, optModeVim];
        let optionIndex = 0;

        const helpReadOnly = [
            { key: "j", mode: "TREE", description: "Select next tree node" },
            { key: "k", mode: "TREE", description: "Select the previous tree node" },
            { key: "l", mode: "TREE", description: "Expand the current tree node" },
            { key: "h", mode: "TREE", description: "Collapse the current tree node" },
            { key: "u", mode: "TREE", description: "Go up a tree node level" },
            { key: "C", mode: "TREE", description: "Collapse all the tree nodes" },
            { key: "E", mode: "TREE", description: "Expand all the tree nodes" },
            { key: "]", mode: "TREE", description: "Expand the treeview panel" },
            { key: "[", mode: "TREE", description: "Shrink the treeview panel" },
            { key: "/", mode: "TREE", description: "Search (begin with : to search labels)" },
            { key: "f", mode: "TREE", description: "Find text in the current note " },
            { key: "#", mode: "TREE", description: "Show note links dialog" },
            { key: "<", mode: "TREE", description: "Show the history dialog" },
            { key: "gg", mode: "TREE", description: "Select first root tree node" },
            { key: "G", mode: "TREE", description: "Select last root tree node" },
            { key: "T", mode: "TREE", description: "Export current note as .txt" },
            { key: "m", mode: "TREE", description: "Bookmark current node" },
            { key: "`", mode: "TREE", description: "Show bookmarks" },
        ];
        
        const helpVimEnabled = [
            { key: "r", mode: "TREE", description: "Add root level node" },
            { key: "R", mode: "TREE", description: "Rename current Folder" },
            { key: "j", mode: "TREE", description: "Select the next tree node" },
            { key: "k", mode: "TREE", description: "Select the previous tree node" },
            { key: "l", mode: "TREE", description: "Expand the current tree node" },
            { key: "h", mode: "TREE", description: "Collapse the current tree node" },
            { key: "u", mode: "TREE", description: "Go up a tree node level" },
            { key: "C", mode: "TREE", description: "Collapse all the tree nodes" },
            { key: "E", mode: "TREE", description: "Expand all the tree nodes" },
            { key: "A", mode: "TREE", description: "Add child tree node" },
            { key: "a", mode: "TREE", description: "Add next sibling tree node" },
            { key: "]", mode: "TREE", description: "Expand the treeview panel" },
            { key: "[", mode: "TREE", description: "Shrink the treeview panel" },
            { key: "gg", mode: "TREE", description: "Select first root tree node" },
            { key: "G", mode: "TREE", description: "Select last root tree node" },
            { key: "y", mode: "TREE", description: "Copy note node" },
            { key: "p", mode: "TREE", description: "Paste copied note node" },
            { key: "H", mode: "TREE", description: "Move current node to the parent node" },
            { key: "L", mode: "TREE", description: "Make current node a child node" },
            { key: "J", mode: "TREE", description: "Move current node down" },
            { key: "K", mode: "TREE", description: "Move current node up" },
            { key: "D", mode: "TREE", description: "Delete the current node" },
            { key: "i", mode: "TREE", description: "Edit current note - NORMAL mode" },
            { key: "I", mode: "TREE", description: "Edit current note - INSERT mode" },
            { key: "/", mode: "TREE", description: "Search (begin with : to search labels)" },
            { key: "f", mode: "TREE", description: "Find/Replace text in the current note " },
            { key: "#", mode: "TREE", description: "Show note links dialog" },
            { key: "<", mode: "TREE", description: "Show the history dialog" },
            { key: "X", mode: "TREE", description: "Show broken note links" },
            { key: "s", mode: "TREE", description: "Save the current file" },
            { key: "S", mode: "TREE", description: "Save as" },
            { key: "n", mode: "TREE", description: "Save via NodeJs saver server" },
            { key: "T", mode: "TREE", description: "Export current note as .txt" },
            { key: "U", mode: "TREE", description: "Upgrade (import existing data)" },
            { key: "m", mode: "TREE", description: "Bookmark current node" },
            { key: "`", mode: "TREE", description: "Show bookmarks" },
            { key: "!", mode: "TREE", description: "Display options dialog" },

            { key: "a", mode: "NORMAL", description: "Enter insert mode, where you can write text normally" },
            { key: "h", mode: "NORMAL", description: "Move left" },
            { key: "l", mode: "NORMAL", description: "Move right" },
            { key: "j", mode: "NORMAL", description: "Move down" },
            { key: "k", mode: "NORMAL", description: "Move up" },
            { key: "0", mode: "NORMAL", description: "Jump to the beginning of the line" },
            { key: "$", mode: "NORMAL", description: "Jump to the end of the line" },
            { key: "b", mode: "NORMAL", description: "Move backward one word" },
            { key: "B", mode: "NORMAL", description: "Move backward to the next space" },
            { key: "w", mode: "NORMAL", description: "Move forward one word" },
            { key: "W", mode: "NORMAL", description: "Move forward to the next space" },
            { key: "D", mode: "NORMAL", description: "Delete everything right of the cursor" },
            { key: "dd", mode: "NORMAL", description: "Delete current row" },
            { key: "gg", mode: "NORMAL", description: "Go to the start of the note" },
            { key: "#gg", mode: "NORMAL", description: "Go to the specified line (where # is a number)" },
            { key: "G", mode: "NORMAL", description: "Go to the end of the note" },
            { key: "V", mode: "NORMAL", description: "Enter line select mode" },
            { key: "v", mode: "NORMAL", description: "Enter standard select mode" },
            { key: "x", mode: "NORMAL", description: "Delete the character under the cursor" },
            { key: "r", mode: "NORMAL", description: "Updates the undo cache with the current note text" },
            { key: "u", mode: "NORMAL", description: "Restores the note text to the undo cache value" },

            { key: "y", mode: "VISUAL", description: "Virtual copy the selected text" },
            { key: "x", mode: "VISUAL", description: "Virtual cut the selected text" },
            { key: "d", mode: "VISUAL", description: "Delete selected text" },

            { key: "Control+-", mode: "INSERT/NORMAL", description: "Insert horizontal line" },
            { key: "Control+\\", mode: "INSERT/NORMAL", description: "Wrap selected text" },
            { key: "Control+;", mode: "INSERT/NORMAL", description: "Converts the selected text to a table" },

            { key: "<number>", mode: "NORMAL", description: "If you enter a number first, some commands will repeat that many times." },
        ];
        
        const helpVimDisabled = [
            { key: "r", mode: "TREE", description: "Add root level node" },
            { key: "R", mode: "TREE", description: "Rename current Folder" },
            { key: "j", mode: "TREE", description: "Select the next tree node" },
            { key: "k", mode: "TREE", description: "Select the previous tree node" },
            { key: "l", mode: "TREE", description: "Expand the current tree node" },
            { key: "h", mode: "TREE", description: "Collapse the current tree node" },
            { key: "u", mode: "TREE", description: "go up a tree node level" },
            { key: "C", mode: "TREE", description: "Collapse all the tree nodes" },
            { key: "E", mode: "TREE", description: "Expand all the tree nodes" },
            { key: "A", mode: "TREE", description: "Add child tree node" },
            { key: "a", mode: "TREE", description: "Add next sibling tree node" },
            { key: "]", mode: "TREE", description: "Expand the treeview panel" },
            { key: "[", mode: "TREE", description: "Shrink the treeview panel" },
            { key: "gg", mode: "TREE", description: "Select first root tree node" },
            { key: "G", mode: "TREE", description: "Select last root tree node" },
            { key: "y", mode: "TREE", description: "Copy note node" },
            { key: "p", mode: "TREE", description: "Paste copied note node" },
            { key: "H", mode: "TREE", description: "Move current node to the parent node" },
            { key: "L", mode: "TREE", description: "Make current node a child node" },
            { key: "J", mode: "TREE", description: "Move current node down" },
            { key: "K", mode: "TREE", description: "Move current node up" },
            { key: "D", mode: "TREE", description: "Delete the current node" },
            { key: "i", mode: "TREE", description: "Edit current note" },
            { key: "I", mode: "TREE", description: "Edit current note" },
            { key: "/", mode: "TREE", description: "Search (begin with : to search labels)" },
            { key: "f", mode: "TREE", description: "Find/Replace text in the current note " },
            { key: "#", mode: "TREE", description: "Show note links dialog" },
            { key: "<", mode: "TREE", description: "Show the history dialog" },
            { key: "X", mode: "TREE", description: "Show broken note links" },
            { key: "s", mode: "TREE", description: "Save the current file" },
            { key: "S", mode: "TREE", description: "Save as" },
            { key: "n", mode: "TREE", description: "Save via NodeJs saver server" },
            { key: "T", mode: "TREE", description: "Export current note as .txt" },
            { key: "U", mode: "TREE", description: "Upgrade (import existing data)" },
            { key: "m", mode: "TREE", description: "Bookmark current node" },
            { key: "`", mode: "TREE", description: "Show bookmarks" },
            { key: "!", mode: "TREE", description: "Display options dialog" },

            { key: "Control+-", mode: "INSERT", description: "Insert horizontal line" },
            { key: "Control+*", mode: "INSERT", description: "Convert selection to list" },
            { key: "Control+\\", mode: "INSERT", description: "Wrap selected text" },
        ];


        //---- Utilities -------------------------------------------------------
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }
        function findNode(id) {
            for (const n of treeData) {
                if (n.id === id) return n;
            }
        }
        function findNodeAndParentById(id, nodes = treeData, parent = null) {
            for (const n of nodes) {
                if (n.id === id) return { node: n, parent };
                const res = findNodeAndParentById(id, n.children, n);
                if (res) return res;
            }
            return null;
        }
        function getSiblingsAndIndex(id) {
            const info = findNodeAndParentById(id);
            if (!info) return null;
            const siblings = info.parent ? info.parent.children : treeData;
            const index = siblings.findIndex(n => n.id === id);
            return { siblings, index, parent: info.parent };
        }
        function isFolder(n){ return (n.content || "").trim().length === 0; }
        function updateTitleFromContent(n){
            if (n.content === "") return;
            const firstLine = (n.content||"").split(/\r?\n/)[0].trim();
            if (firstLine) n.title = firstLine.slice(0, 80);
            else if (!n.title || !n.title.startsWith("New")) n.title = "New Folder";
        }
        function computePath(id, lengthMax = 50) {
            const segments = [];
            (function walk(id, isRootCall = true) {
                const info = findNodeAndParentById(id);
                if (!info) return;
                if (info.parent) walk(info.parent.id, false);
                if (!isRootCall) {
                    // only push if not the starting node
                    segments.push(info.node.title || "Untitled");
                }
            })(id, true);
        
            let path = '/' + segments.join('/');
        
            if (path.length > lengthMax) {
                // Trim from the left side until it fits
                while (path.length > lengthMax && segments.length > 1) {
                    segments.shift(); // remove first segment
                    path = '/…/' + segments.join('/');
                }
            }
        
            return path;
        }
        function recordHistory(id) {
            const node = findNodeAndParentById(id)?.node;
            if (!node) return;
            if (isFolder(node)) return; // only record notes
        
            // Remove any existing entry for this id
            historyStack = historyStack.filter(entry => entry.id !== id);
        
            // Add it at the end (latest)
            historyStack.push({ id, title: node.title || "(untitled)" });
        
            if (historyStack.length > historyStackMax) {
                historyStack.shift();
            }
        }
        function showMessage(msgText, duration = 3000) {
            // clear any existing timers
            clearTimeout(msgTimeout);
        
            // set text and fade in
            msgEl.textContent = msgText;
            msgEl.classList.add("visible");
        
            // schedule fade out
            msgTimeout = setTimeout(() => {
                msgEl.classList.remove("visible");
                // after fade-out transition ends, clear text
                setTimeout(() => {
                    msgEl.textContent = "";
                }, 600); // matches CSS transition duration
            }, duration);
        }


        //---- Rendering -------------------------------------------------------
        const treeEl = document.getElementById('tree');
        const mobileMenu = document.getElementById('mobileMenu');
        const hamburgerBtn = document.getElementById('hamburger');
        const editorArea = document.getElementById('editorArea');
        const modeEl = document.getElementById('mode');
        const kindEl = document.getElementById('kind');
        const pathEl = document.getElementById('path');
        const msgEl = document.getElementById('msg');
        let msgTimeout;

        function render(){
            // Render tree
            treeEl.innerHTML = '';
            const ul = document.createElement('ul');
            treeEl.appendChild(ul);

            function renderNode(n){
                const li = document.createElement('li');
                const row = document.createElement('div');
                row.className = 'node' + (n.id === selectedId ? ' selected' : '');

                // Twisty indicator
                const twist = document.createElement('span');
                twist.className = 'twisty';
                if (n.children.length) {
                    twist.innerHTML = n.expanded
                    ? `<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M1 3 L5 7 L9 3 Z" fill="currentColor" /></svg>`
                    : `<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 L7 5 L3 9 Z" fill="currentColor" /></svg>`;
                } else {
                    twist.innerHTML = `<svg width="6" height="6" viewBox="0 0 6 6" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="1" fill="currentColor" /></svg>`;
                }

                // Icon
                const icon = document.createElement('span');
                icon.className = 'icon';
                icon.innerHTML = isFolder(n)
                    ? `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333332 4.2333333" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <g id="layer1"> <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:0.264583;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1" d="M 0.26458332,0.52916666 H 1.8520833 l 0.79375,0.52916664 1.3229167,1e-7 v 2.6458333 l -3.70416668,-10e-8 V 0.52916666" id="path2433" /> </g> </svg>`
                    : `<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="16" height="16" viewBox="0 0 4.2333334 4.2333334" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2" /> <path style="fill:none;fill-opacity:1;stroke:#a5a5a5;stroke-width:0.258464;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers" d="m 0.79069024,0.63332294 c 1.68462256,-0.00621 0.87336156,0 2.51966116,0 V 3.6027704 H 0.79069024 Z" id="path65" /> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5117" width="1.3229166" height="0.24694447" x="1.3890625" y="1.3934721" /> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5737" width="1.3229166" height="0.24694447" x="1.3890625" y="1.887361" /> <rect style="fill:#757575;fill-opacity:1;stroke-width:1.7147;stroke-linecap:round;stroke-linejoin:round;paint-order:stroke fill markers" id="rect5739" width="1.3229166" height="0.24694447" x="1.3890625" y="2.3812501" /> </svg>`;

                const title = document.createElement('span');
                title.className = 'title';
                title.textContent = n.title || '(untitled)';

                row.addEventListener('click', () => {
                    selectedId = n.id;
                    modeEl.textContent = 'TREE';
                    editing = false;
                    mode_insert = false;
                    if (n.children.length) {
                        n.expanded = !n.expanded; // toggle when clicking row
                        editorArea.content = "";
                    } else {
                        if (window.innerWidth <= 768 && n.content !== "") {
                            treeEl.classList.remove('show');
                        }
                    }
                    render();
                });

                row.appendChild(twist); row.appendChild(icon); row.appendChild(title);

                li.appendChild(row);

                if (n.expanded && n.children.length){
                    const inner = document.createElement('ul');
                    for (const c of n.children) inner.appendChild(renderNode(c));
                    li.appendChild(inner);
                }
                return li;
            }

            for (const n of treeData) ul.appendChild(renderNode(n));

            // Render editor status + content
            const selInfo = findNodeAndParentById(selectedId);
            if (selInfo){
                pathEl.textContent = computePath(selInfo.node.id);
                kindEl.textContent = isFolder(selInfo.node) ? 'FOLDER' : 'FILE';
                if (!editing) {
                    if (currentEditorNodeId !== selInfo.node.id) {
                        editorArea.value = safeRestoreText(selInfo.node.content) || '';
                        addUndo();
                        currentEditorNodeId = selInfo.node.id;
                    }
                    editorArea.setAttribute('readonly', 'readonly');
                } else {
                    editorArea.removeAttribute('readonly');
                    // keep as-is while editing
                }
            } else {
                pathEl.textContent = '/';
                kindEl.textContent = '—';
                editorArea.value = '';
                editorArea.setAttribute('readonly', 'readonly');
            }

            if (editing) {
                if (mode_insert) {
                    modeEl.textContent = 'INSERT';
                } else if (mode_visual) {
                    modeEl.textContent = mode_visual_line ? 'VISUAL LINE' : 'VISUAL';
                } else {
                    modeEl.textContent = 'NORMAL';
                }
            } else {
                modeEl.textContent = 'TREE';
            }

            if (selectedId) recordHistory(selectedId);

            // Ensure selected node is visible
            setTimeout(() => {
                const selEl = document.querySelector('.node.selected');
                if (selEl) selEl.scrollIntoView({ block: "nearest" });
            }, 0);
        }


        //---- Editor Sync -----------------------------------------------------
        editorArea.addEventListener('input', () => {
            syncFile();
            scheduleAutoSave();
        });

        editorArea.addEventListener('click', () => {
            if (!readOnly) {
                mode_insert = true;
                editing = true;
                render();
            }

            // Close dialogs - this is for mobile envs
            closeDialogs();

            editorArea.focus();
            // editorArea.setSelectionRange(0, 0); 
            // scrollToCursor();
        });

        function syncFile() {
            const info = findNodeAndParentById(selectedId);
            if (!info) return;

            info.node.content = safeStoreText(editorArea.value);
            updateTitleFromContent(info.node);
            // File vs folder might have changed; keep UI responsive
            render();
        }

        function addUndo() {
            undoValue = editorArea.value;
        }

        function safeStoreText(text) {
            if (!text) return "";
            for (const [raw, safe] of Object.entries(SAFE_MAP)) {
              text = text.replace(new RegExp(raw, "gi"), safe);
            }
            return text;
        }

        function safeRestoreText(text) {
            if (!text) return "";
            for (const [raw, safe] of Object.entries(SAFE_MAP)) {
                // escape special chars in safe before making regex
                const esc = safe.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
                text = text.replace(new RegExp(esc, "gi"), raw);
            }
            return text;
        }

        editorArea.addEventListener('blur', (e) => {
            syncFile();
        });

        editorArea.addEventListener('keydown', (e) => {
            const start = editorArea.selectionStart;
            const end = editorArea.selectionEnd;
            const value = editorArea.value;
        
            switch (e.key) {
                case 'Tab':
                    e.preventDefault();
                    e.stopPropagation();
        
                    if (e.shiftKey) {
                        // --- Shift+Tab = Unindent ---
                        const lineStart = value.lastIndexOf("\n", start - 1) + 1;
                        const lineEnd = value.indexOf("\n", end);
                        const affected = value.substring(lineStart, lineEnd === -1 ? value.length : lineEnd);
        
                        const unindented = affected.split("\n").map(line =>
                            line.startsWith("    ") ? line.slice(4) : line
                        ).join("\n");
        
                        const newValue = value.substring(0, lineStart) + unindented + value.substring(lineStart + affected.length);
        
                        editorArea.value = newValue;
        
                        // Restore selection (shrink by up to 4 per line)
                        const lines = affected.split("\n").length;
                        const removed = 4 * lines;
                        editorArea.selectionStart = Math.max(start - 4, lineStart);
                        editorArea.selectionEnd = Math.max(end - removed, editorArea.selectionStart);
                    } else {
                        // --- Tab = Indent ---
                        const selection = value.substring(start, end);
                        if (selection.includes("\n")) {
                            const lineStart = value.lastIndexOf("\n", start - 1) + 1;
                            const lineEnd = value.indexOf("\n", end);
                            const affected = value.substring(lineStart, lineEnd === -1 ? value.length : lineEnd);
        
                            const indented = affected.split("\n").map(line => "    " + line).join("\n");
        
                            const newValue = value.substring(0, lineStart) + indented + value.substring(lineStart + affected.length);
        
                            editorArea.value = newValue;
        
                            // Shift selection right
                            const lines = affected.split("\n").length;
                            const added = 4 * lines;
                            editorArea.selectionStart = start + 4;
                            editorArea.selectionEnd = end + added;
                        } else {
                            // Single caret or inline selection
                            editorArea.setRangeText("    ", start, end, "end");
                        }
                    }
                    break;
        
                case 'Enter':
                    if (finding) break;

                    e.preventDefault();
                    e.stopPropagation();
        
                    // --- Auto-indent on new line ---
                    const lineStart = value.lastIndexOf("\n", start - 1) + 1;
                    const currentLine = value.substring(lineStart, start);
                    const indentMatch = currentLine.match(/^\s*/); // capture leading spaces
                    const indent = indentMatch ? indentMatch[0] : "";
        
                    const insertText = "\n" + indent;
        
                    editorArea.setRangeText(insertText, start, end, "end");
                    break;
            }

            if (!mode_insert) {
                // Only adjust scrolling when *not* editing
                setAppHeight();
                scrollToCursor();
            }

            if (e.key === 'Escape') {
                e.preventDefault();
                e.stopPropagation();
                syncFile();

                if (mode_insert && mode_vim) {
                    setVimMode(false);
                    editorArea.setSelectionRange(editorArea.selectionStart,editorArea.selectionStart);
                } else if (mode_visual && mode_vim) {
                    exitVisualMode();
                    setVimMode(false);
                } else {
                    editing = false;
                    editorArea.blur();
                    render();
                }

                return;
            }

            if (!mode_insert && mode_vim) {
                vimKeys(e);
            }
        });



        // ---- VIM Keys -------------------------------------------------------
        function vimKeys(e) {
            if (mode_visual) {
                let visProcessed = visualKeys(e);
                if (visProcessed) {
                    return;
                }
            }

            e.preventDefault();
        
            // Normal mode logic
            if (!isNaN(parseInt(e.key, 10))) {
                const digit = parseInt(e.key, 10);
                if (!mode_counting) {
                    if (digit !== 0) {
                        mode_repeat = digit;
                        mode_counting = true;
                        return;
                    }
                } else {
                    mode_repeat = (mode_repeat * 10) + digit;
                    return;
                }
            }


            // Cancel any multi-key flags
            if (e.key !== 'g') {
                mode_going = false;
            }
            if (e.key !== 'd') {
                mode_deleting = false;
            }
            if (mode_counting && isNaN(parseInt(e.key, 10))) {
                mode_counting = false;
            }

        
            // Execute commands with repeat count
            let performed = false;


            if (mode === "VISUAL") {
                // Add bullet '*' at start of current line
                if (e.key === "*") {
                    e.preventDefault();
                    const text = editorArea.value;
                    const pos = editorArea.selectionStart;
            
                    // Find start of current line
                    const lineStart = text.lastIndexOf("\n", pos - 1) + 1;
                    const lineEnd = text.indexOf("\n", pos);
                    const before = text.substring(0, lineStart);
                    const after = text.substring(lineStart);
            
                    editorArea.value = before + "* " + after;
            
                    // keep caret in same column, but shifted by 2 chars
                    editorArea.selectionStart = editorArea.selectionEnd = pos + 2;
            
                    showMessage("Bullet added");
                    return;
                }
            }


            //---- These are the keys to be processed when in NORMAL mode ------
            switch (e.key) {
                case "i": // Enter insert mode
                case "a":
                    setVimMode(true);
                    mode_insert = true;
                    performed = true;
                    modeEl.textContent = 'INSERT';
                    break;
        
                case "h": // Move left
                    let newPosBack = Math.max(0, editorArea.selectionStart - mode_repeat);
                    moveChar(newPosBack, true);
                    performed = true;
                    break;
        
                case "l": // Move right
                    let newPosFwd = Math.min(editorArea.value.length, editorArea.selectionStart + mode_repeat);
                    moveChar(newPosFwd, false);
                    performed = true;
                    break;
        
                case "j": // Move down lines
                    for (let i = 0; i < mode_repeat; i++) moveCursorVertical(1);
                    performed = true;
                    break;
        
                case "k": // Move up lines
                    for (let i = 0; i < mode_repeat; i++) moveCursorVertical(-1);
                    performed = true;
                    break;
        
                case "0": // Jump to beginning of line
                    const before0 = editorArea.value.lastIndexOf("\n", editorArea.selectionStart - 1);
                    let moveStart = editorArea.selectionEnd = (before0 === -1 ? 0 : before0 + 1);
                    moveChar(moveStart, false);
                    performed = true;
                    break;
        
                case "$": // Jump to end of line
                    const after$ = editorArea.value.indexOf("\n", editorArea.selectionStart);
                    let moveEnd = editorArea.selectionEnd = (after$ === -1 ? editorArea.value.length : after$);
                    moveChar(moveEnd, false);
                    performed = true;
                    break;

                case "u":
                    if (!mode_insert) {
                        doUndo();
                        performed = true;
                    }
                    break;
                case "r":
                    if (!mode_insert) {
                        addUndo();
                        performed = true;
                    }
                    break;

                case "v": // Enter visual mode
                    enterVisualMode(false);
                    performed = true;
                    break;
                case "V": // Enter visual line mode
                    enterVisualMode(true);
                    performed = true;
                    break;

                case "w": // Forward word(s)
                    for (let i = 0; i < mode_repeat; i++) moveWord(1);
                    performed = true;
                    break;

                case "W":
                    const area = document.getElementById('editorArea');
                    if (!area) break;
                
                    const wtext = area.value;
                    const pos = area.selectionStart;
                
                    // Find end of current line
                    const newlineIdx = wtext.indexOf('\n', pos);
                    const lineEnd = newlineIdx === -1 ? wtext.length : newlineIdx;
                
                    // Find next space within the same line
                    let nextSpace = wtext.indexOf(' ', pos + 1);
                    if (nextSpace === -1 || nextSpace > lineEnd) nextSpace = lineEnd;
                
                    // Skip consecutive spaces
                    while (nextSpace < wtext.length && wtext[nextSpace] === ' ') nextSpace++;
                
                    area.setSelectionRange(nextSpace, nextSpace);
                    e.preventDefault();
                    break;

                case "b": // Backward word(s)
                    for (let i = 0; i < mode_repeat; i++) moveWord(-1);
                    performed = true;
                    break;

                case "B":
                    const barea = document.getElementById('editorArea');
                    if (!barea) break;
                
                    const btext = barea.value;
                    const bpos = barea.selectionStart;
                
                    // Find start of current line
                    const lineStart = btext.lastIndexOf('\n', bpos - 1) + 1;
                
                    // Move backward until hitting space or start of line
                    let prevSpace = btext.lastIndexOf(' ', bpos - 1);
                    if (prevSpace < lineStart && lineStart > 0) prevSpace = lineStart;
                
                    // Skip consecutive spaces
                    while (prevSpace > 0 && btext[prevSpace - 1] === ' ') prevSpace--;
                
                    barea.setSelectionRange(prevSpace, prevSpace);
                    e.preventDefault();
                    break;
        
                case "x": // Delete character(s) under cursor
                    const start = editorArea.selectionStart;
                    if (start < editorArea.value.length) {
                        editorArea.setRangeText("", start, start + mode_repeat, "end");
                    }
                    performed = true;
                    break;

                case "g": // Possible gg
                    if (mode_going) {
                        if (mode_repeat > 1) {
                            // Go to line N
                            const lines = editorArea.value.split("\n");
                            const lineIndex = Math.min(mode_repeat - 1, lines.length - 1);
                            let pos = 0;
                            for (let i = 0; i < lineIndex; i++) {
                                pos += lines[i].length + 1;
                            }
                            performed = true;

                            moveChar(pos, true);
                        } else {
                            moveChar(0, true);
                            performed = true;
                        }

                        scrollToCursor();
                    } else {
                        mode_going = true;
                    }
                    break;

                case "D": // Delete to end of line(s)
                    const text = editorArea.value;
                    let startDelEnd = editorArea.selectionStart;
                    let end = text.indexOf("\n", startDelEnd);
            
                    if (end === -1) end = text.length;
            
                    editorArea.setSelectionRange(startDelEnd, end);
                    editorArea.setRangeText("", startDelEnd, end, "start");
                    editorArea.selectionStart = editorArea.selectionEnd = startDelEnd;
                    e.preventDefault();
                    syncFile();
                    performed = true;
                    break;

                case "d": // Possible dd
                    doDelete();
                    break;

                case "G": // End of buffer, or Nth line
                    const bufEnd = editorArea.selectionEnd = editorArea.value.length;
                    moveChar(bufEnd, false);
                    performed = true;
                    scrollToCursor();
                    break;
            }
            //------------------------------------------------------------------
        
            if (performed) {
                keyPerformed();
            }
        
            // --- Helper for j/k ---
            function moveCursorVertical(direction) {
                const text = editorArea.value;
                let pos = 0;

                if (mode_visual) {
                    pos = visual_end;
                } else {
                    pos = editorArea.selectionStart;
                }
        
                // Find current line start/end
                const lineStart = text.lastIndexOf("\n", pos - 1) + 1;
                const lineEnd = text.indexOf("\n", pos);
                const currentCol = pos - lineStart;
        
                // Target line
                let targetLineStart, targetLineEnd;
                if (direction > 0) { // down
                    if (lineEnd === -1) return; // already last line
                    targetLineStart = lineEnd + 1;
                    targetLineEnd = text.indexOf("\n", targetLineStart);
                    if (targetLineEnd === -1) targetLineEnd = text.length;
                } else { // up
                    if (lineStart === 0) return; // already first line
                    targetLineEnd = lineStart - 1;
                    targetLineStart = text.lastIndexOf("\n", targetLineEnd - 1) + 1;
                }
        
                // Keep column if possible, else move to end of line
                const targetPos = Math.min(targetLineStart + currentCol, targetLineEnd);

                if (mode_visual) {
                    visual_end = targetPos;
                    updateVisualSelection();
                } else {
                    editorArea.selectionStart = editorArea.selectionEnd = targetPos;
                }
            }

            function moveWord(direction) {
                const text = editorArea.value;
                let pos = 0;

                if (mode_visual) {
                    pos = visual_end;
                } else {
                    pos = editorArea.selectionStart;
                }

                if (direction > 0) {
                    // Skip current non-word chars
                    while (pos < text.length && /\W/.test(text[pos])) pos++;
                    // Skip word chars
                    while (pos < text.length && /\w/.test(text[pos])) pos++;
                } else {
                    // Move left past non-word chars
                    while (pos > 0 && /\W/.test(text[pos - 1])) pos--;
                    // Move left past word chars
                    while (pos > 0 && /\w/.test(text[pos - 1])) pos--;
                }

                if (mode_visual) {
                    visual_end = pos;
                    updateVisualSelection();
                } else {
                    editorArea.selectionStart = editorArea.selectionEnd = pos;
                }
            }

            function moveChar(newPos, goingBack) {
                const text = editorArea.value;

                if (mode_visual) {
                    visual_end = newpos;
                    if (goingBack) {
                        visual_end = newPos + 1;
                    }
                    updateVisualSelection();
                } else {
                    editorArea.selectionStart = editorArea.selectionEnd = newPos;
                }
            }

            function doDelete() {
                if (mode_deleting) {
                    const text = editorArea.value;
                    const pos = editorArea.selectionStart;
                
                    // Find start of current line
                    const lineStart = text.lastIndexOf("\n", pos - 1) + 1;
                
                    // Find end of current line INCLUDING newline
                    let lineEnd = text.indexOf("\n", pos);
                    if (lineEnd === -1) {
                        lineEnd = text.length;
                    } else {
                        lineEnd += 1;
                    }
                
                    // Repeat delete for mode_repeat > 1
                    for (let i = 1; i < mode_repeat; i++) {
                        const nextEnd = text.indexOf("\n", lineEnd);
                        if (nextEnd === -1) {
                            lineEnd = text.length;
                            break;
                        } else {
                            lineEnd = nextEnd + 1;
                        }
                    }
                
                    // Delete the range
                    editorArea.setRangeText("", lineStart, lineEnd, "start");
                
                    // Re-fetch updated text after deletion
                    const newText = editorArea.value;
                
                    // Place cursor at start of deleted line (or end of buffer if needed)
                    const newPos = Math.min(lineStart, newText.length);
                    editorArea.selectionStart = editorArea.selectionEnd = newPos;
                
                    syncFile();
                    performed = true;
                } else {
                    let start, end;
                    
                    start = editorArea.selectionStart;
                    end = editorArea.selectionEnd;

                    // Only delete if there's actually something selected
                    if (start !== end) {
                        const deletedLength = end - start;
                    
                        // Delete the text
                        editorArea.setRangeText("", start, end, "start");
                    
                        // After deletion, the caret has shifted forward in some browsers.
                        // Reset it back by subtracting the deleted length.
                        let newPos = editorArea.selectionStart - deletedLength;
                        if (newPos < 0) newPos = 0;
                    
                        editorArea.selectionStart = editorArea.selectionEnd = newPos;
                        syncFile();
                    } else {
                        mode_deleting = true;
                    }
                }
            }
        }
        // ---------------------------------------------------------------------

        function visualKeys(e) {
            e.preventDefault();
            
            switch (e.key) {
                case "Escape":
                    exitVisualMode();
                    return true;
                case "h": // Move left and extend selection
                    visual_end = Math.max(0, visual_end - mode_repeat);
                    updateVisualSelection();
                    return true;
                case "l": // Move right and extend selection  
                    visual_end = Math.min(editorArea.value.length, visual_end + mode_repeat);
                    updateVisualSelection();
                    keyPerformed();
                    return true;
                case "d": // Delete selection (no copy)
                    doVisualDelete(e);
                    return true;
                case "y": // Yank (copy)
                    vim_clipboard = getVisualSelection();
                    if (vim_clipboard) {
                        navigator.clipboard.writeText(vim_clipboard).catch(err => {
                            console.error("Clipboard write failed:", err);
                        });
                    }
                    exitVisualMode();
                    return true;
                case "x": // Cut (copy + delete selection)
                    vim_clipboard = getVisualSelection();
                    if (vim_clipboard) {
                        navigator.clipboard.writeText(vim_clipboard).catch(err => {
                            console.error("Clipboard write failed:", err);
                        });
                    }
                
                    doVisualDelete(e);
                    return true;
                case "d": // Delete
                    vim_clipboard = getVisualSelection();
                    deleteVisualSelection();
                    return true;
                // Add more movement commands as needed
            }

            return false;
        }



        //---- Commands --------------------------------------------------------
        function ensureSelection(){
            if (!selectedId && treeData[0]) selectedId = treeData[0].id;
        }

        function keyPerformed() {
            mode_repeat = 1;
            mode_counting = false;
            mode_going = false;
            mode_deleting = false;
        }

        function activateTree() {
            modeEl.textContent = 'TREE';
            editing = false;
            mode_insert = false;
        }

        function setVimMode(insertMode) {
            if (insertMode) {
                mode_insert = true;
                modeEl.textContent = 'INSERT';
            } else {
                mode_insert = false;
                if (mode_visual) {
                    exitVisualMode();
                }
                modeEl.textContent = 'NORMAL';
            }
        }

        function scrollToCursor() {
            const pos = editorArea.selectionStart;
            const textBefore = editorArea.value.slice(0, pos);
            const lineIndex = textBefore.split("\n").length - 1;
            const lineHeight = 16; // adjust if your textarea font-size/line-height differs
        
            editorArea.scrollTop = lineIndex * lineHeight;
        }

        function addRoot(){
            if (readOnly) return;
            const node = { id: makeId(), title: 'New Folder', content: '', children: [], expanded: true };
            treeData.push(node);
            selectedId = node.id;
        }
        function addAfter(){
            if (readOnly) return;
            if (!treeData || treeData.length === 0) {
                addRoot();
                return;
            }
            ensureSelection();
            const ctx = getSiblingsAndIndex(selectedId);
            if (!ctx) return;
            const node = { id: makeId(), title: 'New Folder', content: '', children: [], expanded: true };
            ctx.siblings.splice(ctx.index + 1, 0, node);
            selectedId = node.id;
        }
        function addChild(){
            if (readOnly) return;
            if (!treeData || treeData.length === 0) return;
            ensureSelection();
            const info = findNodeAndParentById(selectedId);
            if (!info) return;
            info.node.expanded = true;
            const node = { id: makeId(), title: 'New Folder', content: '', children: [], expanded: true };
            info.node.children.push(node);
            selectedId = node.id;
        }
        function renameFolder() {
            if (readOnly) return;
            if (!treeData || treeData.length === 0) return;
            ensureSelection();
            let selectedNode = findNodeAndParentById(selectedId).node;
            if (isFolder(selectedNode)) {
                let newName = prompt('Enter new folder name:', selectedNode.name);
                if (!newName) { return; }
                selectedNode.title = newName;
                render();
            }
        }
        function selectNextSibling(curLevelOnly) {
            const info = findNodeAndParentById(selectedId);
            if (!info) return;
        
            // Case 1: current is a folder with children
            if (!curLevelOnly) {
                if (isFolder(info.node) && info.node.children.length) {
                    if (!info.node.expanded) {
                        info.node.expanded = true; // expand if collapsed
                    }
                    selectedId = info.node.children[0].id;
                    return;
                }
            }
        
            // Case 2: move to next sibling at this level
            const ctx = getSiblingsAndIndex(selectedId);
            if (!ctx) return;
            if (ctx.index < ctx.siblings.length - 1) {
                selectedId = ctx.siblings[ctx.index + 1].id;
                return;
            }
        
            // Case 3: last sibling climb ancestors until one has a next sibling
            if (!curLevelOnly) {
                let ancestorId = ctx.parent ? ctx.parent.id : null;
                while (ancestorId) {
                    const actx = getSiblingsAndIndex(ancestorId);
                    if (!actx) break;
            
                    if (actx.index < actx.siblings.length - 1) {
                        selectedId = actx.siblings[actx.index + 1].id;
                        return;
                    }
            
                    // go up another level
                    ancestorId = actx.parent ? actx.parent.id : null;
                }
            }
        }
        function selectPrevSibling(curLevelOnly) {
            const ctx = getSiblingsAndIndex(selectedId);
            if (!ctx) return;
        
            // If we are the first child, go to parent instead
            if (!curLevelOnly) {
                if (ctx.index === 0 && ctx.parent) {
                    selectedId = ctx.parent.id;
                    return;
                }
            }
        
            // Otherwise go to previous sibling
            const prev = Math.max(ctx.index - 1, 0);
            selectedId = ctx.siblings[prev].id;
        }
        function moveRight(){
            const info = findNodeAndParentById(selectedId); if (!info) return;
            if (info.node.children.length && !info.node.expanded) {
                info.node.expanded = true;
            } else if (info.node.children.length) {
                selectedId = info.node.children[0].id;
            }
        }
        function moveLeft(doCollapse){
            const info = findNodeAndParentById(selectedId); if (!info) return;
            if (info.node.expanded && doCollapse) {
                info.node.expanded = false;
            } else {
                if (info.parent) selectedId = info.parent.id;
            }
        }
        function collapseAll(){
            (function walk(list){
                for (const n of list){ n.expanded = false; walk(n.children); }
            })(treeData);
            selectedId = treeData[0].id;
        }
        function expandAll(){
            (function walk(list){
                for (const n of list){ n.expanded = true; walk(n.children); }
            })(treeData);
        }
        function gotoTop(){
            selectedId = treeData[0].id;
            treeEl.scrollTo(0, 0, "smooth");
        }
        function gotoBottom(){
            selectedId = treeData[treeData.length-1].id;
            treeEl.scrollTo(0, treeEl.scrollHeight, "smooth");
        }
        function moveOutToParent(){
            if (readOnly) return;
            const ctx = getSiblingsAndIndex(selectedId); if (!ctx || !ctx.parent) return; // already root
            // Remove from current siblings
            const [node] = ctx.siblings.splice(ctx.index, 1);
            // Insert after parent in its own siblings list
            const pctx = getSiblingsAndIndex(ctx.parent.id);
            const insertAt = pctx.index + 1;
            pctx.siblings.splice(insertAt, 0, node);
            selectedId = node.id;
        }
        function moveIntoAsChild(){
            if (readOnly) return;
            const info = findNodeAndParentById(selectedId); if (!info) return;
            // Move selected under some other selected? Spec: 'L' moves the current node into the currently selected node, as a child.
            // Since there's only one selection, interpret as: move the node into its next sibling if any; else do nothing.
            // Better: if the node has a previous sibling, move it into that sibling (common Vim tree behavior with L)?
            // But spec says: into the currently selected node — that's the node itself; so allow moving the PREVIOUS sibling into CURRENT with hotkey on that previous sibling would be impossible.
            // We'll interpret L as: if there is a previous sibling, move this node into that previous sibling as a child; otherwise if current has a next sibling, move into that. If neither, no-op.

            const ctx = getSiblingsAndIndex(selectedId); if (!ctx) return;
            const target = ctx.siblings[ctx.index - 1] || ctx.siblings[ctx.index + 1];
            if (!target) return;
            if (!Array.isArray(target.children)) target.children = [];
            target.expanded = true;
            const [node] = ctx.siblings.splice(ctx.index, 1);
            target.children.push(node);
            selectedId = node.id;
        }
        function reorderAmongSiblings(dir){
            if (readOnly) return;
            const ctx = getSiblingsAndIndex(selectedId); if (!ctx) return;
            const newIndex = ctx.index + (dir === 'down' ? 1 : -1);
            if (newIndex < 0 || newIndex >= ctx.siblings.length) return;
            const [node] = ctx.siblings.splice(ctx.index, 1);
            ctx.siblings.splice(newIndex, 0, node);
            selectedId = node.id;
        }
        function deleteNode(){
            if (readOnly) return;
            const ctx = getSiblingsAndIndex(selectedId); if (!ctx) return;
            const goTo = ctx.siblings[ctx.index + 1] || ctx.siblings[ctx.index - 1] || ctx.parent || treeData[0] || null;
            ctx.siblings.splice(ctx.index, 1);
            selectedId = goTo ? (goTo.id || goTo) : null;
        }
        function resizeTree(adjustment){
            const app = document.querySelector('.app');
            if (!app) return;

            // Get the current grid-template-columns value
            const style = window.getComputedStyle(app);
            const gridCols = style.getPropertyValue('grid-template-columns').split(' ');

            // Parse the first column (tree width)
            let treeWidth = parseInt(gridCols[0]);
            if (isNaN(treeWidth)) return;

            treeWidth += adjustment;

            if (treeWidth < 240) {
                treeWidth = 240;
            }

            // Update the grid-template-columns
            app.style.gridTemplateColumns = `${treeWidth}px 1fr`;
        }
        function insertHr() {
            const insertText = "--------------------------------------------------------------------------------";
            const start = editorArea.selectionStart;
            const end = editorArea.selectionEnd;

            // Insert at the cursor position
            const text = editorArea.value;
            editorArea.value = text.slice(0, start) + insertText + text.slice(end);

            // Move the cursor to the end of the inserted text
            editorArea.selectionStart = editorArea.selectionEnd = start + insertText.length;

            syncFile();
        }
        function wrapSelection() {
            const start = editorArea.selectionStart;
            const end = editorArea.selectionEnd;
            const text = editorArea.value;
        
            // Get selected text (or whole content if nothing selected)
            const selected = start !== end ? text.slice(start, end) : text;
        
            // Wrap lines at <= 80 chars without breaking words
            const words = selected.split(/\s+/);
            let lines = [];
            let line = "";
        
            for (const word of words) {
                if ((line + word).length > 80) {
                    lines.push(line.trimEnd());
                    line = word + " ";
                } else {
                    line += word + " ";
                }
            }
            if (line.trim().length > 0) lines.push(line.trimEnd());
        
            const wrapped = lines.join("\n");
        
            // Replace in editor
            editorArea.setRangeText(wrapped, start, end, "select");
        
            syncFile();
            showMessage("Wrapped to 80 characters");
        }
        function formatMarkdownTable() {
            const ta = document.getElementById("editorArea");
            const start = ta.selectionStart;
            const end = ta.selectionEnd;
            const value = ta.value;

            // Get selection or current line if none
            const sel = start !== end
                ? value.slice(start, end)
                : (() => {
                    const ls = value.lastIndexOf("\n", start - 1) + 1;
                    const le = value.indexOf("\n", start);
                    return value.slice(ls, le === -1 ? value.length : le);
                })();

            if (!/\|/.test(sel)) return; // no table detected

            const rawLines = sel.trim().split(/\r?\n/);

            // Matches:
            //   | ---- | ---- |   (old markdown style)
            //   +------+------+
            //   ----             (plain)
            const dividerPattern = /^\s*(?:[\|+]\s*-+\s*(?:[\|+]\s*-+\s*)*[\|+]|-+)\s*$/;

            const hasDivider = rawLines.some(line => dividerPattern.test(line));

            // Filter out dividers for measuring widths
            const contentLines = rawLines.filter(line => !dividerPattern.test(line));
            if (contentLines.length === 0) return;

            // Parse rows into cells
            const table = contentLines.map(line =>
                line.split("|")
                    .map(c => c.trimEnd())
                    .filter((c, i, arr) => !(i === 0 && c === "") && !(i === arr.length - 1 && c === ""))
            );

            // Compute max width per column
            const widths = [];
            table.forEach(row => {
                row.forEach((cell, i) => {
                    widths[i] = Math.max(widths[i] || 0, cell.trim().length);
                });
            });

            // Build ASCII-style separator
            const makeSep = () => "+" + widths.map(w => "-".repeat(w + 2)).join("+") + "+";

            // Build padded table rows
            const padded = table.map(row =>
                "|" + row.map((cell, i) => {
                    const trimmed = cell.trim();
                    const pad = widths[i] - trimmed.length;
                    return " " + trimmed + " ".repeat(pad) + " ";
                }).join("|") + "|"
            );

            // Rebuild all lines: regenerate every separator, reformat all content
            const finalRows = [];
            let rowIndex = 0;

            for (const line of rawLines) {
                if (dividerPattern.test(line)) {
                    // Always rebuild separator lines
                    finalRows.push(makeSep());
                } else if (rowIndex < padded.length) {
                    // Replace content rows with padded versions
                    finalRows.push(padded[rowIndex++]);
                }
            }

            // If no dividers were present at all, just output the padded content
            if (!hasDivider) {
                finalRows.length = 0;
                finalRows.push(...padded);
            }

            ta.setRangeText(finalRows.join("\n"), start, end, "select");
        }
        function setMark(e) {
            e.preventDefault();
            e.stopPropagation();

            ensureSelection();
            let currentNode = findNodeAndParentById(selectedId).node;
            let path = computePath(currentNode.id);

            if (currentNode) {
                bookmarks.push({
                    id: currentNode.id,
                    caption: currentNode.title,
                    path: path
                });
                showMessage(`Bookmarked: ${currentNode.title}`);
            }
        }

        function getNodePath(node) {
            let path = [];
            let cur = node;
            while (cur) {
                path.unshift(cur.caption);
                cur = cur.parent;
            }
            return path.join(" / ");
        }


        //---- Options ---------------------------------------------------------
        function openOptionsDialog() {
            optShowInitHelp.checked = showInitHelp;
            optFileName.value = fileName;
            optModeVim.checked = mode_vim;
            optPort.value = nodePort;
            optionsDialog.style.display = 'block';
            optionIndex = 0;
            optionFields[optionIndex].focus();
        }
        function closeOptionsDialog() {
            optionsDialog.style.display = 'none';
        }
        function saveOptionsDialog() {
            showInitHelp = optShowInitHelp.checked;
            fileName = optFileName.value || fileName;
            mode_vim = optModeVim.checked;
            nodePort = optPort.value;
            closeOptionsDialog();
        }



        //---- Links -----------------------------------------------------------
        function openLinksDialog() {
            showingLinks = true;
            const info = findNodeAndParentById(selectedId);
            if (!info || !info.node.content) return;

            const content = safeRestoreText(info.node.content);
            const listEl = document.getElementById('linksList');
            listEl.innerHTML = '';

            // Markdown-style links:
            // [Label] followed directly or by whitespace/newline with (https://...) or (_Note_)
            const markdownLinkRegex = /\[([^\]]+)\](?:[ \t]*\r?\n[ \t]*|[ \t]*)(https?:\/\/\S+|file:\/\/\S+|_[^_]+_)/gi;

            // Generic standalone links
            const urlRegex = /\b(?:https?|file):\/\/[^\s]+/gi;
            const nodeLinkRegex = /(?:^|\s|\()_(.+?)_(?=\s|[.,!?;:)]|$)/g;

            const foundLinks = [];
            let match;

            // --- Collect properly formed markdown-style links ---
            while ((match = markdownLinkRegex.exec(content)) !== null) {
                const label = match[1].trim();
                const target = match[2].trim();
                foundLinks.push({ label, target, fromMarkdown: true });
            }

            // --- Collect plain URLs not already captured ---
            const urlMatches = content.match(urlRegex) || [];
            for (const url of urlMatches) {
                if (!foundLinks.some(l => l.target === url)) {
                    foundLinks.push({ label: url, target: url });
                }
            }

            // --- Collect underscore note links not already captured ---
            while ((match = nodeLinkRegex.exec(content)) !== null) {
                const title = match[1].trim().replace(/^_+|_+$/g, "");
                const wrapped = `_${title}_`;
                if (!foundLinks.some(l => l.target === wrapped)) {
                    foundLinks.push({ label: title, target: wrapped });
                }
            }

            // --- Render the collected links ---
            if (foundLinks.length === 0) {
                listEl.innerHTML = '<p>No links found.</p>';
            } else {
                for (const { label, target, fromMarkdown } of foundLinks) {
                    const a = document.createElement('a');
                    let displayLabel = fromMarkdown ? label : target;
                    
                    // If it's a wrapped note link (e.g. _Some Note_), show only the inner text
                    if (/^_.+_$/.test(displayLabel)) {
                        displayLabel = displayLabel.slice(1, -1);
                    }
                    
                    a.textContent = displayLabel;

                    if (/^(https?|file):\/\//i.test(target)) {
                        // External URL
                        a.href = target;
                        a.target = '_blank';
                    } else if (target.startsWith('_') && target.endsWith('_')) {
                        // Note link
                        const title = target.slice(1, -1).toLowerCase();
                        let foundNode = null;

                        (function walk(nodes) {
                            for (const n of nodes) {
                                if (n.title && n.title.toLowerCase() === title) {
                                    foundNode = n;
                                    return;
                                }
                                if (n.children && n.children.length) walk(n.children);
                                if (foundNode) return;
                            }
                        })(treeData);

                        a.href = '#';
                        if (foundNode) {
                            a.dataset.nodeId = foundNode.id;
                            a.addEventListener('click', (e) => {
                                e.preventDefault();
                                expandToNode(foundNode.id);
                                selectedId = foundNode.id;
                                closeLinksDialog();
                                render();
                            });
                        } else {
                            a.style.color = '#888';
                            a.title = 'Node not found';
                        }
                    } else {
                        // Fallback
                        a.href = '#';
                        a.style.color = '#888';
                        a.title = 'Unrecognized link format';
                    }

                    listEl.appendChild(a);
                }

                const links = listEl.querySelectorAll('a');
                linksIndex = 0;
                if (links.length > 0) {
                    links[linksIndex].classList.add('selected');
                }
            }

            linksDialog.style.display = 'block';
        }

        function closeLinksDialog() {
            showingLinks = false;
            linksDialog.style.display = 'none';
        }

        function openHistoryDialog() {
            showingHistory = true;
            historyIndex = 0;
            renderHistoryList();
            document.getElementById('historyDialog').style.display = 'block';
        }

        function openSaveAsDialog(defaultTitle = document.title, defaultFile = fileName) {
            const titleInput = document.getElementById('saveAsTitle');
            const fileInput = document.getElementById('saveAsFileName');

            titleInput.value = defaultTitle || '';
            fileInput.value = defaultFile || '';

            saveAsDialog.style.display = 'block';
            titleInput.focus();
            titleInput.select();

            function closeDialog() {
                saveAsDialog.style.display = 'none';
                document.removeEventListener('keydown', keyHandler);
            }

            function keyHandler(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const newTitle = titleInput.value.trim() || 'Untitled';
                    const newFile = fileInput.value.trim() || 'untitled';
                    fileName = newFile;
                    document.title = newTitle;
                    closeDialog();
                    saveAsHtml(newFile);
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    closeDialog();
                }
            }

            document.addEventListener('keydown', keyHandler);
        }
        
        function closeHistoryDialog() {
            showingHistory = false;
            document.getElementById('historyDialog').style.display = 'none';
        }
        
        function renderHistoryList() {
            const listEl = document.getElementById('historyList');
            listEl.innerHTML = '';
            const recent = historyStack.slice(-historyStackMax).reverse(); // latest first
            recent.forEach((entry, i) => {
                const div = document.createElement('div');
                div.textContent = entry.title;
                if (i === historyIndex) {
                    div.classList.add('selected');
                    div.style.background = '#444'; // ensure visible
                    requestAnimationFrame(() => div.scrollIntoView({ block: "nearest", behavior: "smooth" }));
                }
                listEl.appendChild(div);
            });
        }

        function renderMarksList() {
            let html = "<br><table>";
            bookmarks.forEach((bm, i) => {
                let sel = (i === marksIndex) ? "style='background:#444;'" : "";
                html += `<tr ${sel}><td>${bm.caption}</td><td>${bm.path}</td></tr>`;
            });
            html += "</table>";
            marksList.innerHTML = html;
        }

        function closeMarksDialog() {
            marksDialog.style.display = "none";
            showingMarks = false;
        }

        function closeDialogs() {
            closeSearch();
            closeHelpDialog();
            closeOptionsDialog();
            closeLinksDialog();
            closeHistoryDialog();
            closeMarksDialog();
        }





        //---- Finding and Replacing -------------------------------------------
        function openReplaceDialog() {
            finding = true;
            findMatches = [];
            currentFindIndex = -1;
            const resultsEl = document.getElementById('findResults');
            resultsEl.innerHTML = '';
            document.getElementById('searchText').value = '';
            document.getElementById('replaceText').value = '';
            document.getElementById('replaceDialog').style.display = 'block';
            document.getElementById('searchText').focus();
        }

        function closeReplaceDialog() {
            document.getElementById('replaceDialog').style.display = 'none';
            finding = false;
        }

        function doFind() {
            const info = findNodeAndParentById(selectedId);
            if (!info) return;

            const searchVal = document.getElementById('searchText').value.trim();
            const resultsEl = document.getElementById('findResults');
            const area = document.getElementById('editorArea');
            const content = safeRestoreText(info.node.content) || '';

            resultsEl.innerHTML = '';
            findMatches = [];
            currentFindIndex = -1;

            if (!searchVal) {
                resultsEl.textContent = 'Enter something to search for.';
                return;
            }

            const regex = new RegExp(searchVal.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
            let match;
            const contextRadius = 20;
            let resultHTML = '';

            while ((match = regex.exec(content)) !== null) {
                const start = Math.max(0, match.index - contextRadius);
                const end = Math.min(content.length, match.index + match[0].length + contextRadius);
                const context = content.substring(start, end)
                    .replace(/</g, "&lt;").replace(/>/g, "&gt;");
                const highlighted = context.replace(new RegExp(searchVal, 'gi'), 
                    m => `<span class="find-highlight">${m}</span>`);

                findMatches.push({ index: match.index, length: match[0].length });
                resultHTML += `<div class="find-item" data-idx="${findMatches.length - 1}" 
                                style="cursor:pointer; padding:2px; overflow: auto; font-size: 60%;">
                                ${highlighted}
                               </div>`;
            }

            if (findMatches.length === 0) {
                resultsEl.textContent = 'No matches found.';
            } else {
                resultsEl.innerHTML = resultHTML;
            }

            if (findMatches.length > 0) {
                currentFindIndex = 0;
                const first = resultsEl.querySelectorAll('.find-item')[0];
                if (first) {
                    first.style.background = '#333';
                    first.scrollIntoView({ block: 'nearest' });
                }
            }

            // Click handler
            resultsEl.querySelectorAll('.find-item').forEach(div => {
                div.addEventListener('click', e => {
                    const idx = parseInt(div.dataset.idx);
                    selectFindMatch(idx);
                    closeReplaceDialog();
                });
            });
        }
        function selectFindMatch(idx) {
            if (idx < 0 || idx >= findMatches.length) return;

            const area = document.getElementById('editorArea');
            const match = findMatches[idx];
            currentFindIndex = idx;

            // Scroll and select
            area.setSelectionRange(match.index, match.index + match.length);
            setVimMode(false);
            editing = true;
            area.focus();
        }
        function navigateFindResults(dir) {
            if (findMatches.length === 0) return;
            if (currentFindIndex === -1) currentFindIndex = 0;
            else currentFindIndex = (currentFindIndex + dir + findMatches.length) % findMatches.length;

            const resultDivs = document.querySelectorAll('#findResults .find-item');
            resultDivs.forEach(div => div.style.background = '');
            const active = resultDivs[currentFindIndex];
            if (active) {
                active.style.background = '#333';
                active.scrollIntoView({ block: 'nearest' });
            }
            // Keep selection synced with highlighted result
            const area = document.getElementById('editorArea');
            const match = findMatches[currentFindIndex];
            area.focus();
            area.setSelectionRange(match.index, match.index + match.length);
        }

        function doReplaceAll() {
            const info = findNodeAndParentById(selectedId);
            if (!info) return;

            const searchVal = document.getElementById('searchText').value;
            const replaceVal = document.getElementById('replaceText').value;
            const resultsEl = document.getElementById('replaceResults');

            if (!searchVal) {
                resultsEl.textContent = 'Enter something to search for.';
                return;
            }

            const regex = new RegExp(searchVal.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
            let content = safeRestoreText(info.node.content) || '';
            const matchCount = (content.match(regex) || []).length;

            if (matchCount > 0) {
                content = content.replace(regex, replaceVal);
                editorArea.value = content;
                info.node.content = safeStoreText(content);
                render();
                resultsEl.textContent = `Replaced ${matchCount} occurrence(s).`;
            } else {
                resultsEl.textContent = 'No matches found.';
            }

            syncFile();
        }

        const searchInputEl = document.getElementById('searchText');
        const replaceInputEl = document.getElementById('replaceText');

        replaceInputEl.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.stopPropagation();
                doReplaceAll(); // replaces all
                closeReplaceDialog();
            }
        });







        //---- Copy / Paste ----------------------------------------------------
        function copyNode() {
            if (readOnly) return;
            const info = findNodeAndParentById(selectedId);
            if (info && !isFolder(info.node)) {
                copiedNoteId = info.node.id;
            } else {
                copiedNoteId = null;
            }
        }

        function pasteNode() {
            if (readOnly) return;
            if (copiedNoteId) {
                const info = findNodeAndParentById(selectedId);
                if (info && isFolder(info.node)) {
                    const original = findNodeAndParentById(copiedNoteId)?.node;
                    if (original) {
                        // Deep clone the note (new ID)
                        const cloneNode = JSON.parse(JSON.stringify(original));
                        cloneNode.id = makeId();
                        // Recursively assign new IDs to all children
                        (function fixIds(n) {
                            n.id = makeId();
                            n.children.forEach(fixIds);
                        })(cloneNode);
                        info.node.children.push(cloneNode);
                        info.node.expanded = true;
                        selectedId = cloneNode.id;
                    }
                }
            }
        }



        //---- Undo / Redo -----------------------------------------------------
        function doUndo() {
            editorArea.value = undoValue;
            syncFile();
        }


        //---- Visual Mode Helpers ---------------------------------------------
        function enterVisualMode(lineMode = false) {
            mode_visual = true;
            mode_visual_line = lineMode;
            visual_start = editorArea.selectionStart;
            visual_end = editorArea.selectionStart;
            modeEl.textContent = 'VISUAL';
            updateVisualSelection();
        }
        
        function exitVisualMode() {
            mode_visual = false;
            mode_visual_line = false;
            // Position cursor at the end of the selection
            let cursorPos = Math.max(visual_start, visual_end);

            if (visual_end < visual_start) {
                cursorPos = Math.min(visual_start, visual_end);
            }

            editorArea.selectionStart = editorArea.selectionEnd = cursorPos;
            visual_start = 0;
            visual_end = 0;
            modeEl.textContent = 'NORMAL';
        }
        
        function updateVisualSelection() {
            if (!mode_visual) return;
            
            let start = Math.min(visual_start, visual_end);
            let end = Math.max(visual_start, visual_end);
            
            if (mode_visual_line) {
                // Extend to full lines
                const text = editorArea.value;
                const lineStart = text.lastIndexOf('\n', start - 1) + 1;
                const lineEndPos = text.indexOf('\n', end);
                const lineEnd = lineEndPos === -1 ? text.length : lineEndPos + 1;
                start = lineStart;
                end = lineEnd;
            } else {
                // Character-wise - include character at cursor
                // if (end < editorArea.value.length) end += 1;
            }
            
            editorArea.setSelectionRange(start, end);
        }

        function getVisualSelection() {
            if (!mode_visual) return '';
            
            let start = Math.min(visual_start, visual_end);
            let end = Math.max(visual_start, visual_end);
            
            if (mode_visual_line) {
                const text = editorArea.value;
                const lineStart = text.lastIndexOf('\n', start - 1) + 1;
                const lineEndPos = text.indexOf('\n', end);
                const lineEnd = lineEndPos === -1 ? text.length : lineEndPos + 1;
                return text.substring(lineStart, lineEnd);
            } else {
                if (end < editorArea.value.length) end += 1;
                return editorArea.value.substring(start, end);
            }
        }
        
        function deleteVisualSelection() {
            // Similar logic to getVisualSelection but deletes the text
            // and exits visual mode
        }

        function doVisualDelete(e) {
            e.stopPropagation();
            let start = Math.min(visual_start, visual_end);
            let end = Math.max(visual_start, visual_end);
        
            if (mode_visual_line) {
                // Full line delete
                const text = editorArea.value;
                const lineStart = text.lastIndexOf("\n", start - 1) + 1;
                const lineEndPos = text.indexOf("\n", end);
                const lineEnd = lineEndPos === -1 ? text.length : lineEndPos + 1;
                editorArea.setRangeText("", lineStart, lineEnd, "start");
                editorArea.selectionStart = editorArea.selectionEnd = lineStart;
            } else {
                if (end === start) end += 1;
                const deletedLength = end - start;
                visual_end = visual_start;
                editorArea.setRangeText("", start, end, "start");
                editorArea.selectionStart = editorArea.selectionEnd = start;
            }
        
            syncFile();
            exitVisualMode();
        }



        //---- Search ----------------------------------------------------------
        function openSearch() {
            searchActive = true;
            searchDialog.style.display = 'flex';
            searchInput.value = '';
            searchInput.focus();
            searchMatches = [];
            searchIndex = 0;
            renderSearchList();
        }

        function closeSearch() {
            searchActive = false;
            searchDialog.style.display = 'none';
        }

        function searchTree(query) {
            searchMatches = [];
            const matchContent = !query.startsWith(':');
            const q = query.startsWith(':') ? query.slice(1).toLowerCase() : query.toLowerCase();
            (function walk(nodes) {
                for (const n of nodes) {
                    if ((n.title && n.title.toLowerCase().includes(q)) || (matchContent && n.content && n.content.toLowerCase().includes(q))) {
                        searchMatches.push(n);
                    }
                    if (n.children && n.children.length) walk(n.children);
                }
            })(treeData);
            searchIndex = 0;
            renderSearchList();
        }

        function renderSearchList() {
            searchList.innerHTML = '';
            searchMatches.forEach((n, i) => {
                const item = document.createElement('div');
                item.textContent = n.title || '(untitled)';
                if (i === searchIndex) {
                    item.classList.add('selected');
                    requestAnimationFrame(() => item.scrollIntoView({ block: "nearest", behavior: "smooth" }));
                }
                item.addEventListener('click', () => {
                    if (searchMatches.length > 0) {
                        selectSearchResult(i);
                        closeSearch();
                    }
                });
                searchList.appendChild(item);
            });
            if (searchMatches.length === 0) {
                const empty = document.createElement('div');
                empty.textContent = '(no matching nodes)';
                empty.style.color = '#888';
                searchList.appendChild(empty);
            }
        }

        function selectSearchResult(i) {
            if (i < 0 || i >= searchMatches.length) return;
            searchIndex = i;
            expandToNode(searchMatches[i].id);
            selectedId = searchMatches[i].id;
            render();
            renderSearchList();
        }

        function expandToNode(id) {
            let info = findNodeAndParentById(id);
            while (info && info.parent) {
                info.parent.expanded = true;
                info = findNodeAndParentById(info.parent.id);
            }
        }

        searchInput.addEventListener('input', e => {
            searchTree(e.target.value);
        });

        searchInput.addEventListener('keydown', e => {
            if (e.key === 'ArrowDown') {
                searchIndex = Math.min(searchIndex + 1, searchMatches.length - 1);
                renderSearchList();
                e.preventDefault();
            } else if (e.key === 'ArrowUp') {
                searchIndex = Math.max(searchIndex - 1, 0);
                renderSearchList();
                e.preventDefault();
            } else if (e.key === 'Enter') {
                if (searchMatches.length > 0) {
                    selectSearchResult(searchIndex);
                    closeSearch();
                }
            } else if (e.key === 'Escape') {
                closeSearch();
            }
        });




        //---- Help ------------------------------------------------------------
        function openHelpDialog(mode) {
            showingHelp = true;
            const dialog = document.getElementById('helpDialogUnified');
            const input = document.getElementById('helpFilter');
            const results = document.getElementById('helpResults');
            
            // pick which dataset to use
            let data;
            if (mode === 'ReadOnly') data = helpReadOnly;
            else if (mode === 'VimEnabled') data = helpVimEnabled;
            else data = helpVimDisabled;
        
            // --- Normalize comparison function ---
            function matches(h, term) {
                let t = term.trim().replace(/\s+/g, '').toLowerCase();
                let key = h.key.replace(/\s+/g, '').toLowerCase();
                let mode = h.mode ? h.mode.toLowerCase() : "";
                let desc = h.description.toLowerCase();
            
                // If the search starts with ":", search keys only
                if (t.startsWith(':')) {
                    t = t.slice(1); // remove ':'
                    return key.includes(t);
                }
            
                // Otherwise search all fields
                return key.includes(t) || mode.includes(t) || desc.includes(t);
            }
        
            // --- Rendering function ---
            function renderList(list) {
                if (list.length === 0) {
                    results.innerHTML = `<div style="opacity:0.6;">No matches found</div>`;
                    return;
                }
                results.innerHTML = list
                    .map(h => {
                        const modeSuffix = h.mode && h.mode.trim() !== "" ? ` <span class="dim">(${escapeHtml(h.mode)}) - </span>` : "";
                        return `<div><b>${escapeHtml(h.key)}</b>${modeSuffix}${escapeHtml(h.description)}</div>`;
                    })
                    .join('');
            }
        
            // --- Escape HTML for safety ---
            function escapeHtml(str) {
                if (str === undefined) return "";
                if (str === "") return str;

                return str.replace(/[&<>"']/g, c => ({
                    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
                }[c]));
            }
        
            // --- Show dialog ---
            dialog.style.display = 'flex';
            input.value = '';
            input.focus();
            renderList(data);
        
            // --- Filter on input ---
            input.oninput = () => {
                const term = input.value.trim();
                if (!term) return renderList(data);
                renderList(data.filter(h => matches(h, term)));
            };
        }
        
        function closeHelpDialog() {
            showingHelp = false;
            document.getElementById('helpDialogUnified').style.display = 'none';
        }




        //---- Saving ----------------------------------------------------------
        function getContents(name, saveName) {
            const elemLimit = 50; // Number of elements per line
            const htmlDoc = document.documentElement.cloneNode(true);

            // Make sure the latest database is stored
            const latestDatabase = JSON.parse(JSON.stringify(treeData));

            const lines = [];
            for (let i = 0; i < latestDatabase.length; i += elemLimit) {
                let chunk = latestDatabase.slice(i, i + elemLimit);
                lines.push(JSON.stringify(chunk).slice(1, -1)); // Strip [ and ]
            }
            let formattedDatabase = `[\n  ${lines.join(",\n  ")}\n]`;

            // Ensure correct replacement of the old database
            let htmlContent = "<!DOCTYPE html>" + htmlDoc.outerHTML;
            if (saveName) {
                htmlContent = htmlContent.replace(/let\s+fileName\s*=\s*"([^"]*)";/, `let fileName = "${name}";`);
            } else {
                // fileName
                htmlContent = htmlContent.replace(
                  /let\s+fileName\s*=\s*"([^"]*)";/,
                  `let fileName = "${fileName}";`
                );
            }

            // showInitHelp
            htmlContent = htmlContent.replace(
              /let\s+showInitHelp\s*=\s*(true|false);/,
              `let showInitHelp = ${showInitHelp};`
            );
            
            // mode_vim
            htmlContent = htmlContent.replace(
              /let\s+mode_vim\s*=\s*(true|false);/,
              `let mode_vim = ${mode_vim};`
            );

            // nodePort
            htmlContent = htmlContent.replace(
                /let\s+nodePort\s*=\s*\d+;/,
                `let nodePort = ${nodePort};`
            );

            htmlContent = htmlContent.replace(/let\s+treeData\s*=\s*\[[\s\S]*?\];/, `let treeData = ${formattedDatabase};`);

            // Make sure the latest bookmarks and historyStack are stored
            const latestBookmarks = JSON.parse(JSON.stringify(bookmarks));
            const latestHistoryStack = JSON.parse(JSON.stringify(historyStack));

            htmlContent = htmlContent.replace(
                /let\s+bookmarks\s*=\s*\[[\s\S]*?\];/,
                "let bookmarks = " + JSON.stringify(latestBookmarks, null, 4) + ";"
            );
            htmlContent = htmlContent.replace(
                /let\s+historyStack\s*=\s*\[[\s\S]*?\];/,
                "let historyStack = " + JSON.stringify(latestHistoryStack, null, 4) + ";"
            );

            return htmlContent;
        }


        function saveAsHtml(currentFileName) {
            let name = currentFileName;
            let saveName = false;
            if (name === "") {
                name = prompt("Save as .html (enter name without extension):", "");
                if (!name) return;
                saveName = true;
            }

            let htmlContent = getContents(name, saveName);

            let blob = new Blob([htmlContent], { type: "text/html" });
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `${name}.html`;
            a.click();
        }

        async function saveViaNode() {
            const content = getContents(fileName, false);

            const res = await fetch("http://localhost:"+nodePort+"/save", {
                method: "POST",
                headers: { 
                    "Content-Type": "text/plain",
                    "X-Filename": fileName + ".html"
                },
                body: content
            });

            if (res.ok) {
                showMessage("Saved successfully");
            } else {
                const errorText = await res.text();
                if (errorText.includes("SAFETY ERROR")) {
                    showMessage("!! " + errorText + " !!", 8000);
                } else {
                    showMessage("Save failed: " + errorText);
                }
            }
        }

        function exportNoteAsTxt() {
            const editorArea = document.getElementById("editorArea");
            if (!editorArea || editorArea.value === "") return;

            let content = editorArea.value;

            // Regex that preserves whitespace and line breaks around inter-note links
            const nodeLinkRegex = /(^|\s)_(.+?)_(?=\s|[.,!?;:)]|$)/g;
            content = content.replace(nodeLinkRegex, (match, leading, inner) => {
                return (leading || "") + inner; // keep whitespace/line breaks, drop underscores
            });

            // Ask for filename (no extension needed)
            const name = prompt("Save note as .txt (enter name without extension):", "");
            if (!name) return;

            const fileName = name + ".txt";

            // Create and trigger download
            const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }


        //---- Key Handling ----------------------------------------------------
        function handleGlobalKey(e){
            if (editing) {
                // Check if Ctrl (or Command on Mac) is held and the "-" key is pressed
                if ((e.ctrlKey || e.metaKey) && (e.key === "-" || e.code === "Minus")) {
                    e.preventDefault(); // optional: prevents browser zoom-out
                    insertHr();
                    return;
                }

                if ((e.ctrlKey || e.metaKey) && (e.key === "\\" || e.code === "Backslash")) {
                    e.preventDefault();
                    e.stopPropagation();
                    wrapSelection();
                    return;
                }

                if (e.ctrlKey && e.key === ";") {
                    e.preventDefault();
                    formatMarkdownTable();
                }

                return;
            }

            if (e.ctrlKey || e.metaKey || e.altKey) return;

            if (finding) {
                switch (e.key) {
                    case 'Escape':
                        closeReplaceDialog();
                        break;
                    case 'ArrowDown':
                        navigateFindResults(1);
                        e.preventDefault();
                        break;
                    case 'ArrowUp':
                        navigateFindResults(-1);
                        e.preventDefault();
                        break;
                    case "Enter":
                        if (document.getElementById('replaceText').value !== "") break;
                        e.preventDefault();
                        e.stopPropagation();
                        if (currentFindIndex !== -1) {
                            selectFindMatch(currentFindIndex);
                            closeReplaceDialog();
                        } else {
                            doFind();
                        }
                        break;
                }

                return;
            }

            if (e.key === '/' && !editing && !dialogOpen()) {
                openSearch();
                e.preventDefault();
                return;
            }

            if (searchActive || showingHelp) return;

            const k = e.key; // compare exact letter; do not rely on shift state
            let did = true;

            if (dialogOpen()) {
                return;
            }

            switch (k) {
                case 'i':
                    if (!readOnly) {
                        e.preventDefault();
                        const info = findNodeAndParentById(selectedId); if (!info) return;
                        editing = true; render();
                        editorArea.focus();
                        editorArea.setSelectionRange(0, 0); 
                        scrollToCursor();
                        addUndo();
                        if (mode_vim) {
                            setVimMode(false);
                            return;
                        } else {
                            setVimMode(true);
                            return;
                        }
                    }
                    break;
                case 'I':
                    if (!readOnly) {
                        e.preventDefault();
                        addUndo();
                        const info = findNodeAndParentById(selectedId); if (!info) return;
                        editing = true; render();
                        editorArea.focus();
                        editorArea.setSelectionRange(0, 0); 
                        scrollToCursor();
                        setVimMode(true);
                        return;
                    }
                    break;
                case 'Escape':
                    if (showingLinks) {
                        closeLinksDialog();
                        e.preventDefault();
                    }
                    else {
                        did = false;
                    }
                    break; // handled in textarea
                case 'f': if (!editing) openReplaceDialog(); break;
                case 'r': if (!readOnly) addRoot(); break;
                case 'R': if (!readOnly) renameFolder(); break;
                case 'j': if (!dialogOpen()) selectNextSibling(true); break;
                case 'k': if (!dialogOpen()) selectPrevSibling(false); break;
                case 'l': moveRight(); break;
                case 'h': moveLeft(true); break;
                case 'u': moveLeft(false); break;
                case 'C': collapseAll(); break;
                case 'E': expandAll(); break;
                case 'g': gotoTop(); break;
                case 'G': gotoBottom(); break;
                case 'A': addChild(); break;
                case 'a': addAfter(); break;
                case 'H': moveOutToParent(); break;
                case 'L': moveIntoAsChild(); break;
                case 'J': reorderAmongSiblings('down'); break;
                case 'K': reorderAmongSiblings('up'); break;
                case 'D': deleteNode(); break;
                case 's': saveAsHtml(fileName); break;
                case 'S': openSaveAsDialog(); break;
                case 'n': saveViaNode(); break;
                case 'T': exportNoteAsTxt(); break;
                case ']': resizeTree(30); break;
                case '[': resizeTree(-30); break;
                case '#': openLinksDialog(); break;
                case 'm': setMark(e); break;
                case '`': openMarksDialog(); break;
                case 'X': openMissingLinksDialog(); break;
                case 'y': copyNode(); break;
                case 'p': pasteNode(); break;
                case '<':
                    openHistoryDialog();
                    e.preventDefault();
                    return;
                default: did = false; break;
            }
            if (did) { e.preventDefault(); render(); }
        }

        document.addEventListener('keydown', e => {
            if (e.key === '?' && !editing && !dialogOpen()) {
                e.preventDefault();
                if (readOnly) openHelpDialog('ReadOnly');
                else if (mode_vim) openHelpDialog('VimEnabled');
                else openHelpDialog('VimDisabled');
                return;
            }
            if (optionsDialog.style.display === 'block') {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveOptionsDialog();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    closeOptionsDialog();
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    optionIndex = (optionIndex + 1) % optionFields.length;
                    optionFields[optionIndex].focus();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    optionIndex = (optionIndex - 1 + optionFields.length) % optionFields.length;
                    optionFields[optionIndex].focus();
                } else if (e.key === ' ') {
                    // Toggle checkbox if that's the active element
                    if (document.activeElement.type === 'checkbox') {
                        e.preventDefault();
                        document.activeElement.checked = !document.activeElement.checked;
                    }
                }
            } else if (e.key === '!' && !editing && !readOnly && !dialogOpen()) {
                e.preventDefault();
                openOptionsDialog();
            }
            if (e.key === 'U' && !editing && !dialogOpen()) {
                document.getElementById('filePicker').click()
            }

            if (e.key === 'Escape') {
                repeatCount = 1;

                if (showingHelp) {
                    closeHelpDialog();
                    e.stopPropagation();
                    return;
                }
            }
        });

        window.addEventListener('keydown', handleGlobalKey, { capture: true });

        function escapeForScript(json){
            return json.replace(/<\//g, '<\\/'); // avoid closing script tags
        }

        function dialogActive() {

        }

    let linksIndex = 0;
    let linksCount = 0;
    let findMatches = [];
    let currentFindIndex = -1;

    function openMissingLinksDialog() {
        if (readOnly) return;
        showingLinks = true;
        const nodeLinkRegex = /(?:^|\s)_(.+?)_(?=\s|[.,!?;:)]|$)/g;

        // Gather all node titles (case-insensitive)
        const allTitles = new Set();
        (function walkTitles(nodes) {
            for (const n of nodes) {
                if (n.title) {
                    allTitles.add(n.title.trim().toLowerCase());
                }
                if (n.children && n.children.length) walkTitles(n.children);
            }
        })(treeData);

        // Map of missingLink → set of nodes that reference it
        const missingMap = new Map();

        (function walk(nodes) {
            for (const n of nodes) {
                if (n.content) {
                    let seenInThisNode = new Set(); // avoid dupes within the same note
                    let match;
                    while ((match = nodeLinkRegex.exec(n.content)) !== null) {
                        const linkTitle = match[1].trim();
                        if (!allTitles.has(linkTitle.toLowerCase())) {
                            if (!seenInThisNode.has(linkTitle.toLowerCase())) {
                                if (!missingMap.has(linkTitle)) {
                                    missingMap.set(linkTitle, []);
                                }
                                missingMap.get(linkTitle).push({
                                    nodeId: n.id,
                                    nodeTitle: n.title || '(untitled)'
                                });
                                seenInThisNode.add(linkTitle.toLowerCase());
                            }
                        }
                    }
                }
                if (n.children && n.children.length) walk(n.children);
            }
        })(treeData);

        const listEl = document.getElementById('linksList');
        listEl.innerHTML = '';

        if (missingMap.size === 0) {
            listEl.innerHTML = '<p>No missing links found</p>';
        } else {
            listEl.innerHTML = '<p>Missing Links:</p>';
            for (const [missingTitle, refs] of missingMap.entries()) {
                refs.forEach(ref => {
                    const container = document.createElement('div');

                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = `"${missingTitle}" — linked from: ${ref.nodeTitle}`;
                    link.style.color = '#888';
                    link.title = 'Missing link — click to go to note';

                    // Clicking takes you to the referencing note
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        expandToNode(ref.nodeId);
                        selectedId = ref.nodeId;
                        closeLinksDialog();
                        render();
                    });

                    container.appendChild(link);
                    listEl.appendChild(container);
                });
            }
        }

        linksDialog.style.display = 'block';
    }

    function openMarksDialog() {
        if (bookmarks.length === 0) {
            alert("No bookmarks yet.");
            return;
        }

        marksIndex = 0;
    
        function render() {
            let html = "<br><table>";
            bookmarks.forEach((bm, i) => {
                let sel = (i === marksIndex) ? "style='background:#444;'" : "";
                html += `<tr ${sel}><td>${bm.caption}</td><td>${bm.path}</td></tr>`;
            });
            html += "</table>";
            marksList.innerHTML = html;
        }
    
        showingMarks = true;
        marksDialog.style.display = "block";
        render();
    }

    function activateSelectedLink() {
        const listEl = document.getElementById('linksList');
        const links = listEl.querySelectorAll('a');
        if (linksIndex < 0 || linksIndex >= links.length) return;
        const link = links[linksIndex];
        if (link.dataset.nodeId) {
            expandToNode(link.dataset.nodeId);
            selectedId = link.dataset.nodeId;
            closeLinksDialog();
            render();
        } else {
            link.click();
        }
    }

    function handleLinksKey(e) {
        if (!showingLinks) return;
        const listEl = document.getElementById('linksList');
        const links = listEl.querySelectorAll('a');

        if (e.key === 'ArrowDown' || e.key === 'j') {
            if (links.length === 0) return;
            links[linksIndex].classList.remove('selected');
            linksIndex = (linksIndex + 1) % links.length;
            links[linksIndex].classList.add('selected');
            e.preventDefault();
        } else if (e.key === 'ArrowUp' || e.key === 'k') {
            if (links.length === 0) return;
            links[linksIndex].classList.remove('selected');
            linksIndex = (linksIndex - 1 + links.length) % links.length;
            links[linksIndex].classList.add('selected');
            e.preventDefault();
        } else if (e.key === 'Enter') {
            if (links.length === 0) return;
            activateSelectedLink();
            e.preventDefault();
        } else if (e.key === 'Escape') {
            closeLinksDialog();
            e.preventDefault();
        }
    }

    function handleMarksKey(e) {
        if (!showingMarks) return;

        if (e.key === "ArrowDown" || e.key === 'j') {
            marksIndex = (marksIndex + 1) % bookmarks.length;
            renderMarksList();
            e.preventDefault();
        } else if (e.key === "ArrowUp" || e.key === 'k') {
            marksIndex = (marksIndex - 1 + bookmarks.length) % bookmarks.length;
            renderMarksList();
            e.preventDefault();
        } else if (e.key === "d") {
            // Delete selected bookmark
            bookmarks.splice(marksIndex, 1);
            if (marksIndex >= bookmarks.length) marksIndex = bookmarks.length - 1;
            if (bookmarks.length === 0) {
                closeMarksDialog();
            } else {
                renderMarksList();
            }
            e.preventDefault();
        } else if (e.key === "Enter") {
            let bm = bookmarks[marksIndex];
            // let node = findNode(bm.id);
            if (bm) {
                expandToNode(bm.id);
                selectedId = bm.id;
                closeMarksDialog();
                render();
            }
        } else if (e.key === "Escape") {
            closeMarksDialog();
        }
    }

    function handleHistoryKey(e) {
        if (!showingHistory) return;
        if (e.key === 'ArrowDown' || e.key === 'j') {
            historyIndex = Math.min(historyIndex + 1, Math.min(historyStackMax, historyStack.length - 1));
            renderHistoryList();
            e.preventDefault();
        } else if (e.key === 'ArrowUp' || e.key === 'k') {
            historyIndex = Math.max(historyIndex - 1, 0);
            renderHistoryList();
            e.preventDefault();
        } else if (e.key === 'Enter') {
            const recent = historyStack.slice(-15).reverse();
            if (recent[historyIndex]) {
                expandToNode(recent[historyIndex].id);
                selectedId = recent[historyIndex].id;
                closeHistoryDialog();
                render();
            }
            e.preventDefault();
        } else if (e.key === 'Escape' || e.key === 'q') {
            closeHistoryDialog();
            e.preventDefault();
        }
        return;
    }

    function dialogOpen() {
        let openDialog = false;

        if (showingHelp) {
            openDialog = true;
        }
        if (optionsDialog.style.display === "block") {
            openDialog = true;
        }
        if (searchDialog.style.display === "flex") {
            openDialog = true;
        }
        if (replaceDialog.style.display === "block") {
            openDialog = true;
        }
        if (linksDialog.style.display === "block") {
            openDialog = true;
        }
        if (marksDialog.style.display === "block") {
            openDialog = true;
        }
        if (historyDialog.style.display === "block") {
            openDialog = true;
        }
        if (saveAsDialog.style.display === "block") {
            openDialog = true;
        }

        return openDialog;
    }

    function vimEditDialogOpen() {
        let openDialog = false;

        if (helpDialog.style.display === "block") {
            openDialog = true;
        }

        return openDialog;
    }



    document.getElementById("filePicker").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
            file.text().then(content => {
                const match = content.match(/let\s+treeData\s*=\s*(\[[\s\S]*?\]);/);
                if (!match) {
                    alert("No treeData found in selected file.");
                    return;
                }

                try {
                    const importedTreeData = JSON.parse(match[1]);

                    // Replace current in-memory treeData
                    treeData = importedTreeData;

                    // Restore historyStack from imported file
                    const historyMatch = content.match(/let\s+historyStack\s*=\s*(\[[\s\S]*?\]);/s);
                    if (historyMatch) {
                        try {
                            historyStack = JSON.parse(historyMatch[1]);
                        } catch (e) {
                            console.warn('Failed to parse historyStack from import, using empty array');
                            historyStack = [];
                        }
                    }
                    
                    // Restore bookmarks from imported file
                    const bookmarksMatch = content.match(/let\s+bookmarks\s*=\s*(\[[\s\S]*?\]);/s);
                    if (bookmarksMatch) {
                        try {
                            bookmarks = JSON.parse(bookmarksMatch[1]);
                        } catch (e) {
                            console.warn('Failed to parse bookmarks from import, using empty array');
                            bookmarks = [];
                        }
                    }

                    selectedId = treeData[0]?.id || null;

                    // Re-render with new data
                    render();
                } catch (err) {
                    console.error("Failed to parse treeData:", err);
                    alert("Error parsing treeData.");
                }
            });
        }
    });


    //---- Modile UI -----------------------------------------------------------
    function toggleMobileMenu() {
        if (mobileMenu.style.display === "none") {
            mobileMenu.style.display = "block";
            mode_vim = false;
        } else {
            mobileMenu.style.display = "none";
        }
    }
    function updateHamburger() {
      if (window.innerWidth <= 768) {
        mobileMenu.style.display = 'block';
        hamburgerBtn.style.display = 'inline-block';
      } else {
        mobileMenu.style.display = 'none';
        hamburgerBtn.style.display = 'none';
        treeEl.classList.remove('show');
      }
    }
    window.addEventListener('resize', updateHamburger);
    updateHamburger();
    
    // Toggle treeview on hamburger click
    hamburgerBtn.addEventListener('click', () => {
      treeEl.classList.toggle('show');
    });
    
    // Hide tree when clicking editor
    editorArea.addEventListener('click', () => {
      if (window.innerWidth <= 768) {
        treeEl.classList.remove('show');
      }
    });

    const treeDialog = document.getElementById('treeDialog');
    const collapseBtn = document.getElementById('collapseBtn');
    const addNodeBtn = document.getElementById('addNodeBtn');
    const addChildBtn = document.getElementById('addChildBtn');
    const renameNodeBtn = document.getElementById('renameNodeBtn');
    const deleteNodeBtn = document.getElementById('deleteNodeBtn');
    const closeDialogBtn = document.getElementById('closeDialogBtn');
    const treeCol2 = document.getElementById('treeCol2');
    
    function openTreeDialog() {
        treeDialog.style.display = 'block';
        mode_vim = false;

        if (readOnly) {
            addNodeBtn.style.display = "none";
            addChildBtn.style.display = "none";
            renameNodeBtn.style.display = "none";
            deleteNodeBtn.style.display = "none";
            treeCol2.style.display = "none";
        }

        activateTree();
    }
    function closeTreeDialog() {
        treeDialog.style.display = 'none';
    }
    
    // Hook buttons
    collapseBtn.addEventListener('click', () => {
        closeTreeDialog();
        collapseAll();
        render();
    });
    addNodeBtn.addEventListener('click', () => {
        closeTreeDialog();
        if (treeData.length < 1) {
            addRoot();
        } else {
            addAfter();
        }
        render();
    });
    addChildBtn.addEventListener('click', () => {
        closeTreeDialog();
        addChild();
        render();
    });
    renameNodeBtn.addEventListener('click', () => {
        closeTreeDialog();
        if (!readOnly) renameFolder();
        render();
    });
    deleteNodeBtn.addEventListener('click', () => {
        closeTreeDialog();
        if (!readOnly) deleteNode();
        render();
    });
    closeDialogBtn.addEventListener('click', closeTreeDialog);
    
    // --- Triggering logic ---
    let longPressTimer = null;
    
    // Double-click anywhere on tree panel
    treeEl.addEventListener('dblclick', (e) => {
        e.preventDefault();
        openTreeDialog();
    });
    
    // Long press (for mobile)
    treeEl.addEventListener('touchstart', () => {
        longPressTimer = setTimeout(() => {
            openTreeDialog();
        }, 600); // 600ms = long press
    });
    treeEl.addEventListener('touchend', () => {
        clearTimeout(longPressTimer);
    });




    window.addEventListener('keydown', handleHistoryKey, { capture: true });
    window.addEventListener('keydown', handleLinksKey, { capture: true });
    window.addEventListener('keydown', handleMarksKey, { capture: true });




    //---- Mobile Sizing -------------------------------------------------------
    function isMobile() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    function setAppHeight() {
        document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
    }
    setAppHeight();
    window.addEventListener('resize', setAppHeight);

    editorArea.addEventListener('focus', () => {
        if (isMobile()) {
            document.querySelector('.app').style.height = `60dvh`;
            // document.querySelector('.app').style.height = `${window.innerHeight-400}px`;
            // setTimeout(() => window.scrollTo(0, 0), 50);
        }
    });
    
    editorArea.addEventListener('blur', () => {
        if (isMobile()) {
            document.querySelector('.app').style.height = '100dvh';
            setTimeout(setAppHeight, 100);
        }
    });




    //---- Init ------------------------------------------------------------
    window.addEventListener('load', function() {
        // Restore historyStack and bookmarks from saved HTML content
        try {
            const htmlContent = document.documentElement.outerHTML;
            
            // Extract and restore historyStack
            const historyMatch = htmlContent.match(/let\s+historyStack\s*=\s*(\[[\s\S]*?\]);/s);
            if (historyMatch) {
                try {
                    historyStack = JSON.parse(historyMatch[1]);
                } catch (e) {
                    console.warn('Failed to parse historyStack, using empty array');
                    historyStack = [];
                }
            }
            
            // Extract and restore bookmarks
            const bookmarksMatch = htmlContent.match(/let\s+bookmarks\s*=\s*(\[[\s\S]*?\]);/s);
            if (bookmarksMatch) {
                try {
                    bookmarks = JSON.parse(bookmarksMatch[1]);
                } catch (e) {
                    console.warn('Failed to parse bookmarks, using empty array');
                    bookmarks = [];
                }
            }
            
            // Extract and restore nodePort
            const nodePortMatch = htmlContent.match(/let\s+nodePort\s*=\s*(\d+);/);
            if (nodePortMatch) {
                try {
                    nodePort = parseInt(nodePortMatch[1]);
                } catch (e) {
                    console.warn('Failed to parse nodePort, using 0');
                    nodePort = 0;
                }
            }
        } catch (e) {
            console.error('Failed to restore saved data:', e);
        }

        if (showInitHelp) {
            if (readOnly) openHelpDialog('ReadOnly');
            else if (mode_vim) openHelpDialog('VimEnabled');
            else openHelpDialog('VimDisabled');
        }

        selectedId = treeData[0]?.id || null;
        render();
    });


    //---- Node AutoSaver ------------------------------------------------------
    let autoSaveTimer = null;

    function scheduleAutoSave() {
        if (nodePort == 0) return;
        if (!mode_insert) return;

        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(() => {
        saveViaNode();
        }, 3000);                               // wait 3s after last change
    }
</script>



<!-- Version 20251112 -->

</body></html>